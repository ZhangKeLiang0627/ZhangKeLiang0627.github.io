<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ESP32S3æ¥å…¥æ–‡å¿ƒä¸€è¨€</title>
    <link href="/2024/03/25/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/"/>
    <url>/2024/03/25/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/</url>
    
    <content type="html"><![CDATA[<h1 id="ESP32S3æ¥å…¥æ–‡å¿ƒä¸€è¨€"><a href="#ESP32S3æ¥å…¥æ–‡å¿ƒä¸€è¨€" class="headerlink" title="ESP32S3æ¥å…¥æ–‡å¿ƒä¸€è¨€"></a>ESP32S3æ¥å…¥æ–‡å¿ƒä¸€è¨€</h1><h2 id="Author-kkl"><a href="#Author-kkl" class="headerlink" title="Author: kkl"></a>Author: kkl</h2><hr><h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>ä½¿ç”¨ESP32S3æ¥å…¥æ–‡å¿ƒä¸€è¨€ï¼Œå…¶å®æ˜¯ä¸ºæˆ‘åé¢çš„æŸä¸ªå°é¡¹ç›®åšé“ºå«å•¦ï¼è¿™é‡Œè®°å½•ä¸€ä¸‹å®ç°çš„è¿‡ç¨‹ã€‚</p><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><ul><li>ä¸»æ§ï¼šESP32S3N16R8</li><li>å¹³å°ï¼šArduino + PlatformIO + VScode</li></ul><h2 id="äºŒã€æ­¥éª¤"><a href="#äºŒã€æ­¥éª¤" class="headerlink" title="äºŒã€æ­¥éª¤"></a>äºŒã€æ­¥éª¤</h2><ol><li>åœ¨ç™¾åº¦æ™ºèƒ½äº‘çš„äº‘åƒå¸†æ§åˆ¶å°å¹¶åˆ›å»ºåº”ç”¨è·å–<code>API Key</code>å’Œ<code>Secret Key</code></li><li>æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„<code>API Key</code>å’Œ<code>Secret Key</code>æ¥è·å–<code>access_token</code></li><li>åœ¨ESP32S3ä¸­å‘é€POSTè¯·æ±‚API</li></ol><h2 id="ä¸‰ã€å®ç°"><a href="#ä¸‰ã€å®ç°" class="headerlink" title="ä¸‰ã€å®ç°"></a>ä¸‰ã€å®ç°</h2><h3 id="1-åœ¨ç™¾åº¦æ™ºèƒ½äº‘çš„äº‘åƒå¸†æ§åˆ¶å°å¹¶åˆ›å»ºåº”ç”¨è·å–API-Keyå’ŒSecret-Key"><a href="#1-åœ¨ç™¾åº¦æ™ºèƒ½äº‘çš„äº‘åƒå¸†æ§åˆ¶å°å¹¶åˆ›å»ºåº”ç”¨è·å–API-Keyå’ŒSecret-Key" class="headerlink" title="1. åœ¨ç™¾åº¦æ™ºèƒ½äº‘çš„äº‘åƒå¸†æ§åˆ¶å°å¹¶åˆ›å»ºåº”ç”¨è·å–API Keyå’ŒSecret Key"></a>1. åœ¨ç™¾åº¦æ™ºèƒ½äº‘çš„äº‘åƒå¸†æ§åˆ¶å°å¹¶åˆ›å»ºåº”ç”¨è·å–<code>API Key</code>å’Œ<code>Secret Key</code></h3><p>é¦–å…ˆè¦ä½¿ç”¨äº‘è´¦å·ç™»å½•ç™¾åº¦æ™ºèƒ½äº‘ï¼Œç„¶åè¿›å…¥åƒå¸†å¤§æ¨¡å‹å¹³å°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨ã€‚<strong>ï¼ˆæ³¨æ„ï¼šåˆ†æ¸…æ¥šç™¾åº¦è´¦å·è¿˜æ˜¯äº‘è´¦å·ï¼Œè¿™ä¸¤ä¸ªä¸ä¸€æ ·çš„ï¼‰</strong></p><p>ç™¾åº¦æ™ºèƒ½äº‘åƒå¸†æ§åˆ¶å°ï¼š<a href="https://console.bce.baidu.com/qianfan/ais/console/applicationConsole/application">https://console.bce.baidu.com/qianfan/ais/console/applicationConsole/application</a></p><p>åˆ›å»ºæ–°åº”ç”¨ï¼š<br><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image.png"></p><p><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image-1.png"></p><p>åˆ›å»ºå¥½åº”ç”¨ä»¥åå°±å¯ä»¥å¾—åˆ°<code>API Key</code>å’Œ<code>Secret Key</code>ï¼<br><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image-2.png"></p><h3 id="2-æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„API-Keyå’ŒSecret-Keyæ¥è·å–access-token"><a href="#2-æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„API-Keyå’ŒSecret-Keyæ¥è·å–access-token" class="headerlink" title="2. æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„API Keyå’ŒSecret Keyæ¥è·å–access_token"></a>2. æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„<code>API Key</code>å’Œ<code>Secret Key</code>æ¥è·å–<code>access_token</code></h3><p>è¿›å…¥APIä»£ç è°ƒè¯•ç•Œé¢ï¼š<br><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image-3.png"></p><p><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image-4.png"></p><p><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image-5.png"></p><p>åº”ç”¨åˆ—è¡¨é€‰æ‹©è‡ªå·±åˆ›å»ºçš„ESP32S3æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹<br><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image-6.png"></p><p>è·å–<code>access_token</code><br><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image-7.png"></p><p>æŒ‡ä»¤æ ¼å¼ï¼š<code>&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;ä»‹ç»ä¸€ä¸‹åä¾¦æ¢æŸ¯å—è¿™éƒ¨åŠ¨ç”»&quot;</code><br><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image-8.png"></p><p>è°ƒè¯•ç»“æœå¦‚ä¸‹ï¼š<br><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/image-9.png"></p><h3 id="3-åœ¨ESP32S3ä¸­å‘é€POSTè¯·æ±‚API"><a href="#3-åœ¨ESP32S3ä¸­å‘é€POSTè¯·æ±‚API" class="headerlink" title="3. åœ¨ESP32S3ä¸­å‘é€POSTè¯·æ±‚API"></a>3. åœ¨ESP32S3ä¸­å‘é€POSTè¯·æ±‚API</h3><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs cpp">String apiERNIEbotUrl = <span class="hljs-string">&quot;https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions?access_token=xxxxxxxxx&quot;</span>; <span class="hljs-comment">// æŠŠç”³è¯·çš„access_tokenå¡«ä¸Šå»</span><br>String inputText = <span class="hljs-string">&quot;ä½ å¥½ï¼&quot;</span>;<br><br><span class="hljs-comment">/* æ–‡å¿ƒä¸€è¨€ */</span><br><span class="hljs-function">String <span class="hljs-title">getGPTResponse</span><span class="hljs-params">(String inputText)</span></span><br><span class="hljs-function"></span>&#123;<br>  HTTPClient http_client;<br><br>  http_client.<span class="hljs-built_in">begin</span>(apiERNIEbotUrl);<br>  http_client.<span class="hljs-built_in">addHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>);<br><br>  http_client.<span class="hljs-built_in">setTimeout</span>(<span class="hljs-number">20000</span>); <span class="hljs-comment">// 20sçš„è¶…æ—¶æ—¶é—´</span><br><br>  String payload = <span class="hljs-string">&quot;&#123;\&quot;messages\&quot;:[&#123;\&quot;role\&quot;: \&quot;user\&quot;,\&quot;content\&quot;: \&quot;&quot;</span> + inputText + <span class="hljs-string">&quot;\&quot;&#125;],\&quot;disable_search\&quot;: false,\&quot;enable_citation\&quot;: false&#125;&quot;</span>;<br><br>  <span class="hljs-type">int</span> httpResponseCode = http_client.<span class="hljs-built_in">POST</span>(payload);<br><br>  <span class="hljs-keyword">if</span> (httpResponseCode == HTTP_CODE_OK)<br>  &#123;<br>    String response = http_client.<span class="hljs-built_in">getString</span>();<br><br>    http_client.<span class="hljs-built_in">end</span>();<br>    _LOG(<span class="hljs-string">&quot;\r\n%s\r\n&quot;</span>, response.<span class="hljs-built_in">c_str</span>());<br><br>    <span class="hljs-comment">// Parse JSON response</span><br>    <span class="hljs-function">DynamicJsonDocument <span class="hljs-title">doc</span><span class="hljs-params">(<span class="hljs-number">2048</span>)</span></span>;<br>    <span class="hljs-built_in">deserializeJson</span>(doc, response);<br><br>    String outPutText = doc[<span class="hljs-string">&quot;result&quot;</span>];<br>    <span class="hljs-keyword">return</span> outPutText;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    _LOG(<span class="hljs-string">&quot;[HTTP] GET... failed, error: %s\n&quot;</span>, http_client.<span class="hljs-built_in">errorToString</span>(httpResponseCode).<span class="hljs-built_in">c_str</span>());<br>    http_client.<span class="hljs-built_in">end</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;[HTTP] GET... failed, error!&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><p>æ„å¤–çš„é¡ºåˆ©è€¶ï¼YapiğŸ˜˜</p><ul><li>è¦æ³¨æ„çš„æ˜¯ï¼Œæ–‡å¿ƒä¸€è¨€çš„APIæ–°ç”¨æˆ·ç¬¬ä¸€ä¸ªæœˆå¯ä»¥è·å¾—ä¸€å¼ 20å…ƒçš„ä¼˜æƒ åˆ¸æœ‰æ•ˆæœŸ1ä¸ªæœˆï¼Œ1ä¸ªæœˆä»¥åå°±è¦ä»˜è´¹ä½¿ç”¨æ–‡å¿ƒä¸€è¨€å•¦ï¼</li><li>access_tokené»˜è®¤æœ‰æ•ˆæœŸ30å¤©ï¼Œå•ä½æ˜¯ç§’ï¼Œç”Ÿäº§ç¯å¢ƒæ³¨æ„åŠæ—¶åˆ·æ–°ã€‚åˆ·æ–°äº†æ—§çš„ä¹Ÿèƒ½ç”¨ï¼ˆåªè¦ä¸è¶…æ—¶ï¼‰</li></ul><h2 id="é¸£è°¢"><a href="#é¸£è°¢" class="headerlink" title="é¸£è°¢"></a>é¸£è°¢</h2><p>é¡¹ç›®æ•™ç¨‹ï¼š<a href="https://blog.csdn.net/vor234/article/details/135372118">https://blog.csdn.net/vor234/article/details/135372118</a></p>]]></content>
    
    
    <categories>
      
      <category>Study Page</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ESP32</tag>
      
      <tag>æ–‡å¿ƒä¸€è¨€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ESP32S3æ¥å…¥ç™¾åº¦åœ¨çº¿è¯­éŸ³è¯†åˆ«</title>
    <link href="/2024/03/24/ESP32S3%E6%8E%A5%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%A8%E7%BA%BF%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/ESP32S3%E6%8E%A5%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%A8%E7%BA%BF%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/"/>
    <url>/2024/03/24/ESP32S3%E6%8E%A5%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%A8%E7%BA%BF%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/ESP32S3%E6%8E%A5%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%A8%E7%BA%BF%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<h1 id="ESP32S3æ¥å…¥ç™¾åº¦åœ¨çº¿è¯­éŸ³è¯†åˆ«"><a href="#ESP32S3æ¥å…¥ç™¾åº¦åœ¨çº¿è¯­éŸ³è¯†åˆ«" class="headerlink" title="ESP32S3æ¥å…¥ç™¾åº¦åœ¨çº¿è¯­éŸ³è¯†åˆ«"></a>ESP32S3æ¥å…¥ç™¾åº¦åœ¨çº¿è¯­éŸ³è¯†åˆ«</h1><h2 id="Author-kkl"><a href="#Author-kkl" class="headerlink" title="Author: kkl"></a>Author: kkl</h2><hr><h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>ä½¿ç”¨ESP32S3æ¥å…¥ç™¾åº¦æ™ºèƒ½äº‘å®ç°åœ¨çº¿è¯­éŸ³è¯†åˆ«ï¼Œè®°å½•ä¸­é—´é‡åˆ°çš„é—®é¢˜å’Œå®ç°æµç¨‹ã€‚</p><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><ul><li>ä¸»æ§ï¼šESP32S3N16R8</li><li>å¹³å°ï¼šArduino + PlatformIO + VScode</li></ul><h2 id="äºŒã€æ­¥éª¤"><a href="#äºŒã€æ­¥éª¤" class="headerlink" title="äºŒã€æ­¥éª¤"></a>äºŒã€æ­¥éª¤</h2><ol><li>åœ¨ç™¾åº¦æ™ºèƒ½äº‘æ§åˆ¶ç«¯é€‰æ‹©<code>è¯­éŸ³è¯†åˆ«</code>å¹¶åˆ›å»ºåº”ç”¨è·å–<code>API Key</code>å’Œ<code>Secret Key</code></li><li>æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„<code>API Key</code>å’Œ<code>Secret Key</code>æ¥è·å–<code>access_token</code></li><li>é‡‡é›†éŸ³é¢‘æ•°æ®ï¼Œæ‰“åŒ…æ•°æ®ï¼Œé€šè¿‡httpåè®®å°†æ‰“åŒ…çš„æ•°æ®ï¼ˆpayloadï¼‰POSTè¯·æ±‚å‘é€è¯­éŸ³è¯†åˆ«çš„APIä¸Š</li><li>æ¥æ”¶è¿”å›çš„æ•°æ®ï¼ˆresponseï¼‰</li></ol><h2 id="ä¸‰ã€å®ç°"><a href="#ä¸‰ã€å®ç°" class="headerlink" title="ä¸‰ã€å®ç°"></a>ä¸‰ã€å®ç°</h2><h3 id="1-åˆ›å»ºè¯­éŸ³è¯†åˆ«åº”ç”¨"><a href="#1-åˆ›å»ºè¯­éŸ³è¯†åˆ«åº”ç”¨" class="headerlink" title="1. åˆ›å»ºè¯­éŸ³è¯†åˆ«åº”ç”¨"></a>1. åˆ›å»ºè¯­éŸ³è¯†åˆ«åº”ç”¨</h3><p>ç™»å½•ç™¾åº¦æ™ºèƒ½äº‘çš„äº‘è´¦å·ï¼Œé€‰æ‹©è¯­éŸ³è¯†åˆ«ï¼Œåˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨ã€‚<strong>ï¼ˆæ³¨æ„ï¼šåˆ†æ¸…æ¥šç™¾åº¦è´¦å·è¿˜æ˜¯äº‘è´¦å·ï¼Œè¿™ä¸¤ä¸ªä¸ä¸€æ ·çš„ï¼‰</strong><br>ç™¾åº¦æ™ºèƒ½äº‘ï¼š<a href="https://login.bce.baidu.com/?redirect=https://console.bce.baidu.com/ai/#/ai/speech/app/list">https://login.bce.baidu.com/?redirect=https%3A%2F%2Fconsole.bce.baidu.com%2Fai%2F#/ai/speech/app/list</a></p><p><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%A8%E7%BA%BF%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/image.png"><br><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%A8%E7%BA%BF%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/image-1.png"><br><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%A8%E7%BA%BF%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/image-2.png"></p><h3 id="2-æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„API-Keyå’ŒSecret-Keyæ¥è·å–access-token"><a href="#2-æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„API-Keyå’ŒSecret-Keyæ¥è·å–access-token" class="headerlink" title="2. æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„API Keyå’ŒSecret Keyæ¥è·å–access_token"></a>2. æ ¹æ®åˆ›å»ºåº”ç”¨ç”Ÿæˆçš„API Keyå’ŒSecret Keyæ¥è·å–access_token</h3><p>åˆ›å»ºå¥½åº”ç”¨ï¼Œåœ¨åº”ç”¨åˆ—è¡¨é‡Œä¼šå‡ºç°ä½ åˆšåˆšåˆ›å»ºçš„åº”ç”¨ï¼Œå½“ç„¶<code>API Key</code>å’Œ<code>Secret Key</code>ä¹Ÿæœ‰å•¦</p><p><img src="/images/ESP32S3%E6%8E%A5%E5%85%A5%E7%99%BE%E5%BA%A6%E5%9C%A8%E7%BA%BF%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/image-3.png"></p><p>æœ‰äº†<code>API Key</code>å’Œ<code>Secret Key</code>ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥åœ¨ESP32S3ä¸Šè¿›è¡ŒGETè¯·æ±‚å¾—åˆ°access_tokençš„ä»£ç ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* è·å–token */</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">gainToken</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>   </span><br><span class="hljs-function"></span>&#123;<br>    HTTPClient http_client; <span class="hljs-comment">// #include &lt;HTTPClient.h&gt;</span><br>    <span class="hljs-comment">//æ³¨æ„ï¼Œè¦æŠŠä¸‹é¢ç½‘å€ä¸­çš„your_apikeyå’Œyour_secretkeyæ›¿æ¢æˆè‡ªå·±çš„API Keyå’ŒSecret Key</span><br>    http_client.<span class="hljs-built_in">begin</span>(<span class="hljs-string">&quot;https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&amp;client_id=your_apikey&amp;client_secret=your_secretkey&quot;</span>);<br>    <span class="hljs-type">int</span> httpResponseCode = http_client.<span class="hljs-built_in">GET</span>();<br><br>    <span class="hljs-keyword">if</span>(httpResponseCode == HTTP_CODE_OK)<br>    &#123;<br>        String response = http_client.<span class="hljs-built_in">getString</span>();<br>        Serial.<span class="hljs-built_in">println</span>(response);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        Serial.<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[HTTP] GET... failed, error: %s\n&quot;</span>, http_client.<span class="hljs-built_in">errorToString</span>(httpResponseCode).<span class="hljs-built_in">c_str</span>());<br>    &#125;<br>    http_client.<span class="hljs-built_in">end</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ±‚æˆåŠŸä¼šè¿”å›å¦‚ä¸‹æ•°æ®ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨<code>access_token</code>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;refresh_token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;25.b55fe1d287227ca97aab219bb249b8ab.315360000.1798284651.282335-8574074&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;expires_in&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2592000</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;scope&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;public wise_adapt&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;session_key&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;9mzdDZXu3dENdFZQurfg0Vz8slgSgvvOAUebNFzyzcpQ5EnbxbF+hfG9DQkpUVQdh4p6HbQcAiz5RmuBAja1JJGgIdJI&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;access_token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;24.6c5e1ff107f0e8bcef8c46d3424a0e78.2592000.1485516651.282335-8574074&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;session_secret&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dfac94a3489fe9fca7c3221cbf7525ff&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li><code>access_token</code>å¯¹åº”çš„å€¼å°±æ˜¯å¯ç”¨çš„tokenï¼Œæ¯æ¬¡ç”³è¯·çš„<code>token</code>æœ‰æ•ˆæœŸé™ä¸º30å¤©ï¼Œè¿‡æœŸå°±éœ€è¦é‡æ–°ç”³è¯·ã€‚æ‰€ä»¥å’±å®šæ—¶æ›´æ–°<code>access_token</code>å°±è¡Œï¼Œä¸ç”¨æ¯æ¬¡è°ƒç”¨è¯­éŸ³è¯†åˆ«éƒ½ç”³è¯·ä¸€éã€‚</li></ul><h3 id="3-é‡‡é›†æ•°æ®ï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°è¯­éŸ³è¯†åˆ«APIä¸Š"><a href="#3-é‡‡é›†æ•°æ®ï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°è¯­éŸ³è¯†åˆ«APIä¸Š" class="headerlink" title="3. é‡‡é›†æ•°æ®ï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°è¯­éŸ³è¯†åˆ«APIä¸Š"></a>3. é‡‡é›†æ•°æ®ï¼Œé€šè¿‡POSTè¯·æ±‚å‘é€åˆ°è¯­éŸ³è¯†åˆ«APIä¸Š</h3><p>æ•°æ®ä¸Šä¼ POSTçš„æ–¹å¼æœ‰ä¸¤ç§ï¼šJSONæ ¼å¼å’ŒRAWæ ¼å¼ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨JSONæ ¼å¼ï¼Œä¸‹å›¾ä¸ºJSONæ ¼å¼ä¸Šä¼ çš„ä¸€äº›å¿…è¦çš„å‚æ•°è¯´æ˜ï¼š</p><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">ç±»å‹</th><th align="center">å¯éœ€</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="center">format</td><td align="center">String</td><td align="center">å¿…å¡«</td><td align="left">è¯­éŸ³æ–‡ä»¶çš„æ ¼å¼ï¼Œpcm&#x2F;wav&#x2F;amr&#x2F;m4aã€‚ä¸åŒºåˆ†å¤§å°å†™ã€‚æ¨èpcmæ–‡ä»¶ï¼</td></tr><tr><td align="center">rate</td><td align="center">int</td><td align="center">å¿…å¡«</td><td align="left">é‡‡æ ·ç‡ï¼Œ16000ã€8000ï¼Œå›ºå®šå€¼</td></tr><tr><td align="center">channel</td><td align="center">int</td><td align="center">å¿…å¡«</td><td align="left">å£°é“æ•°ï¼Œä»…æ”¯æŒå•å£°é“ï¼Œè¯·å¡«å›ºå®šå€¼1</td></tr><tr><td align="center">cuid</td><td align="center">String</td><td align="center">å¿…å¡«</td><td align="left">ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œç”¨æ¥åŒºåˆ†ç”¨æˆ·ï¼Œè®¡ç®—UVå€¼ã€‚å»ºè®®å¡«å†™èƒ½åŒºåˆ†ç”¨æˆ·çš„æœºå™¨MACåœ°å€æˆ–IMEIç ï¼Œé•¿åº¦ä¸º60å­—ç¬¦ä»¥å†…ã€‚</td></tr><tr><td align="center">token</td><td align="center">String</td><td align="center">å¿…å¡«</td><td align="left">å¼€æ”¾å¹³å°è·å–åˆ°çš„å¼€å‘è€…[access_token]</td></tr><tr><td align="center">dev_pid</td><td align="center">int</td><td align="center">é€‰å¡«</td><td align="left">ä¸å¡«å†™lanå‚æ•°ç”Ÿæ•ˆï¼Œéƒ½ä¸å¡«å†™å°±é»˜è®¤1537ï¼ˆæ™®é€šè¯ï¼Œè¾“å…¥æ³•æ¨¡å‹ï¼‰</td></tr><tr><td align="center">lm_id</td><td align="center">int</td><td align="center">é€‰å¡«</td><td align="left">è‡ªè®­ç»ƒå¹³å°æ¨¡å‹idï¼Œå¡«dev_id &#x3D; 8001 æˆ– 8002 ç”Ÿæ•ˆ</td></tr><tr><td align="center">lan</td><td align="center">String</td><td align="center">é€‰å¡«ï¼ŒåºŸå¼ƒå‚æ•°</td><td align="left">å†å²å…¼å®¹å‚æ•°ï¼Œå·²ä¸å†ä½¿ç”¨</td></tr><tr><td align="center">speech</td><td align="center">String</td><td align="center">å¿…å¡«</td><td align="left">æœ¬åœ°è¯­éŸ³æ–‡ä»¶çš„äºŒè¿›åˆ¶è¯­éŸ³æ•°æ®ï¼Œéœ€è¦è¿›è¡Œ base64 ç¼–ç ï¼Œä¸lenå‚æ•°ä¸€èµ·ä½¿ç”¨</td></tr><tr><td align="center">len</td><td align="center">int</td><td align="center">å¿…å¡«</td><td align="left">æœ¬åœ°è¯­éŸ³æ–‡ä»¶çš„å­—èŠ‚æ•°ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼ˆbyteï¼‰</td></tr></tbody></table><p>å›¾ä¸­å¯¹æ•°æ®ç±»å‹å’Œå†…å®¹è¯´çš„å¾ˆæ˜ç¡®äº†ï¼Œåªéœ€è¦æŒ‰ç…§è¿™ä¸ªæ ¼å¼æ‰“åŒ…å¥½æ•°æ®ç„¶åå‘é€å°±è¡Œï¼Œä¸‹é¢æ˜¯ESP32S3çš„å…·ä½“å®ç°ä»£ç ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">char</span> payload[<span class="hljs-number">160000</span>];<br><br><span class="hljs-comment">/* åœ¨çº¿è¯­éŸ³è¯†åˆ« */</span><br><span class="hljs-function">String <span class="hljs-title">speechRecognition</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  HTTPClient http_client; <span class="hljs-comment">// #include &lt;HTTPClient.h&gt;</span><br><br>  _LOG(<span class="hljs-string">&quot;[Recognition] Start recognition!\r\n&quot;</span>);<br><br>  result = Mic.<span class="hljs-built_in">record</span>(_rawData, _samples); <span class="hljs-comment">// å½•åˆ¶å£°éŸ³</span><br>  _LOG(<span class="hljs-string">&quot;[Mic] record:%s\r\n&quot;</span>, (result == <span class="hljs-literal">true</span> ? <span class="hljs-string">&quot;true&quot;</span> : <span class="hljs-string">&quot;false&quot;</span>));<br>  <span class="hljs-keyword">while</span> (Mic.<span class="hljs-built_in">isRecording</span>()); <span class="hljs-comment">// å½“å½•åˆ¶å®Œæˆæ—¶</span><br>  _LOG(<span class="hljs-string">&quot;[Mic] record is done!\r\n&quot;</span>);<br><br>  <span class="hljs-built_in">memset</span>(payload, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-built_in">strlen</span>(payload)); <span class="hljs-comment">// å°†æ•°ç»„æ¸…ç©º</span><br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;&#123;&quot;</span>);<br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;\&quot;format\&quot;:\&quot;pcm\&quot;,&quot;</span>);<br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;\&quot;rate\&quot;:16000,&quot;</span>); <span class="hljs-comment">// é‡‡æ ·ç‡ï¼Œå¦‚æœé‡‡æ ·ç‡æ”¹å˜äº†ï¼Œè®°å¾—ä¿®æ”¹è¯¥å€¼ï¼Œåªæœ‰16000ã€8000ä¸¤ä¸ªå›ºå®šé‡‡æ ·ç‡</span><br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;\&quot;dev_pid\&quot;:1537,&quot;</span>); <span class="hljs-comment">// ä¸­æ–‡æ™®é€šè¯</span><br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;\&quot;channel\&quot;:1,&quot;</span>); <span class="hljs-comment">// å•å£°é“</span><br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;\&quot;cuid\&quot;:\&quot;hugozkl\&quot;,&quot;</span>); <span class="hljs-comment">// è¯†åˆ«ç ï¼Œéšä¾¿æ‰“å‡ ä¸ªå­—ç¬¦ï¼Œä½†æœ€å¥½å”¯ä¸€</span><br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;\&quot;token\&quot;:\&quot;24.ba06cf95edb0b0aee7bfb016209e5948.2592000.1713715897.282335-57684431\&quot;,&quot;</span>); <span class="hljs-comment">// tokenï¼Œè¿™é‡Œéœ€è¦ä¿®æ”¹æˆè‡ªå·±ç”³è¯·åˆ°çš„token</span><br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;\&quot;len\&quot;:65536,&quot;</span>); <span class="hljs-comment">// æ•°æ®é•¿åº¦ï¼Œå¦‚æœä¼ è¾“çš„æ•°æ®é•¿åº¦æ”¹å˜äº†ï¼Œè®°å¾—ä¿®æ”¹è¯¥å€¼ï¼Œè¯¥å€¼æ˜¯ADCé‡‡é›†çš„æ•°æ®å­—èŠ‚æ•°ï¼Œä¸æ˜¯base64ç¼–ç åçš„é•¿åº¦</span><br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;\&quot;speech\&quot;:\&quot;&quot;</span>);<br>  <span class="hljs-built_in">strcat</span>(payload, base64::<span class="hljs-built_in">encode</span>((<span class="hljs-type">uint8_t</span> *)_rawData, <span class="hljs-number">65536</span>).<span class="hljs-built_in">c_str</span>()); <span class="hljs-comment">// base64ç¼–ç æ•°æ® // #include &quot;base64.h&quot;</span><br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;\&quot;&quot;</span>);<br>  <span class="hljs-built_in">strcat</span>(payload, <span class="hljs-string">&quot;&#125;&quot;</span>);<br><br>  <span class="hljs-comment">// HTTP POST</span><br>  <span class="hljs-type">int</span> httpResponseCode;<br>  http_client.<span class="hljs-built_in">begin</span>(<span class="hljs-string">&quot;http://vop.baidu.com/server_api&quot;</span>);<br>  http_client.<span class="hljs-built_in">addHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>);<br>  http_client.<span class="hljs-built_in">setTimeout</span>(<span class="hljs-number">5000</span>); <span class="hljs-comment">// 5sè¶…æ—¶æ—¶é—´</span><br>  httpResponseCode = http_client.<span class="hljs-built_in">POST</span>(payload);<br><br>  <span class="hljs-keyword">if</span> (httpResponseCode == HTTP_CODE_OK)<br>  &#123;<br>    String response = http_client.<span class="hljs-built_in">getString</span>();<br><br>    http_client.<span class="hljs-built_in">end</span>();<br>    _LOG(<span class="hljs-string">&quot;\r\n%s\r\n&quot;</span>, response.<span class="hljs-built_in">c_str</span>());<br><br>    <span class="hljs-comment">// Parse JSON response</span><br>    <span class="hljs-function">DynamicJsonDocument <span class="hljs-title">doc</span><span class="hljs-params">(<span class="hljs-number">2048</span>)</span></span>; <span class="hljs-comment">// #include &lt;ArduinoJson.h&gt;</span><br>    <span class="hljs-built_in">deserializeJson</span>(doc, response);<br><br>    String outPutText = doc[<span class="hljs-string">&quot;result&quot;</span>];<br>    <span class="hljs-comment">// å»æ‰é¦–å°¾çš„[&quot;&quot;]</span><br>    outPutText = outPutText.<span class="hljs-built_in">substring</span>(<span class="hljs-number">2</span>);<br>    outPutText = outPutText.<span class="hljs-built_in">substring</span>(<span class="hljs-number">0</span>, outPutText.<span class="hljs-built_in">length</span>() - <span class="hljs-number">2</span>);<br>    <span class="hljs-keyword">return</span> outPutText;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    _LOG(<span class="hljs-string">&quot;[HTTP] GET... failed, error: %s\n&quot;</span>, http_client.<span class="hljs-built_in">errorToString</span>(httpResponseCode).<span class="hljs-built_in">c_str</span>());<br>    http_client.<span class="hljs-built_in">end</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;error&gt;&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>POSTå‘é€æ•°æ®æœ‰ä¸€ä¸ªå›ºå®šå¤´éƒ¨ï¼š<code>Content-Type:application/json</code>ï¼ŒPOSTå‰éœ€è¦è®¾ç½®ä¸€ä¸‹ï¼Œä»£ç ä¸­å·²ç»æœ‰å±•ç¤ºã€‚</p><h3 id="4-æ¥æ”¶æ•°æ®"><a href="#4-æ¥æ”¶æ•°æ®" class="headerlink" title="4. æ¥æ”¶æ•°æ®"></a>4. æ¥æ”¶æ•°æ®</h3><p>åœ¨ä¸Šä¸€æ­¥ä»£ç ä¸­å®ç°äº†æ¥æ”¶æ•°æ®ï¼Œè¿™é‡Œåˆ—ä¸€ä¸‹è¿”å›çš„æ•°æ®ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;corpus_no&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;7349831540333925029&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;err_msg&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success.&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;err_no&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">&quot;ä½ å¥½ï¼Œä½ æ˜¯è°ï¼Ÿ&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;sn&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;593363272001711266008&quot;</span><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;corpus_no&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;7349831596084473860&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;err_msg&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success.&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;err_no&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">&quot;ç°åœ¨å¤šå°‘ç‚¹ï¼Ÿ&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;sn&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;671001951581711266021&quot;</span><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;corpus_no&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;7349831639168589351&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;err_msg&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;success.&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;err_no&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">&quot;æ·±åœ³å¤©æ°”å¦‚ä½•ï¼Ÿ&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;sn&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;13152229661711266031&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>æ•°æ®å‘é€æˆåŠŸåˆ™ä¼šè¿”å›æ­£ç¡®çš„è¯†åˆ«æ•°æ®ï¼Œå½“ç„¶å£°éŸ³ä¿¡å·ä¸å¥½æ—¶è¿”å›çš„è¯­éŸ³è¯†åˆ«ä¹Ÿä¼šä¸å‡†ç¡®ã€‚</li><li>è°¨è®°ï¼Œè¿”å›çš„è¯­éŸ³è¯†åˆ«ç»“æœæ˜¯<code>UTF-8</code>æ–¹å¼ç¼–ç ï¼Œæ‰€ä»¥ä»£ç çš„ç¼–ç æœ€å¥½ä¹Ÿæ”¹ä¸º<code>UTF-8</code>ç¼–ç æ ¼å¼ã€‚</li></ul><h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><ul><li>ç™¾åº¦æ™ºèƒ½äº‘çš„è¯­éŸ³è¯†åˆ«æœåŠ¡æ˜¯å¯ä»¥å…è´¹é¢†å–åˆ°ä¸€å®šä½¿ç”¨æ¬¡æ•°çš„ï¼Œ15ä¸‡æ¬¡ï¼Œè¶³å¤Ÿæˆ‘ä»¬æµ‹è¯•ä½¿ç”¨ï¼Œè®°å¾—å¼€å§‹æµ‹è¯•å‰å…ˆé¢†å–ä¸€ä¸‹ï¼Œä¸ç„¶ä¼šå‡ºç°è¿”å›<code>æŠ¥é”™ï¼š&#123;&#39;err_msg&#39;: &#39;request pv too much&#39;, &#39;err_no&#39;: 3305, &#39;sn&#39;: &#39;876137091191590632079&#39; &#125;</code>ï¼ŒæŠ¥é”™åŸå› å¤šåŠæ˜¯å…è´¹æ¬¡æ•°æ²¡é¢†å–æˆ–è€…ç”¨å®Œäº†è¦å¼€é€šä»˜è´¹åŠŸèƒ½ã€‚</li></ul><h2 id="é¸£è°¢"><a href="#é¸£è°¢" class="headerlink" title="é¸£è°¢"></a>é¸£è°¢</h2><p>é¡¹ç›®æ•™ç¨‹ï¼š<a href="https://blog.csdn.net/wojueburenshu/article/details/119244390">https://blog.csdn.net/wojueburenshu/article/details/119244390</a></p>]]></content>
    
    
    <categories>
      
      <category>Study Page</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ESP32</tag>
      
      <tag>è¯­éŸ³è¯†åˆ«</tag>
      
      <tag>Mic</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Lvglæ·»åŠ è‡ªå®šä¹‰å­—ä½“å’Œå›¾ç‰‡</title>
    <link href="/2024/03/21/Lvgl%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93%E5%92%8C%E5%9B%BE%E7%89%87/Lvgl%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93%E5%92%8C%E5%9B%BE%E7%89%87/"/>
    <url>/2024/03/21/Lvgl%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93%E5%92%8C%E5%9B%BE%E7%89%87/Lvgl%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93%E5%92%8C%E5%9B%BE%E7%89%87/</url>
    
    <content type="html"><![CDATA[<h1 id="Lvglæ·»åŠ è‡ªå®šä¹‰å­—ä½“å’Œå›¾ç‰‡"><a href="#Lvglæ·»åŠ è‡ªå®šä¹‰å­—ä½“å’Œå›¾ç‰‡" class="headerlink" title="Lvglæ·»åŠ è‡ªå®šä¹‰å­—ä½“å’Œå›¾ç‰‡"></a>Lvglæ·»åŠ è‡ªå®šä¹‰å­—ä½“å’Œå›¾ç‰‡</h1><h2 id="Author-kkl"><a href="#Author-kkl" class="headerlink" title="Author: kkl"></a>Author: kkl</h2><hr><h2 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h2><p>ä»…ä»…ä¿è¯å¯¹äº<code>X-TRACK</code>é¡¹ç›®çš„è‡ªå®šä¹‰å­—ä½“å’Œå›¾ç‰‡çš„æœ‰æ•ˆä½¿ç”¨å“¦ï¼</p><hr><h2 id="Font-convert-å­—ä½“æ ¼å¼è½¬æ¢æˆ-cæ–‡ä»¶"><a href="#Font-convert-å­—ä½“æ ¼å¼è½¬æ¢æˆ-cæ–‡ä»¶" class="headerlink" title="Font convert å­—ä½“æ ¼å¼è½¬æ¢æˆ.cæ–‡ä»¶"></a>Font convert å­—ä½“æ ¼å¼è½¬æ¢æˆ.cæ–‡ä»¶</h2><h3 id="ç”Ÿæˆ"><a href="#ç”Ÿæˆ" class="headerlink" title="ç”Ÿæˆ"></a>ç”Ÿæˆ</h3><p>é¦–å…ˆæˆ‘ä»¬è¦å»åˆ°Lvglå®˜æ–¹ç½‘ç«™ä¸Šçš„<strong>Online Font Converter</strong><br>ç½‘å€ï¼š<a href="https://lvgl.io/tools/fontconverter">https://lvgl.io/tools/fontconverter</a></p><p>ç„¶åæˆ‘ä»¬ä¼šçœ‹åˆ°ä»¥ä¸‹é¡µé¢ï¼<br><img src="/images/Lvgl%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93%E5%92%8C%E5%9B%BE%E7%89%87/image.png"></p><blockquote><ol><li>Name</li></ol></blockquote><p>å¡«å†™.cæ–‡ä»¶çš„åå­—ï¼Œå¦‚<code>font_smliey_36</code>ï¼Œ36è¡¨ç¤ºå­—å·å¤§å°ï¼Œè¿™æ ·å°±æ¸…æ™°æ˜äº†ï¼</p><blockquote><ol start="2"><li>Size</li></ol></blockquote><p>å¡«å†™å­—å·å¤§å°ï¼Œåˆšåˆšæˆ‘ä»¬åå­—å†™äº†<code>font_smliey_36</code>ï¼Œå­—å·æ˜¯36ï¼Œé‚£æˆ‘ä»¬è¿™é‡Œå°±å¡«å†™36pxçš„å­—å·å¤§å°ã€‚</p><blockquote><ol start="3"><li>Bpp(bit-per-piel)</li></ol></blockquote><p>å¡«å†™Bppä¸º4ï¼Œè¿™ä¸ªå€¼ä¼šè®©å­—ä½“çœ‹èµ·æ¥æ›´é¡ºæ»‘è€Œä¸”å æ®çš„å†…å­˜ç©ºé—´ç›¸å¯¹ä¸å¤§ï¼ˆå¡«åˆ«çš„ä¹Ÿè¡Œï¼Œè‡ªå·±å°è¯•å¯¹æ¯”ä¸€ä¸‹</p><blockquote><ol start="4"><li>Fallback</li></ol></blockquote><p>è¿™é‡Œå¡«å†™å’ŒNameä¸€æ ·çš„<code>font_smliey_36</code>å°±è¡Œå•¦ï¼</p><blockquote><ol start="5"><li>ä¸‰ä¸ªé€‰é¡¹æ¡†éƒ½ä¸è¦ç‚¹ï¼åæ­£åœ¨X-TRACKæ²¡æ³•ç”¨ï¼</li></ol></blockquote><blockquote><ol start="6"><li>TTF&#x2F;WOFF file</li></ol></blockquote><p>åœ¨è¿™é‡Œé€‰æ‹©æˆ‘ä»¬å‡†å¤‡å¥½çš„å­—ä½“æ–‡ä»¶ï¼Œæ¨èç”¨<code>ttf</code>æ ¼å¼ã€‚</p><blockquote><ol start="7"><li>Range</li></ol></blockquote><p>è¿™é‡Œæ˜¯è®¾ç½®èŒƒå›´æ¥é€‰æ‹©ä½ çš„.cæ–‡ä»¶éœ€è¦åŒ…å«å“ªäº›æ–‡å­—ï¼ˆSymbolsï¼‰ï¼Œæˆ‘ä»¬ä¸ç”¨è¿™ä¸ªï¼Œè¿™é‡Œç©ºç€ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ä¸‹é¢çš„Symbolsæ é‡Œé¢å†™æˆ‘ä»¬éœ€è¦çš„å­—ã€‚</p><blockquote><ol start="8"><li>Symbols</li></ol></blockquote><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¡«å…¥å¸Œæœ›åœ¨Lvglé‡Œä½¿ç”¨çš„æ–‡å­—ï¼Œæ¯”æ–¹è¯´æˆ‘æƒ³è¦åœ¨Lvglé‡Œæ˜¾ç¤º<code>é¸¡ä½ å¤ªç¾</code>ï¼Œé‚£æˆ‘å°±éœ€è¦åœ¨è¿™ä¸ªæ é‡Œå¡«å…¥<code>é¸¡ä½ å¤ªç¾</code>ã€‚</p><blockquote><ol start="9"><li>ç‚¹å‡»çº¢è‰²çš„ConvertæŒ‰é’®ç­‰å¾….cæ–‡ä»¶çš„æ¸²æŸ“å’Œä¸‹è½½å³å¯ï¼</li></ol></blockquote><h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h3><p>é¦–å…ˆæ‰“å¼€åˆšåˆšç”Ÿæˆçš„.cæ–‡ä»¶ï¼Œå¦‚<code>font_smiley_36.c</code></p><ol><li>æ‰¾åˆ°æ³¨é‡Š<code>KERNING</code>å’Œæ³¨é‡Š<code>ALL CUSTOM DATA</code>ä¹‹é—´çš„ä¸€å¤§ä¸²ï¼Œæ³¨é‡Šæ‰æˆ–è€…åˆ æ‰ï¼</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// é‡Œé¢æ³¨é‡Šæ‰æˆ–è€…åˆ æ‰ï¼</span><br><span class="hljs-comment">/*-----------------</span><br><span class="hljs-comment"> *    KERNING</span><br><span class="hljs-comment"> *----------------*/</span><br><br><br><span class="hljs-comment">/*Map glyph_ids to kern left classes*/</span><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> kern_left_class_mapping[] =<br>&#123;<br>    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>,<br>    <span class="hljs-number">7</span><br>&#125;;<br><br><span class="hljs-comment">/*Map glyph_ids to kern right classes*/</span><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> kern_right_class_mapping[] =<br>&#123;<br>    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>,<br>    <span class="hljs-number">6</span><br>&#125;;<br><br><span class="hljs-comment">/*Kern values between classes*/</span><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">int8_t</span> kern_class_values[] =<br>&#123;<br>    <span class="hljs-number">0</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<br>    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-12</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">-12</span>,<br>    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">-12</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-12</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">-17</span>,<br>    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">0</span>,<br>    <span class="hljs-number">0</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-6</span>,<br>    <span class="hljs-number">-12</span>, <span class="hljs-number">0</span><br>&#125;;<br><br><br><span class="hljs-comment">/*Collect the kern class&#x27; data in one place*/</span><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">lv_font_fmt_txt_kern_classes_t</span> kern_classes =<br>&#123;<br>    .class_pair_values   = kern_class_values,<br>    .left_class_mapping  = kern_left_class_mapping,<br>    .right_class_mapping = kern_right_class_mapping,<br>    .left_class_cnt      = <span class="hljs-number">7</span>,<br>    .right_class_cnt     = <span class="hljs-number">6</span>,<br>&#125;;<br><br><span class="hljs-comment">/*--------------------</span><br><span class="hljs-comment"> *  ALL CUSTOM DATA</span><br><span class="hljs-comment"> *--------------------*/</span><br></code></pre></td></tr></table></figure><ol start="2"><li>å°†æ³¨é‡Š<code>ALL CUSTOM DATA</code>å’Œæ³¨é‡Š<code>PUBLIC FONT</code>ä¹‹é—´çš„ä¸€å¤§å¨ï¼Œç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢æ‰ï¼</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// ç”¨å®ƒä»¬æ›¿æ¢æ‰åŸæ¥çš„ä¸€å¤§å¨ï¼</span><br><span class="hljs-comment">/*--------------------</span><br><span class="hljs-comment"> *  ALL CUSTOM DATA</span><br><span class="hljs-comment"> *--------------------*/</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> LV_VERSION_CHECK(8, 0, 0)</span><br><span class="hljs-comment">/*Store all the custom data of the font*/</span><br><span class="hljs-type">static</span>  <span class="hljs-type">lv_font_fmt_txt_glyph_cache_t</span> cache;<br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">lv_font_fmt_txt_dsc_t</span> font_dsc = &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br><span class="hljs-type">static</span> <span class="hljs-type">lv_font_fmt_txt_dsc_t</span> font_dsc = &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    .glyph_bitmap = glyph_bitmap,<br>    .glyph_dsc = glyph_dsc,<br>    .cmaps = cmaps,<br>    .kern_dsc = <span class="hljs-literal">NULL</span>,<br>    .kern_scale = <span class="hljs-number">0</span>,<br>    .cmap_num = <span class="hljs-number">1</span>,<br>    .bpp = <span class="hljs-number">4</span>,<br>    .kern_classes = <span class="hljs-number">0</span>,<br>    .bitmap_format = <span class="hljs-number">0</span>,<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> LV_VERSION_CHECK(8, 0, 0)</span><br>    .cache = &amp;cache<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;;<br><br><span class="hljs-comment">/*-----------------</span><br><span class="hljs-comment"> *  PUBLIC FONT</span><br><span class="hljs-comment"> *----------------*/</span><br><br></code></pre></td></tr></table></figure><ol start="3"><li>æœ€åï¼Œåˆ é™¤æ³¨é‡Š<code>PUBLIC FONT</code>ä¸‹çš„<code>.fallback</code>å’Œ<code>.user_data</code></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// åˆ é™¤ä»¥ä¸‹ä¸¤æ¡ï¼</span><br><span class="hljs-comment">/*-----------------</span><br><span class="hljs-comment"> *  PUBLIC FONT</span><br><span class="hljs-comment"> *----------------*/</span><br><br>    <span class="hljs-comment">// ...</span><br><br>    .fallback = &amp;font_smiley_36,<br>    .user_data = <span class="hljs-literal">NULL</span>,<br></code></pre></td></tr></table></figure><ol start="4"><li>æœ€åæ‹¿å»Lvglè·‘ä¸€ä¸‹ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰é—®é¢˜å•¦ï¼</li></ol><h2 id="Pictures-convert-å›¾ç‰‡æ ¼å¼è½¬æ¢æˆ-cæ–‡ä»¶"><a href="#Pictures-convert-å›¾ç‰‡æ ¼å¼è½¬æ¢æˆ-cæ–‡ä»¶" class="headerlink" title="Pictures convert å›¾ç‰‡æ ¼å¼è½¬æ¢æˆ.cæ–‡ä»¶"></a>Pictures convert å›¾ç‰‡æ ¼å¼è½¬æ¢æˆ.cæ–‡ä»¶</h2><ul><li><strong>æœªå®Œå¾…ç»­</strong></li></ul>]]></content>
    
    
    <categories>
      
      <category>Study Page</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Lvgl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Power By Hugo@kkl</title>
    <link href="/2024/01/01/WelcomePage/hello-world/"/>
    <url>/2024/01/01/WelcomePage/hello-world/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢"><a href="#æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢" class="headerlink" title="æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢"></a>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢</h1><h1 id="Welcome-to-MyBlog"><a href="#Welcome-to-MyBlog" class="headerlink" title="Welcome to MyBlog"></a>Welcome to MyBlog</h1><h3 id="Author-kkl"><a href="#Author-kkl" class="headerlink" title="Author: @kkl"></a>Author: @kkl</h3><h3 id="Wallpaper-Source-kelvinLi"><a href="#Wallpaper-Source-kelvinLi" class="headerlink" title="Wallpaper Source: kelvinLi"></a>Wallpaper Source: kelvinLi</h3>]]></content>
    
    
    
    <tags>
      
      <tag>SayHi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MyRaspberryPiLearningGuide</title>
    <link href="/2023/12/28/MyRaspberryPiLearningGuide/MyRaspberryPiLearningGuide/"/>
    <url>/2023/12/28/MyRaspberryPiLearningGuide/MyRaspberryPiLearningGuide/</url>
    
    <content type="html"><![CDATA[<h1 id="My-Raspberry-Pi"><a href="#My-Raspberry-Pi" class="headerlink" title="My Raspberry Pi"></a>My Raspberry Pi</h1><h1 id="Author-kkl"><a href="#Author-kkl" class="headerlink" title="Author: @kkl"></a>Author: @kkl</h1><hr><h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><blockquote><ul><li>ç¡¬ä»¶ï¼šraspberry Pi 4B</li><li>é•œåƒç‰ˆæœ¬ï¼š2022-09-22-raspios-bullseye-arm64.img</li></ul></blockquote><hr><h2 id="é•œåƒçƒ§å½•"><a href="#é•œåƒçƒ§å½•" class="headerlink" title="é•œåƒçƒ§å½•"></a>é•œåƒçƒ§å½•</h2><ul><li>è¿™æ­¥å°±æ˜¯å¹³å¸¸çš„çƒ§å½•è¿‡ç¨‹ï¼Œæ¨èä½¿ç”¨å®˜æ–¹çš„çƒ§å½•å·¥å…·ï¼Œè¿™æ ·å‰æœŸå¯ä»¥æ’å¾ˆå¤šå‘ï¼ˆè¿™äº›å‘åé¢æˆ‘ä»¬ä¼šé€ä¸€æåˆ°ï¼‰</li></ul><hr><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><ul><li><strong>åˆæ¬¡ç™»å½•çš„æ—¶ï¼Œè¿™ä¸ªåœ°æ–¹æœ‰ä¸ªå¤§å‘ï¼</strong></li></ul><blockquote><p>æœ€æ–°ç‰ˆçš„æ ‘è“æ´¾ç³»ç»Ÿï¼ˆ2022å¹´4æœˆä»¥åŠä»¥åå‘å¸ƒçš„ï¼‰ï¼Œ<strong>æ²¡æœ‰äº†åˆå§‹åŒ–çš„ç”¨æˆ·åå’Œå¯†ç </strong>ï¼Œä»¥å‰ç”¨æˆ·åæ˜¯piï¼Œå¯†ç æ˜¯raspberryï¼Œä½†æ˜¯è¿™æ¬¡éœ€è¦è¿›ç³»ç»Ÿä¹‹åæ‰èƒ½è®¾ç½®ã€‚</p></blockquote><blockquote><p>æ„æ€å°±æ˜¯ï¼Œä½ å¦‚æœåˆæ¬¡ç™»å½•ï¼Œå¦‚æœæ²¡æœ‰ç”¨å›¾å½¢åŒ–ç•Œé¢ï¼Œæ— æ³•åˆ›å»ºä½ çš„ä¸ªäººç”¨æˆ·ï¼Œä½ ä¹Ÿæ— æ³•åƒä»¥å‰ä¸€æ ·ç›´æ¥ä½¿ç”¨é»˜è®¤è´¦å·å¯†ç è¿›è¡Œç™»å½•ã€‚</p></blockquote><blockquote><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p><ul><li>ä½¿ç”¨å®˜æ–¹çš„çƒ§å½•å·¥å…·ï¼Œçƒ§å½•çš„æ—¶å€™ä¼šè®©ä½ é…ç½®åˆå§‹è´¦å·å¯†ç ã€‚</li><li>å¤–æ¥å±å¹•ã€é”®é¼ ï¼Œä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢å¼€æœºé…ç½®ã€‚</li></ul></blockquote><ul><li>æˆ‘ä»¬é‡ç‚¹æ¥äº†è§£ä¸€ä¸‹ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œ<strong>ä½¿ç”¨ä¸²å£æ— å±å¹•çš„ç™»å½•</strong>ã€‚</li></ul><ol><li>å¾€çƒ§å½•å¥½é•œåƒçš„SDå¡æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶<code>userconf.txt</code></li><li>æ–‡ä»¶å†…å†™å…¥<code>pi:$6$/4.VdYgDm7RJ0qM1$FwXCeQgDKkqrOU3RIRuDSKpauAbBvP11msq9X58c8Que2l1Dwq3vdJMgiZlQSbEXGaY5esVHGBNbCxKLVNqZW1</code><blockquote><p>è¿™ä¸€æ®µæ„æ€å°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œæ–°å»ºä¸€ä¸ªç”¨æˆ·<br>ç”¨æˆ·åï¼špi<br>å¯†ç ï¼šraspberry</p></blockquote></li><li>æœ€åæŠŠSDå¡æ’å›åˆ°æ ‘è“æ´¾ä¸Šï¼Œé‡æ–°ä¸Šç”µï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªç”¨æˆ·å¯†ç ç™»å½•å•¦ï¼</li></ol><h3 id="ä¸²å£ç™»å½•"><a href="#ä¸²å£ç™»å½•" class="headerlink" title="ä¸²å£ç™»å½•"></a>ä¸²å£ç™»å½•</h3><ul><li><p>ä¸²å£ç™»å½•æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªUSB-TTL Linkï¼</p></li><li><p>æ’é’ˆè¿æ¥å›¾ï¼ˆ<strong>æ­¤æ—¶TypeCå£æœå‘æˆ‘ä»¬æ—¶ï¼Œå³USB-Aå£æœå‘å³æ‰‹è¾¹æ—¶</strong>ï¼‰ï¼š</p><blockquote><p><strong>&#x2F; * * G T R * * * * * * * * * * * * * * &#x2F;</strong><br><strong>&#x2F; * * * * * * * * * * * * * * * * * * * &#x2F;</strong><br><strong>G-&gt;GND &#x2F; T-&gt;TXD &#x2F; R-&gt;RXD</strong></p></blockquote></li><li><p>æ¥ç€æ£€æŸ¥çƒ§å½•å¥½é•œåƒçš„SDå¡æ ¹ç›®å½•ä¸‹çš„<code>cmdline.txt</code></p><blockquote><p>å¦‚æœæ²¡æœ‰<code>console=serial0,115200</code>å°±è‡ªå·±åœ¨æœ€å‰é¢åŠ ä¸Šå»ï¼Œç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€å’Œå…¶ä»–çš„æŒ‡ä»¤å°±è¡Œ</p></blockquote></li><li><p>æ¥ç€ä¿®æ”¹çƒ§å½•å¥½é•œåƒçš„SDå¡æ ¹ç›®å½•ä¸‹çš„<code>config.txt</code></p><blockquote><p>åœ¨è¯¥æ–‡ä»¶çš„æœ€åä¸€è¡ŒåŠ ä¸Š<code>dtoverlay=pi3-miniuart-bt</code></p></blockquote></li><li><p>è¿™æ—¶è¿æ¥ä¸²å£å°±ä¼šæ‰“å°loginé¡µé¢ä¿¡æ¯å•¦ï¼Œè®°å¾—ä¸²å£è¿æ¥é€‰æ‹©<strong>æ³¢ç‰¹ç‡ä¸º115200ï¼Œæ— æµæ§æ¨¡å¼</strong>å™¢ï¼</p></li><li><p>å¦‚æœæ²¡æœ‰ä»»ä½•ä¸œè¥¿æ˜¾ç¤ºå‡ºæ¥ï¼Œå›å»é€ä¸€æ£€æŸ¥ï¼Œæ£€æŸ¥ç¡¬ä»¶æ˜¯ä¸æ˜¯æ’é”™å•¦ï¼Œè¦<strong>Linkçš„Txå¯¹Piçš„Rxï¼ŒLinkçš„Rxå¯¹Piçš„Tx</strong>ï¼</p></li></ul><h3 id="SSHç™»å½•"><a href="#SSHç™»å½•" class="headerlink" title="SSHç™»å½•"></a>SSHç™»å½•</h3><p>æ ‘è“æ´¾åˆæ¬¡é…ç½®SSHç™»å½•å…¶å®ä¹ŸæŒºéº»çƒ¦çš„ï¼Œä¸‹é¢æ¼”ç¤ºä¸€ä¸‹é…ç½®æ­¥éª¤ã€‚</p><ul><li><p>åœ¨çƒ§å½•å¥½é•œåƒçš„SDå¡æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶<code>ssh</code>ï¼Œç©ºæ–‡ä»¶å°±è¡Œï¼Œå‘½åå¥½ä»¥åä¸ç”¨å»åŠ¨å®ƒ</p></li><li><p>åŒæ ·çš„åœ¨æ ¹ç›®å½•ä¸‹å†æ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶<code>wpa_supplicant.conf</code></p></li><li><p>ä½¿ç”¨ç¼–è¯‘å™¨æ‰“å¼€ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨<code>Vscode</code></p></li><li><p>æ‰“å¼€ä»¥åè¾“å…¥ä»¥ä¸‹é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs conf">country=CN<br>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev<br>update_config=1<br> <br>network=&#123;<br>    ssid=&quot;EMMA&quot;<br>    psk=&quot;12345678&quot;<br>    priority=1<br>&#125;<br> <br>network=&#123;<br>    ssid=&quot;HUGO&quot;<br>    psk=&quot;12345678&quot;<br>    priority=2<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è§£é‡Šä¸€ä¸‹ï¼š<br><code>ssid</code>æ˜¯å°†è¦è¿æ¥çš„wifiçš„åå­—ï¼Œä¸èƒ½æœ‰ä¸­æ–‡ï¼<br><code>psk</code>æ˜¯å°†è¦è¿æ¥çš„wifiçš„å¯†ç <br><code>priority</code>æ˜¯è¿æ¥çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§æ•°å­—å¤§çš„wifiä¼˜å…ˆè¿æ¥<br>ä½ å¯ä»¥æŒ‰ç…§æ ¼å¼æ¥è®°å½•å¤šä¸ªwifiï¼Œæ³¨æ„ä¼˜å…ˆçº§ä¸è¦éƒ½ç›¸åŒã€‚</p></blockquote></li><li><p>ä¸Šè¿°æ­¥éª¤å®Œæˆä»¥åï¼ŒæŠŠSDå¡æ’å›æ ‘è“æ´¾ä¸­è¿è¡Œï¼Œ<code>ssh</code>å’Œ<code>wpa_supplicant.conf</code>æ–‡ä»¶éƒ½ä¼šè‡ªåŠ¨è¢«å†™å…¥ç³»ç»Ÿï¼Œå†™å…¥æˆåŠŸåå†æ¬¡ç”¨ç”µè„‘æ‰“å¼€SDå¡è¿™ä¸¤ä¸ªæ–‡ä»¶ä¼šæ¶ˆå¤±ä¸è§ã€‚å¦‚æœä½ è¦æ·»åŠ æˆ–è€…ä¿®æ”¹wifiï¼Œä½ éœ€è¦æŠŠ<code>wpa_supplicant.conf</code>æ–‡ä»¶é‡æ–°å†™ä¸€éï¼Œé‡å¤ä¸Šè¿°æ“ä½œï¼Œæ–°çš„æ–‡ä»¶ä¼šè‡ªåŠ¨è¦†ç›–æ—§çš„ï¼›<code>ssh</code>ä¸ç”¨é‡æ–°åˆ›å»ºï¼Œä¹‹å‰åˆ›å»ºè¿‡äº†å°±å¯ä»¥äº†ã€‚</p></li><li><p>é‡æ–°ç»™æ ‘è“æ´¾ä¸Šç”µè¿›å…¥ç³»ç»Ÿä»¥åï¼Œä½ å¯èƒ½ä¼šå‘ç°ä»¥ä¸‹é—®é¢˜è­¦å‘Š<code>Wi-Fi is currently blocked by rfkill. Use raspi-config to set the country before use.</code></p></li><li><p>è¿™æ˜¯æˆ‘ä»¬æ²¡æœ‰è®¾ç½®æ— çº¿å±€åŸŸç½‘æ‰€åœ¨å›½å®¶ï¼Œäºæ˜¯æˆ‘ä»¬è¾“å…¥æŒ‡ä»¤<code>sudo raspi-config nonint do_wifi_country CN</code>ï¼Œé¡ºåˆ©çš„è¯å†è¾“å…¥æŒ‡ä»¤<code>ifconfig</code>ä¼šæŸ¥çœ‹åˆ°wlan0å·²ç»è¢«åˆ†é…äº†ipåœ°å€ï¼</p></li><li><p>å¦‚æœå¹³æ—¶åœ¨åŒä¸€å±€åŸŸç½‘ä¸‹æˆ‘ä»¬ä¸çŸ¥é“æ ‘è“æ´¾ipåœ°å€æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Windows<code>win+R</code>è¾“å…¥cmdæ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥æŒ‡ä»¤<code>ping raspberrypi -4</code>ï¼Œå¯ä»¥æŸ¥è¯¢åŒä¸€å±€åŸŸç½‘å½“ä¸­çš„æ ‘è“æ´¾çš„ipåœ°å€ã€‚</p></li><li><p>æ‹¿åˆ°ipåœ°å€å°±å¯ä»¥æ„‰å¿«çš„è¿œç¨‹è®¿é—®å•¦ï¼</p></li></ul><h3 id="VNCè¿œç¨‹æ¡Œé¢ç™»å½•"><a href="#VNCè¿œç¨‹æ¡Œé¢ç™»å½•" class="headerlink" title="VNCè¿œç¨‹æ¡Œé¢ç™»å½•"></a>VNCè¿œç¨‹æ¡Œé¢ç™»å½•</h3><ul><li>é—®é¢˜1ï¼šVNC Vieweræ˜¾ç¤º<code>Cannot currently show the desktop</code></li></ul><blockquote><p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p></blockquote><p>å‡ºç°è¿™ä¸ªæ— æ³•æ˜¾ç¤ºè¿œç¨‹æ¡Œé¢çš„é—®é¢˜ï¼Œå…¶å®æ˜¯æ ‘è“æ´¾é…ç½®åˆ†è¾¨ç‡çš„å…³ç³»ï¼Œæ ‘è“æ´¾é»˜è®¤ä½¿ç”¨äº†æœ€å°åˆ†è¾¨ç‡ï¼Œç„¶åVNCä¸æ”¯æŒè¿™ä¹ˆå°çš„ï¼Œå’±æ”¹ä¸€ä¸‹å°±è¡Œã€‚</p><blockquote><p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p></blockquote><ul><li><code>sudo raspi-config</code>æ‰“å¼€è®¾ç½®ç•Œé¢</li><li>æŒ‰æ–¹å‘é”®å‘ä¸‹é€‰æ‹©åˆ°<code>Display Options</code></li><li>æ¥ç€ç»§ç»­é€‰æ‹©<code>VNC Resolution</code></li><li>æ¥ç€é€‰æ‹©é™¤äº†<code>640x480</code>ä»¥å¤–çš„åˆ†è¾¨ç‡</li><li>ç„¶åå›è½¦ç¡®å®šï¼Œæ–¹å‘é”®å·¦å³é€‰æ‹©<code>finish</code>é€€å‡ºï¼Œç„¶åç¡®è®¤rebooté‡å¯ï¼Œé€‰æ‹©<code>yes</code></li><li>æœ€åç­‰å¾…é‡å¯å°±è¡Œå•¦ï¼</li></ul><hr><h2 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h2><p>è¯·å‚ç…§<strong>ç™»å½•</strong>ç« èŠ‚å½“ä¸­çš„<strong>SSHç™»å½•</strong>ï¼</p>]]></content>
    
    
    <categories>
      
      <category>Study Page</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>RaspberryPi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æˆ‘çš„Linuxé©±åŠ¨å­¦ä¹ ç¬”è®°</title>
    <link href="/2023/12/13/MyLinuxLearningGuide/MyLinuxLearningGuide/"/>
    <url>/2023/12/13/MyLinuxLearningGuide/MyLinuxLearningGuide/</url>
    
    <content type="html"><![CDATA[<h1 id="æˆ‘çš„Linuxé©±åŠ¨å­¦ä¹ ç¬”è®°"><a href="#æˆ‘çš„Linuxé©±åŠ¨å­¦ä¹ ç¬”è®°" class="headerlink" title="æˆ‘çš„Linuxé©±åŠ¨å­¦ä¹ ç¬”è®°"></a>æˆ‘çš„Linuxé©±åŠ¨å­¦ä¹ ç¬”è®°</h1><h1 id="MyLinuxLearningGuide"><a href="#MyLinuxLearningGuide" class="headerlink" title="MyLinuxLearningGuide"></a>MyLinuxLearningGuide</h1><h2 id="By-kkl"><a href="#By-kkl" class="headerlink" title="By @kkl"></a>By @kkl</h2><hr><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li>è¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€æ•´</li></ul><h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><h2 id="é…ç½‘"><a href="#é…ç½‘" class="headerlink" title="é…ç½‘"></a>é…ç½‘</h2><ul><li><p><code>cd /etc/</code>å»åˆ°æ­¤æ–‡ä»¶å¤¹å½“ä¸­</p></li><li><p>ç¼–å†™<code>wpa_supplicant.conf</code></p><blockquote><p>ctrl_interface&#x3D;&#x2F;var&#x2F;run&#x2F;wpa_supplicant<br>update_config&#x3D;1</p><p>network&#x3D;{<br> ssid&#x3D;â€MagicEyesâ€<br> psk&#x3D;â€12345678â€<br>}</p></blockquote></li><li><p><code>vi wpa_supplicant.conf</code>ç”¨vimæ‰“å¼€è¿™ä¸ªæ–‡ä»¶é…ç½®ä½ çš„ç½‘ç»œ</p></li><li><p><code>wpa_supplicant -D wext -c /etc/wpa_supplicant.conf -i wlan0 &amp;</code></p></li><li><p><code>udhcpc -i wlan0</code></p></li><li><p>æ›´åŠ è¯¦ç»†çš„å†…å®¹åœ¨<strong>é©±åŠ¨å¼€å‘æŒ‡å—P1765</strong></p></li></ul><h2 id="å†…æ ¸"><a href="#å†…æ ¸" class="headerlink" title="å†…æ ¸"></a>å†…æ ¸</h2><h3 id="å†…æ ¸ç¼–è¯‘"><a href="#å†…æ ¸ç¼–è¯‘" class="headerlink" title="å†…æ ¸ç¼–è¯‘"></a>å†…æ ¸ç¼–è¯‘</h3><ul><li><p><code>Uboot</code>å’Œå†…æ ¸çš„ç¼–è¯‘æ­¥éª¤ï¼š</p><blockquote><ol><li><code>distclean</code>æ¸…ç†å·¥ç¨‹</li><li><code>make xxx_defconfig</code>ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶é…ç½®å·¥ç¨‹</li><li><code>make menuconfig</code>æ‰“å¼€é…ç½®ç•Œé¢ï¼Œè¿›è¡Œé…ç½®</li><li><code>make -j12</code>ç¼–è¯‘æ‰€æœ‰æ–‡ä»¶ï¼Œ<code>-j12</code>è¡¨ç¤ºåäºŒæ ¸ç¼–è¯‘</li></ol><ul><li>ç¼–è¯‘çš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿</li></ul></blockquote></li><li><p>Plus:</p><blockquote><p><strong>å†…æ ¸çš„è§£å‹å’Œç¼–è¯‘ç»å¯¹ä¸å¯ä»¥åœ¨å…±äº«æ–‡ä»¶å¤¹é‡Œè¿›è¡Œï¼</strong><br>å¦åˆ™ä¼šå‡ºç°æ— æ³•è½¯é“¾æ¥çš„æƒ…å†µï¼Œæ¯”å¦‚<code>ln: failed to create symbolic link &#39;./dt-bindings&#39;: Operation not permitted</code><br>å› ä¸ºå…±äº«æ–‡ä»¶å¤¹æ˜¯windowså’Œlinuxçš„çš„å…±äº«ç›®å½•ï¼Œè€Œwindowsä¸‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¸æ”¯æŒlinuxçš„<code>symbolic link</code>!</p></blockquote></li><li><p>è¿™é‡Œçš„ç¼–è¯‘çš„å†…æ ¸é€‰ç”¨<code>linux-imx-4.1.15-2.1.0-g3dc0a4b-v2.7.tar.bz2</code>å³æ­£ç‚¹åŸå­imx6ullçš„å‡ºå‚é•œåƒ</p></li><li><p>è§£å‹æ–¹æ³•ï¼š<code>tar -vxjf xxx.tar.bz2</code></p></li><li><p>æ³¨æ„ï¼ç¼–è¯‘å†…æ ¸æ—¶ï¼Œè¯·å…ˆå®‰è£…Pokyäº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼ˆå…·ä½“å‚ç…§<strong>ç”¨æˆ·å¿«é€Ÿä½“éªŒP115</strong>ï¼‰</p></li><li><p>æœ€åè¯·ä½¿ç”¨<strong>04ã€æ­£ç‚¹åŸå­MFG_TOOLå‡ºå‚å›ºä»¶çƒ§å½•å·¥å…·</strong>è¿›è¡Œå¼€å‘æ¿çš„çƒ§å½•å“¦ï¼</p></li></ul><h2 id="é©±åŠ¨å¼€å‘"><a href="#é©±åŠ¨å¼€å‘" class="headerlink" title="é©±åŠ¨å¼€å‘"></a>é©±åŠ¨å¼€å‘</h2><ul><li>Linuxé©±åŠ¨æœ‰<strong>ä¸¤ç§è¿è¡Œæ–¹å¼</strong>ï¼Œ<strong>ç¬¬ä¸€ç§</strong>å°±æ˜¯å°†é©±åŠ¨<strong>ç¼–è¯‘è¿›Linuxå†…æ ¸</strong>ä¸­ï¼Œè¿™æ ·å½“Linuxå†…æ ¸å¯åŠ¨çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨è¿è¡Œé©±åŠ¨ç¨‹åºã€‚<strong>ç¬¬äºŒç§</strong>å°±æ˜¯<strong>å°†é©±åŠ¨ç¼–è¯‘æˆæ¨¡å—</strong>(Linuxä¸‹æ¨¡å—æ‰©å±•åä¸º.ko)ï¼Œåœ¨Linuxå†…æ ¸å¯åŠ¨ä»¥åä½¿ç”¨<code>insmod</code>æˆ–<code>modprobe</code>å‘½ä»¤åŠ è½½é©±åŠ¨æ¨¡å—ï¼Œä½¿ç”¨<code>rmmod</code>æˆ–<code>modprobe -r</code>å‘½ä»¤å¸è½½é©±åŠ¨æ¨¡å—ã€‚</li></ul><h3 id="é©±åŠ¨æ¨¡å—çš„åŠ è½½ä¸å¸è½½"><a href="#é©±åŠ¨æ¨¡å—çš„åŠ è½½ä¸å¸è½½" class="headerlink" title="é©±åŠ¨æ¨¡å—çš„åŠ è½½ä¸å¸è½½"></a>é©±åŠ¨æ¨¡å—çš„åŠ è½½ä¸å¸è½½</h3><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><ul><li>Linuxçš„é©±åŠ¨ç¨‹åºå¯ä»¥ç¼–è¯‘åˆ°<code>kernel</code>é‡Œé¢ï¼ˆä¹Ÿå°±æ˜¯<code>zImage</code>ï¼‰ï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘ä¸ºæ¨¡å—<code>.ko</code>ã€‚æµ‹è¯•çš„æ—¶å€™åªéœ€è¦åŠ è½½<code>.ko</code>æ¨¡å—å°±å¯ä»¥ã€‚</li><li>ç¼–å†™é©±åŠ¨æ—¶çš„æ³¨æ„äº‹é¡¹<blockquote><ul><li>ç¼–è¯‘é©±åŠ¨çš„æ—¶å€™éœ€è¦ç”¨åˆ°Linuxå†…æ ¸æºç ï¼å› æ­¤è¦è§£å‹ç¼©Linuxå†…æ ¸æºç ï¼Œç¼–è¯‘Linuxå†…æ ¸æºç ï¼ç¼–è¯‘å®Œæˆä¼šå¾—åˆ°<code>zImage</code>å’Œ<code>.dtb</code>è®¾å¤‡æ ‘ã€‚éœ€è¦ä½¿ç”¨ç¼–è¯‘åå¾—åˆ°çš„<code>zImage</code>å’Œ<code>.dtb</code>å¯åŠ¨ç³»ç»Ÿã€‚</li></ul></blockquote></li></ul><h4 id="é©±åŠ¨æ¨¡å—çš„Makefile"><a href="#é©±åŠ¨æ¨¡å—çš„Makefile" class="headerlink" title="é©±åŠ¨æ¨¡å—çš„Makefile"></a>é©±åŠ¨æ¨¡å—çš„Makefile</h4><ul><li>Makefileçš„é€šç”¨å†™æ³•<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Makefile">KERNELDIR := /home/embedfire/kl_files/linux/IMX6ULL/linux<br>CURRENT_PATH := <span class="hljs-variable">$(<span class="hljs-built_in">shell</span> pwd)</span><br>obj-m := chrdevbase.o<br><br>build : kernel_modules<br><br><span class="hljs-section">kernel_modules:</span><br><span class="hljs-variable">$(MAKE)</span> -C <span class="hljs-variable">$(KERNELDIR)</span> M=<span class="hljs-variable">$(CURRENT_PATH)</span> modules<br><span class="hljs-section">clean:</span><br><span class="hljs-variable">$(MAKE)</span> -C <span class="hljs-variable">$(KERNELDIR)</span> M=<span class="hljs-variable">$(CURRENT_PATH)</span> clean<br></code></pre></td></tr></table></figure></li><li>æ³¨æ„è¦ä¿®æ”¹<code>c_cpp_properties.json</code>å½“ä¸­çš„è·¯å¾„å“¦ï¼ï¼ˆä¿®æ”¹äº†ä½ å°±å¯ä»¥å†™ä»£ç çš„æ—¶å€™æœ‰è¡¥å…¨ï¼Œä¸ç®¡å®ƒå¯¹æ¨¡å—çš„ç¼–è¯‘å’Œåº”ç”¨æ²¡å½±å“ï¼‰</li></ul><h4 id="é©±åŠ¨æ¨¡å—çš„ç¼–è¯‘"><a href="#é©±åŠ¨æ¨¡å—çš„ç¼–è¯‘" class="headerlink" title="é©±åŠ¨æ¨¡å—çš„ç¼–è¯‘"></a>é©±åŠ¨æ¨¡å—çš„ç¼–è¯‘</h4><ul><li><p><code>make</code>åœ¨Makefileå­˜æ”¾çš„ç›®å½•ä¸‹æ‰§è¡Œè¯¥å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘å®Œæˆåç”Ÿæˆ<code>.ko</code>æ¨¡å—</p></li><li><p><code>make clean</code>ç”¨äºæ¸…ç†ç¼–è¯‘ç”Ÿæˆçš„æ¨¡å—ç­‰æ–‡ä»¶</p></li><li><p>è¯·åœ¨ä½¿ç”¨<code>make</code>å‘½ä»¤ä¹‹å‰å…ˆä½¿ç”¨æ­¤å‘½ä»¤é€‰æ‹©äº¤å‰å·¥å…·é“¾<code>source /opt/fsl-imx-x11/4.1.15-2.1.0/environment-setup-cortexa7hf-neon-poky-linux-gnueabi</code></p></li><li><p>ç¼–è¯‘åº”ç”¨<code>arm-linux-gnueabihf-gcc chrdevbaseApp.c -o chrdevbaseApp</code></p></li></ul><h4 id="æ¨¡å—åŠ è½½å’Œå¸è½½å‘½ä»¤"><a href="#æ¨¡å—åŠ è½½å’Œå¸è½½å‘½ä»¤" class="headerlink" title="æ¨¡å—åŠ è½½å’Œå¸è½½å‘½ä»¤"></a>æ¨¡å—åŠ è½½å’Œå¸è½½å‘½ä»¤</h4><blockquote><p>æ¨¡å—çš„åŠ è½½</p></blockquote><ul><li><code>insmod</code>å…·ä½“ç”¨æ³•ï¼š<code>insmod xxx.ko</code></li><li><code>modprobe</code>å…·ä½“ç”¨æ³•ï¼š<code>modprobe xxx</code>ï¼Œè®°å¾—ä½¿ç”¨ä¹‹å‰ç”¨<code>depmod</code>åˆ·æ–°å½“å‰çš„æ¨¡å—å˜é‡å“¦ï¼</li><li>åŠ è½½å®Œæˆå¯ä»¥ä½¿ç”¨<code>cat \proc\devices</code>æŸ¥çœ‹æ¨¡å—çš„è®¾å¤‡å·å“¦ï¼</li></ul><blockquote><p>æ¨¡å—çš„å¸è½½</p></blockquote><ul><li><code>rmmod</code>å…·ä½“ç”¨æ³•ï¼š<code>rmmod xxx.ko</code></li><li><code>modprobe -r</code>å…·ä½“ç”¨æ³•ï¼š<code>modprobe -r xxx</code></li></ul><hr><h2 id="è®¾å¤‡æ ‘"><a href="#è®¾å¤‡æ ‘" class="headerlink" title="è®¾å¤‡æ ‘"></a>è®¾å¤‡æ ‘</h2><hr><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><h3 id="æ‰“å¼€æœ‰ç®¡ç†å‘˜æƒé™çš„æ–‡ä»¶ç®¡ç†å™¨"><a href="#æ‰“å¼€æœ‰ç®¡ç†å‘˜æƒé™çš„æ–‡ä»¶ç®¡ç†å™¨" class="headerlink" title="æ‰“å¼€æœ‰ç®¡ç†å‘˜æƒé™çš„æ–‡ä»¶ç®¡ç†å™¨"></a>æ‰“å¼€æœ‰ç®¡ç†å‘˜æƒé™çš„æ–‡ä»¶ç®¡ç†å™¨</h3><ul><li><code>sudo nautilus</code></li></ul><h3 id="åˆ é™¤éç©ºæ–‡ä»¶å¤¹"><a href="#åˆ é™¤éç©ºæ–‡ä»¶å¤¹" class="headerlink" title="åˆ é™¤éç©ºæ–‡ä»¶å¤¹"></a>åˆ é™¤éç©ºæ–‡ä»¶å¤¹</h3><ul><li><code>rm -r xxx</code>-rçš„æ„æ€å°±æ˜¯é€’å½’æ“ä½œï¼Œå°†ä¼šåˆ é™¤è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å­æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼</li></ul><h3 id="æŸ¥çœ‹dmesgæ—¥å¿—ä¿¡æ¯"><a href="#æŸ¥çœ‹dmesgæ—¥å¿—ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹dmesgæ—¥å¿—ä¿¡æ¯"></a>æŸ¥çœ‹dmesgæ—¥å¿—ä¿¡æ¯</h3><ul><li><code>dmesg</code>æŠŠä»å¯åŠ¨å¼€å§‹åˆ°å½“å‰æ˜¯æ‰€æœ‰æ—¥å¿—éƒ½æ‰“å°å‡ºæ¥</li><li><code>dmesg | tail</code>é»˜è®¤æ‰“å°æœ€è¿‘çš„åæ¡æ—¥å¿—</li><li><code>dmesg | tail -20</code>æ‰“å°æœ€è¿‘çš„äºŒåæ¡æ—¥å¿—</li></ul><h3 id="æŒ‚è½½SDå¡"><a href="#æŒ‚è½½SDå¡" class="headerlink" title="æŒ‚è½½SDå¡"></a>æŒ‚è½½SDå¡</h3><ol><li>é€šè¿‡<code>fdisk -l</code>ç¡®å®šsdå¡çš„å­˜åœ¨</li><li>åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ï¼Œæˆ‘é€‰æ‹©<code>/mnt/mmc</code></li><li>æŒ‚è½½sdå¡åˆ°æ–°åˆ›å»ºçš„ç©ºæ–‡ä»¶å¤¹<code>mount /dev/mmcblk0p1 /mnt/mmc</code></li></ol><ul><li>å¸è½½å¯ä»¥ä½¿ç”¨<code>umount /mnt/mmc</code>ï¼Œæ³¨æ„å¸è½½çš„æ—¶å€™ä½ æ‰€åœ¨çš„å½“å‰ç›®å½•ä¸èƒ½æ˜¯&#x2F;mntï¼Œå¦åˆ™ä¼šå¸è½½å¤±è´¥çš„ã€‚</li></ul><h3 id="å¤åˆ¶éç©ºæ–‡ä»¶å¤¹"><a href="#å¤åˆ¶éç©ºæ–‡ä»¶å¤¹" class="headerlink" title="å¤åˆ¶éç©ºæ–‡ä»¶å¤¹"></a>å¤åˆ¶éç©ºæ–‡ä»¶å¤¹</h3><ul><li><code>cp -r /home/packageA/* /home/packageB/</code> æˆ–è€…<code>cp /home/packageA/* /home/packageB/</code>æ˜¯æŠŠpackageAä¸­çš„æ–‡ä»¶éƒ½å¤åˆ¶åˆ°packageBä¸­</li><li><code>cp -r /home/packageA/ /home/cp/packageB/</code> æ˜¯ç›´æ¥æŠŠpackageAæ–‡ä»¶å¤¹å¤åˆ¶åˆ°packageBä¸­</li></ul>]]></content>
    
    
    <categories>
      
      <category>Study Page</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>é©±åŠ¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æˆ‘çš„FreeRTOSä½¿ç”¨æŒ‡å—</title>
    <link href="/2023/12/09/MyFreeRTOSLearningGuide/MyFreeRTOSLearningGuide/"/>
    <url>/2023/12/09/MyFreeRTOSLearningGuide/MyFreeRTOSLearningGuide/</url>
    
    <content type="html"><![CDATA[<h1 id="æˆ‘çš„FreeRTOSä½¿ç”¨æŒ‡å—"><a href="#æˆ‘çš„FreeRTOSä½¿ç”¨æŒ‡å—" class="headerlink" title="æˆ‘çš„FreeRTOSä½¿ç”¨æŒ‡å—"></a>æˆ‘çš„FreeRTOSä½¿ç”¨æŒ‡å—</h1><h1 id="MyFreeRTOS-LearningGuide"><a href="#MyFreeRTOS-LearningGuide" class="headerlink" title="MyFreeRTOS-LearningGuide"></a>MyFreeRTOS-LearningGuide</h1><h2 id="By-kkl"><a href="#By-kkl" class="headerlink" title="By @kkl"></a>By @kkl</h2><hr><h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><blockquote><p>æœ¬æŒ‡å—ç€é‡äºFreeRTOSçš„APIä»å…¥é—¨åˆ°å…¥åœŸçš„æ‰€æœ‰ç”¨æ³•ï¼ˆMaybe<br>ä¸ä¼šå¤ªæ·±ç©¶åº•å±‚çš„å†…æ ¸å®ç°ï¼Œå¯èƒ½æœ‰ä¸€äº›ç›¸å…³æ€§å¼ºçš„ä¼šQä¸€ä¸‹<br>ä¼šè®²ä¸€äº›æˆ‘å­¦ä¹ RTOSçš„æ—¶å€™å¡å…³çš„åœ°æ–¹ï¼Œæˆ–è€…æ˜¯è§‰å¾—è«åå…¶å¦™çš„ã€ç†è§£å›°éš¾çš„ç‚¹<br>ä¸»å¼ ä¸€ä¸ªï¼Œçœ‹ç€å°±èƒ½ç”¨ï¼Œæˆ–è€…æ˜¯çœ‹ç€çœ‹ç€å°±ä¼šç”¨ï¼Œè€Œä¸”ç”¨çš„è¿˜ä¸€æºœä¸€æºœçš„FreeRTOSæŒ‡å—</p></blockquote><hr><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li>MCU: STM32F405ï¼ˆç°åœ¨æ˜¯äºŒä¸‰å¹´åäºŒæœˆï¼Œæœ€è¿‘æ‰åå…ƒé’±æ¯ç‰‡ï¼Œä»¥å‰å•ä»·åå¤šå…ƒæˆ‘è¿˜å‚»ä¹ä¹åœ°ä¹°äº†å¥½å¤šâ€¦æ‚²</li><li>å·¥ç¨‹: æ ‡å‡†åº“ + VScode + Keilï¼ˆæ ‡å‡†å¼€å±€</li><li>ç‰ˆæœ¬: FreeRTOSv9.0.0</li></ul><hr><h2 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h2><ul><li>è®²è®²æˆ‘ä»¬æå‰å¿…é¡»è¦çŸ¥é“çš„ä¸€äº›çŸ¥è¯†ç‚¹å’Œæ¦‚å¿µï¼Œä¸ç„¶åé¢çœ‹åˆ°ä»£ç ä¼šç›´æ¥æ‡µåœˆã€‚</li></ul><blockquote><p><strong>1.å †æ ˆ</strong></p><ul><li>ç®€å•æ¥è¯´å°±æ˜¯å†…å­˜åŠ¨æ€åˆ†é…çš„é—®é¢˜ï¼Œæ¯”æ–¹è¯´ä½ ä»£ç è·‘èµ·æ¥ä¹‹åï¼Œä¼šåœ¨æŸå‡½æ•°é‡Œé¢åˆ›å»º<code>ä¸´æ—¶å˜é‡</code>ï¼ˆä¹Ÿå«<code>å±€éƒ¨å˜é‡</code>ï¼‰çš„æ—¶å€™ï¼Œå°±ä¼šç”¨ä¸Šå †æ ˆã€‚</li><li>**æ ˆ(Stack)**ï¼šå°±æ˜¯åœ¨æŸä¸ªå‡½æ•°åˆ›å»ºçš„<code>ä¸´æ—¶å˜é‡</code>çš„å†…å­˜æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç»™ä½ åˆ†é…çš„ã€‚å½“è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨å¸®ä½ é‡Šæ”¾äº†è¿™ä¸ª<code>ä¸´æ—¶å˜é‡</code>çš„å†…å­˜ã€‚</li><li>æ ˆä¹Ÿç”¨åœ¨è§¦å‘ä¸­æ–­çš„æ—¶å€™ï¼Œç”¨äºä¿æŠ¤ç°åœºï¼ˆå½“å‰å‡½æ•°åœ°å€å•Šå¯„å­˜å™¨å€¼å•Šï¼Œæ–¹ä¾¿ä»ä¸­æ–­å›æ¥çš„æ—¶å€™è¿˜åŸç°åœºå“ˆã€‚</li><li>å½“ç„¶æ ˆçš„ä½¿ç”¨è¿˜åŒ…æ‹¬ä½ å‡½æ•°å‚æ•°<code>eg: void Func(int Temp[256])</code>è¿™é‡Œçš„å˜é‡<code>Temp[256]</code>ä¹Ÿæ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨å¸®ä½ ç”³è¯·å†…å­˜ã€‚æ‰€ä»¥ä¸ºå•¥æœ‰æ—¶å€™ç§»æ¤ä¸€äº›å¤§å‹åº“çš„æ—¶å€™ä½ ä»€ä¹ˆéƒ½é…ç½®å¥½äº†å‡½æ•°ä¹Ÿæ²¡æœ‰å‡ºé”™ç¼–è¯‘å™¨å´æŠ¥é”™ï¼ŒåŸå› å¯èƒ½æ˜¯åº“å½“ä¸­çš„æŸäº›å‡½æ•°ç”³è¯·çš„<code>å±€éƒ¨å˜é‡</code>å¤ªå¤§ï¼Œè€Œä½ çš„æ ˆåˆ†é…çš„å¤ªå°å¯¼è‡´çš„ã€‚</li><li>**å †(Heap)**ï¼šå°±æ˜¯mallocæˆ–è€…newï¼Œç®€å•è¯´å°±æ˜¯mallocï¼Œä½ è‡ªå·±åˆ†é…å†…å­˜ï¼Œå½“ç„¶ä¹Ÿè¦ä½ è‡ªå·±å»é‡Šæ”¾freeï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸä¸é‡Šæ”¾å†…å­˜ï¼Œä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</li><li>**é™æ€åŒº(Static)**ï¼šå°±æ˜¯ä½ æ”¾<code>å…¨å±€å˜é‡</code>æˆ–è€…<code>staticä¿®é¥°çš„å˜é‡</code>çš„åœ°æ–¹å•¦ã€‚<blockquote><ul><li>é‚£ä¹ˆåœ¨FreeRTOSä¸­å„ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„å †æ ˆï¼Œä¸€èˆ¬å‘¢æˆ‘ä»¬åªç®¡å†™è¿™ä¸ªä»»åŠ¡éœ€è¦å¤šå¤§çš„å †æ ˆï¼ŒFreeRTOSä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ä»RAMä¸­ç”³è¯·å†…å­˜ã€‚åŒ…æ‹¬ä¿¡å·é‡ã€é˜Ÿåˆ—è¿™äº›éƒ½æ˜¯ã€‚</li><li><code>configSUPPORT_STATIC_ALLOCATION</code>ä¸º0çš„æ—¶å€™ï¼ŒFreeRTOSä¼šä½¿ç”¨<code>heap_x.c(xä¸º 1~5)</code>ä¸­çš„åŠ¨æ€å†…å­˜ç®¡ç†å‡½æ•°æ¥è‡ªåŠ¨ç”³è¯·RAMï¼›å½“æ­¤å®å®šä¹‰ä¸º1çš„æ—¶å€™ï¼Œç”¨æˆ·å¯ä»¥ç»™FreeRTOSæŒ‡å®šä¸€å—é™æ€RAMå†…å­˜ï¼Œä½ å°±å¯ä»¥æ‰§è¡Œç±»ä¼¼<code>xTaskCreateStatic</code>çš„å‡½æ•°å•¦ã€‚ä¸€èˆ¬å’±ä»¬å†™0å°±è¡Œï¼ˆé»˜è®¤ä¹Ÿæ˜¯å†™0çš„</li><li><code>configTOTAL_HEAP_SIZE</code></li><li><code>#define XXX_STK_SIZE 256</code>æ„æ€æ˜¯è®¾ç½®XXXä»»åŠ¡çš„å †æ ˆå¤§å°ä¸º256*4(å­—&#x2F;byte</li></ul></blockquote></li></ul></blockquote><blockquote><p><strong>2.å­—å’Œå­—èŠ‚</strong></p><ul><li><strong>å­—èŠ‚(bit)</strong></li><li><strong>å­—(Byte)</strong> ï¼š1 byte &#x3D; 4 bits</li><li>åœ¨å•ç‰‡æœºä¸­å¯ä»¥ç®€å•çš„æŠŠ<code>byte</code>ç†è§£æˆ<code>char</code>ç±»å‹æˆ–è€…<code>unsigned char</code>ç±»å‹</li></ul></blockquote><blockquote><p><strong>3.é’©å­</strong></p><ul><li>ChatGPTè¯´ï¼ŒFreeRTOSçš„é’©å­å‡½æ•°(Hooks)æ˜¯ä¸€ç»„å¯ç”±ç”¨æˆ·è‡ªå®šä¹‰çš„å›è°ƒå‡½æ•°</li></ul></blockquote><blockquote><p><strong>4.ä¼˜å…ˆçº§</strong></p><ul><li>ä½¿ç”¨FreeRTOSæœ€å¥½æŠŠä¼˜å…ˆçº§åˆ†ç»„é€‰æ‹©ä¸º<code>NVIC_PriorityGroup_4</code>ï¼Œå¯„å­˜å™¨çš„4ä½å­—èŠ‚éƒ½è®¾ç½®ä¸ºæŠ¢å ä¼˜å…ˆçº§ï¼Œè¿™æ ·å°±æœ‰ 0~15 å…±16ä¸ªæŠ¢å ä¼˜å…ˆçº§å¯ä¾›é€‰æ‹©ã€‚å› ä¸ºFreeRTOSçš„ä¸­æ–­é…ç½®é‡Œä¸èƒ½å¤„ç†äºšä¼˜å…ˆçº§ï¼ˆæ’é˜Ÿä¼˜å…ˆçº§ï¼‰çš„è¿™ç§æƒ…å†µã€‚</li><li>ä»»åŠ¡ä¼˜å…ˆçº§</li><li>FreeRTOSçš„ä»»åŠ¡ä¼˜å…ˆçº§æ˜¯0æœ€ä¸ä¼˜å…ˆï¼Œè¶Šå¤§è¶Šä¼˜å…ˆï¼Œå’Œä¸­æ–­ä¼˜å…ˆçº§ç›¸åçš„å“ˆï¼</li></ul></blockquote><hr><h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><h3 id="1-1-ä¸­æ–­å±è”½"><a href="#1-1-ä¸­æ–­å±è”½" class="headerlink" title="1.1 ä¸­æ–­å±è”½"></a>1.1 ä¸­æ–­å±è”½</h3><ul><li><code>configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY</code>æ­¤å®ç”¨æ¥è®¾ç½®FreeRTOSç³»ç»Ÿå¯ä»¥ç®¡ç†çš„æœ€å¤§ä¼˜å…ˆçº§ã€‚å¯ä»¥è‡ªç”±è®¾ç½®ï¼Œæ­£ç‚¹åŸå­è®¾ç½®ä¸º5ï¼Œæˆ‘ä¹Ÿè®¾ç½®ä¸º5ã€‚ä¹Ÿå°±æ˜¯è¯´æŠ¢å ä¼˜å…ˆçº§å°äº5çš„ä¸­æ–­ä¸å½’FreeRTOSç®¡ç†ã€‚</li><li><code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code>æ­¤å®ç”¨æ¥è®¾ç½®FreeRTOSç³»ç»Ÿå¯ä»¥ç®¡ç†çš„æœ€å°ä¼˜å…ˆçº§ã€‚å¯ä»¥è‡ªç”±è®¾ç½®ï¼Œæ­£ç‚¹åŸå­å’Œæˆ‘éƒ½è®¾ç½®æˆ15ã€‚ä¹Ÿå°±æ˜¯è¯´æŠ¢å ä¼˜å…ˆçº§å¤§äº15çš„ä¸­æ–­ä¸å½’FreeRTOSç®¡ç†ï¼Œå½“ç„¶STM32çš„ä¼˜å…ˆçº§åªæœ‰ 0~15 å“ˆã€‚</li><li>æ‰€ä»¥ä¸Šè¿°ä¸¤ä¸ªå®åŠ èµ·æ¥çš„æ„æ€å°±æ˜¯ï¼Œ<strong>æŠ¢å ä¼˜å…ˆçº§ä¸º 0-4 çš„ä¸­æ–­ä¸å½’FreeRTOSè°ƒåº¦ï¼ŒæŠ¢å ä¼˜å…ˆçº§ 5-15 çš„ä¸­æ–­æœä»FreeRTOSçš„è°ƒåº¦ã€‚</strong></li><li><em>Plus: ä¸å½’FreeRTOSè°ƒåº¦çš„ä¸­æ–­ï¼Œä¸å¯ä»¥è°ƒç”¨FreeRTOSçš„APIå“¦ï¼Œä¸å¯ä»¥å“¦ï¼æ‰“å’©ï¼</em></li></ul><h3 id="1-2-å¼€å…³ä¸­æ–­"><a href="#1-2-å¼€å…³ä¸­æ–­" class="headerlink" title="1.2 å¼€å…³ä¸­æ–­"></a>1.2 å¼€å…³ä¸­æ–­</h3><h3 id="1-3-ä¸´ç•Œæ®µä»£ç ï¼ˆä¸´ç•ŒåŒºï¼‰"><a href="#1-3-ä¸´ç•Œæ®µä»£ç ï¼ˆä¸´ç•ŒåŒºï¼‰" class="headerlink" title="1.3 ä¸´ç•Œæ®µä»£ç ï¼ˆä¸´ç•ŒåŒºï¼‰"></a>1.3 ä¸´ç•Œæ®µä»£ç ï¼ˆä¸´ç•ŒåŒºï¼‰</h3><h4 id="1-3-1-ä»»åŠ¡çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤"><a href="#1-3-1-ä»»åŠ¡çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤" class="headerlink" title="1.3.1 ä»»åŠ¡çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤"></a>1.3.1 ä»»åŠ¡çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤</h4><ul><li>å‡½æ•°<code>taskENTER_CRITICAL()</code>è¿›å…¥ä¸´ç•ŒåŒºå’Œ<code>taskEXIT_CRITICAL()</code>é€€å‡ºä¸´ç•ŒåŒºï¼Œæ˜¯ä»»åŠ¡çº§çš„ä¸´ç•Œæ®µä»£ç ä¿æŠ¤ã€‚ä¿æŠ¤è¿™ä¸¤ä¸ªå‡½æ•°åŒ…å¤¹çš„åŒºåŸŸä¸ä¼šå—åˆ°ä¸­æ–­çš„æ‰“æ‰°ã€‚</li><li><strong>Important1: è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯æˆå¯¹ä½¿ç”¨çš„å“¦ï¼ä¸å¯ä»¥åªç”¨å…¶ä¸­ä¸€ä¸ªï¼Œå®ƒä»¬å¿…é¡»æˆåŒæˆå¯¹çš„å‡ºç°ï¼å°±æ˜¯è¯´ï¼Œä½ è°ƒç”¨äº†å¤šå°‘æ¬¡è¿›å…¥ä¸´ç•Œæ®µï¼Œä½ å°±è¦è°ƒç”¨å¤šå°‘æ¬¡é€€å‡ºä¸´ç•Œæ®µæ¥æŠµæ¶ˆï¼å¦åˆ™ä¸­æ–­ä¼šä¸€ç›´è¢«å±è”½ï¼</strong></li><li><strong>Important2: ä¸´ç•ŒåŒºçš„ä»£ç ä¸€å®šè¦ç²¾ç®€ï¼å› ä¸ºè¿›å…¥äº†ä¸´ç•ŒåŒºæ„å‘³ç€å…³é—­äº†FreeRTOSå¯ä»¥è°ƒåº¦çš„æ‰€æœ‰ä¸­æ–­ï¼Œä½ ä¸ç²¾ç®€ä¸€ç‚¹ï¼Œå™¼é‡Œå•ªå•¦ä¸€å¤§é•¿ä¸²ï¼Œæ‰§è¡Œå¥½å‡ ç§’ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¿™äº›ä¸­æ–­å¾—ä¸åˆ°åŠæ—¶çš„å“åº”ï¼</strong></li><li>ä½¿ç”¨åœºæ™¯ï¼šä»»åŠ¡åˆ›å»ºã€ç¡¬ä»¶å±‚åˆå§‹åŒ–ã€é‡è¦çš„å®æ—¶æ€§é«˜çš„ä»£ç æ®µâ€¦</li><li>ä»»åŠ¡çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">testFunction</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>    &#123;<br>        taskENTER_CRITICAL(); <span class="hljs-comment">// è¿›å…¥ä¸´ç•ŒåŒº</span><br><br>        <span class="hljs-comment">// ä½ çš„ä»£ç æ®µ...</span><br>        <span class="hljs-comment">// è¿™é‡Œæ˜¯ä¸´ç•ŒåŒºï¼Œä»£ç ä¸ä¼šå—åˆ°ä¸­æ–­çš„æ‰“æ–­...</span><br><br>        taskEXIT_CRITICAL(); <span class="hljs-comment">// é€€å‡ºä¸´ç•ŒåŒº</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="1-3-2-ä¸­æ–­çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤"><a href="#1-3-2-ä¸­æ–­çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤" class="headerlink" title="1.3.2 ä¸­æ–­çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤"></a>1.3.2 ä¸­æ–­çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤</h4><ul><li>å‡½æ•°<code>taskENTER_CRITICAL_FROM_ISR()</code>è¿›å…¥ä¸­æ–­ä¸´ç•ŒåŒºå’Œ<code>taskEXIT_CRITICAL_FROM_ISR(x)</code>é€€å‡ºä¸­æ–­ä¸´ç•ŒåŒºï¼Œæ˜¯ä¸­æ–­çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤ã€‚</li><li>å’Œä»»åŠ¡çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤å·®ä¸å¤šï¼Œåªä¸è¿‡è¿™é‡Œå‘¢ï¼Œ<strong>è¿›å…¥ä¸­æ–­ä¸´ç•ŒåŒºå‡½æ•°</strong>ä¼šè¿”å›ä¸€ä¸ªValueï¼Œæ‰§è¡Œ<strong>é€€å‡ºä¸­æ–­ä¸´ç•ŒåŒºå‡½æ•°</strong>çš„æ—¶å€™è¦æŠŠå¾—åˆ°çš„Valueä¼ ç»™å®ƒã€‚Valueè®°å½•çš„å°±æ˜¯ä½ å±è”½çš„å…¶ä»–çš„ä¸­æ–­çš„ä¼˜å…ˆçº§ã€‚<strong>åæ­£ä½ è¦è®°ä½è¿›å…¥ä¸­æ–­ä¸´ç•Œæ®µæ—¶æ¥æ”¶è¿™ä¸ªValueï¼Œå¹¶åœ¨é€€å‡ºä¸­æ–­ä¸´ç•Œæ®µçš„æ—¶å€™æŠŠè¿™ä¸ªValueæ”¾å›å»ï¼</strong></li><li><strong>Important: ä¹Ÿæ˜¯è®²ç©¶æˆåŒæˆå¯¹å‡ºç°çš„ï¼ä¸€å®šè¦æ³¨æ„ï¼</strong></li><li>è¿ç”¨åœºæ™¯ï¼šå®æ—¶æ€§è¦æ±‚æœ€é«˜çš„ä»£ç æ®µï¼ˆä½ çœ‹ï¼Œä½ åœ¨ä¸­æ–­é‡Œæ‰“å¼€ä¸´ç•ŒåŒºï¼Œå±è”½äº†è‡ªå·±ä»¥å¤–çš„æ‰€æœ‰FreeRTOSç®¡ç†çš„ä¸­æ–­ï¼Œé˜²æ­¢äº†ä¸­æ–­åµŒå¥—çš„æƒ…å†µå‘ç”Ÿï¼Œä¿æŠ¤åœ¨ä¸­æ–­ä¸´ç•ŒåŒºçš„ä»£ç ä¸è¢«æ‰“æ‰°</li><li>ä¸­æ–­çº§ä¸´ç•Œæ®µä»£ç ä¿æŠ¤çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// å®šæ—¶å™¨3ä¸­æ–­æœåŠ¡å‡½æ•° </span><br><span class="hljs-comment">// å‡è®¾å®šæ—¶å™¨3çš„æŠ¢å ä¼˜å…ˆçº§åœ¨FreeRTOSçš„è°ƒåº¦èŒƒå›´å†…</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">TIM3_IRQHandler</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(TIM_GetITStatus(TIM3, TIM_IT_Update) == SET)<br>    &#123;<br>        <span class="hljs-type">uint32_t</span> Status_Value = taskENTER_CRITICAL_FROM_ISR();<br><br>        <span class="hljs-comment">// ä½ çš„ä»£ç æ®µ...</span><br>        <span class="hljs-comment">// è¿™é‡Œæ˜¯ä¸­æ–­ä¸´ç•ŒåŒºï¼Œå±è”½æ‰€æœ‰å¯è¢«FreeRTOSè°ƒåº¦çš„ä¸­æ–­...</span><br><br>        taskEXIT_CRITICAL_FROM_ISR(Status_Value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><hr><h3 id="2-1-ä»»åŠ¡çŠ¶æ€"><a href="#2-1-ä»»åŠ¡çŠ¶æ€" class="headerlink" title="2.1 ä»»åŠ¡çŠ¶æ€"></a>2.1 ä»»åŠ¡çŠ¶æ€</h3><ul><li>è¿è¡Œæ€</li><li>å°±ç»ªæ€</li><li>é˜»å¡æ€</li><li>æŒ‚èµ·æ€</li></ul><hr><h3 id="2-2-ä»»åŠ¡çš„åˆ›å»º"><a href="#2-2-ä»»åŠ¡çš„åˆ›å»º" class="headerlink" title="2.2 ä»»åŠ¡çš„åˆ›å»º"></a>2.2 ä»»åŠ¡çš„åˆ›å»º</h3><h4 id="2-2-1-ä»»åŠ¡åˆ›å»ºçš„APIå‡½æ•°"><a href="#2-2-1-ä»»åŠ¡åˆ›å»ºçš„APIå‡½æ•°" class="headerlink" title="2.2.1 ä»»åŠ¡åˆ›å»ºçš„APIå‡½æ•°"></a>2.2.1 ä»»åŠ¡åˆ›å»ºçš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xTaskCreate()</code></strong> ï¼Œåˆåä½ ä¼šç”¨çš„æœ€å¤šçš„å‡½æ•°ã€‚</p><ul><li>ç”¨äºåŠ¨æ€åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼ŒRAMä¼šè‡ªè¡Œä»FreeRTOSçš„å †ä¸­åˆ†é…å‡ºæ¥ã€‚</li></ul></blockquote><ul><li><code>xTaskCreate()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ pdPASS-&gt;ä»»åŠ¡åˆ›å»ºæˆåŠŸ / errCOULD_NOT_ALLOCATE_REQUIRED_MEMORY-&gt;å †å†…å­˜ä¸è¶³ï¼Œåˆ›å»ºä»»åŠ¡å¤±è´¥</span><br>BaseType_t <span class="hljs-title function_">xTaskCreate</span><span class="hljs-params">( TaskFunction_t          pxTaskCode, <span class="hljs-comment">// ä»»åŠ¡å‡½æ•°</span></span><br><span class="hljs-params">                        <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-type">const</span>      pcName, <span class="hljs-comment">// ä»»åŠ¡åå­—</span></span><br><span class="hljs-params">                        <span class="hljs-type">const</span> <span class="hljs-type">uint16_t</span>          usStackDepth, <span class="hljs-comment">// ä»»åŠ¡å †æ ˆå¤§å°ï¼Œå®é™…ç”³è¯·åˆ°çš„å †æ ˆæ˜¯usStackDepthçš„4å€</span></span><br><span class="hljs-params">                        <span class="hljs-type">void</span> * <span class="hljs-type">const</span>            pvParameters, <span class="hljs-comment">// ä¼ é€’ç»™ä»»åŠ¡å‡½æ•°çš„å‚æ•°</span></span><br><span class="hljs-params">                        UBaseType_t             uxPriority, <span class="hljs-comment">// ä»»åŠ¡ä¼˜å…ˆçº§</span></span><br><span class="hljs-params">                        TaskHandle_t * <span class="hljs-type">const</span>    pxCreatedTask <span class="hljs-comment">// ä»»åŠ¡å¥æŸ„</span></span><br><span class="hljs-params">                        )</span><br></code></pre></td></tr></table></figure><h4 id="2-2-2-ä»»åŠ¡åˆ é™¤çš„APIå‡½æ•°"><a href="#2-2-2-ä»»åŠ¡åˆ é™¤çš„APIå‡½æ•°" class="headerlink" title="2.2.2 ä»»åŠ¡åˆ é™¤çš„APIå‡½æ•°"></a>2.2.2 ä»»åŠ¡åˆ é™¤çš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xTaskDelete()</code></strong></p><ul><li>åˆ é™¤ä¸€ä¸ªç”¨<code>xTaskCreate()</code>æˆ–è€…<code>xTaskCreateStatic()</code>åˆ›å»ºçš„ä»»åŠ¡ã€‚</li><li>ä»»åŠ¡è¢«åˆ é™¤ä¹‹åï¼Œä»»åŠ¡ä¸å¤å­˜åœ¨ï¼Œå…³äºè¢«åˆ é™¤çš„ä»»åŠ¡çš„å¥æŸ„ä¸èƒ½å†è¢«ä½¿ç”¨ï¼Œé™¤éè¿™ä¸ªä»»åŠ¡é‡æ–°åˆ›å»ºèµ·æ¥ã€‚</li><li>å¦‚æœä»»åŠ¡æ˜¯ç”±<code>xTaskCreate()</code>åˆ›å»ºçš„ï¼ˆç”±åŠ¨æ€æ–¹æ³•åˆ›å»ºï¼‰ï¼Œé‚£ä¹ˆä»»åŠ¡è¢«åˆ é™¤ä»¥åï¼Œä»»åŠ¡çš„å †æ ˆå°†åœ¨<strong>ç©ºé—²ä»»åŠ¡</strong>ä¸­å¾—åˆ°<strong>é‡Šæ”¾</strong>ï¼Œæ‰€ä»¥åˆ é™¤åŠ¨æ€æ–¹æ³•åˆ›å»ºçš„ä»»åŠ¡ä»¥åè¦ç»™ç©ºé—²ä»»åŠ¡ä¸€äº›æ—¶é—´æ¥é‡Šæ”¾ç©ºé—´å“¦ï¼</li></ul></blockquote><ul><li><code>xTaskDelete()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// æ— è¿”å›å€¼</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">vTaskDelete</span><span class="hljs-params">( TaskHandle_t xTaskToDelete )</span> <span class="hljs-comment">// xTaskToDeleteæ˜¯è¦è¢«åˆ é™¤çš„ä»»åŠ¡çš„ä»»åŠ¡å¥æŸ„</span><br></code></pre></td></tr></table></figure><h4 id="2-2-3-ä»»åŠ¡åˆ›å»ºä¸åˆ é™¤çš„ç¨‹åºç¤ºä¾‹ï¼ˆåŠ¨æ€æ–¹æ³•ï¼‰"><a href="#2-2-3-ä»»åŠ¡åˆ›å»ºä¸åˆ é™¤çš„ç¨‹åºç¤ºä¾‹ï¼ˆåŠ¨æ€æ–¹æ³•ï¼‰" class="headerlink" title="2.2.3 ä»»åŠ¡åˆ›å»ºä¸åˆ é™¤çš„ç¨‹åºç¤ºä¾‹ï¼ˆåŠ¨æ€æ–¹æ³•ï¼‰"></a>2.2.3 ä»»åŠ¡åˆ›å»ºä¸åˆ é™¤çš„ç¨‹åºç¤ºä¾‹ï¼ˆåŠ¨æ€æ–¹æ³•ï¼‰</h4><ul><li>ç®€å•çš„æ€»ç»“åˆ†æä¸€ä¸‹æ­¤ä¾‹ç¨‹çš„æµç¨‹ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬ä½¿ç”¨ FreeRTOS å†™çš„ç¬¬ä¸€ä¸ªç¨‹åºï¼Œå¾ˆå¤šä¹ æƒ¯æ˜¯æˆ‘ä»¬åé¢è¦ç”¨åˆ°çš„ã€‚æ¯”å¦‚ä½¿ç”¨ä»»åŠ¡å®å®šä¹‰ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œå †æ ˆå¤§å°ç­‰ï¼Œä¸€èˆ¬æœ‰å…³ä¸€ä¸ªä»»åŠ¡çš„ä¸œè¥¿æˆ‘ä»¬çš„æ”¾åˆ°ä¸€èµ·ï¼Œæ¯”å¦‚ä»»åŠ¡å †æ ˆã€ä»»åŠ¡å¥æŸ„ã€ä»»åŠ¡å‡½æ•°å£°æ˜ç­‰ï¼Œè¿™æ ·æ–¹ä¾¿ä¿®æ”¹ã€‚è¿™äº›ä¸œè¥¿å¯ä»¥æ”¾åˆ°ä¸€ä¸ª.h å¤´æ–‡ä»¶é‡Œé¢å»ï¼Œåªæ˜¯ä¾‹ç¨‹é‡Œé¢ä»»åŠ¡æ•°æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å°±ç›´æ¥æ”¾åˆ° main.c æ–‡ä»¶é‡Œé¢äº†ï¼Œè¦æ˜¯å·¥ç¨‹æ¯”è¾ƒå¤§çš„è¯æœ€å¥½åšä¸€ä¸ªä¸“ç”¨çš„å¤´æ–‡ä»¶æ¥ç®¡ç†ã€‚</li></ul><h4 id="2-2-4-ä»»åŠ¡åˆ›å»ºä¸åˆ é™¤çš„ç¨‹åºç¤ºä¾‹ï¼ˆé™æ€æ–¹æ³•ï¼‰"><a href="#2-2-4-ä»»åŠ¡åˆ›å»ºä¸åˆ é™¤çš„ç¨‹åºç¤ºä¾‹ï¼ˆé™æ€æ–¹æ³•ï¼‰" class="headerlink" title="2.2.4 ä»»åŠ¡åˆ›å»ºä¸åˆ é™¤çš„ç¨‹åºç¤ºä¾‹ï¼ˆé™æ€æ–¹æ³•ï¼‰"></a>2.2.4 ä»»åŠ¡åˆ›å»ºä¸åˆ é™¤çš„ç¨‹åºç¤ºä¾‹ï¼ˆé™æ€æ–¹æ³•ï¼‰</h4><ul><li>å’ŒåŠ¨æ€æ–¹æ³•æ¯”è¾ƒä¸åŒçš„æ˜¯ï¼Œæƒ³è¦ä½¿ç”¨é™æ€æ–¹æ³•ï¼Œä½ å¿…é¡»è‡ªå·±å®ç°ä¸¤ä¸ªæ¥å£å‡½æ•°<code>vApplicationGetIdleTaskMemory()</code>å’Œ<code>vApplicationGetTimerTaskMemory()</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// ç©ºé—²ä»»åŠ¡ä»»åŠ¡å †æ ˆ // åˆ†é…äº†é™æ€çš„RAMå•¦</span><br><span class="hljs-type">static</span> StackType_t IdleTaskStack[configMINIMAL_STACK_SIZE];<br><span class="hljs-comment">// ç©ºé—²ä»»åŠ¡æ§åˆ¶å—</span><br><span class="hljs-type">static</span> StaticTask_t IdleTaskTCB;<br><br><span class="hljs-comment">// å®šæ—¶å™¨æœåŠ¡ä»»åŠ¡å †æ ˆ // åˆ†é…äº†é™æ€çš„RAMå•¦</span><br><span class="hljs-type">static</span> StackType_t TimerTaskStack[configTIMER_TASK_STACK_DEPTH];<br><span class="hljs-comment">// å®šæ—¶å™¨æœåŠ¡ä»»åŠ¡æ§åˆ¶å—</span><br><span class="hljs-type">static</span> StaticTask_t TimerTaskTCB;<br><br><span class="hljs-comment">// è·å–ç©ºé—²ä»»åŠ¡åœ°ä»»åŠ¡å †æ ˆå’Œä»»åŠ¡æ§åˆ¶å—å†…å­˜ï¼Œå› ä¸ºæœ¬ä¾‹ç¨‹ä½¿ç”¨çš„</span><br><span class="hljs-comment">// é™æ€å†…å­˜ï¼Œå› æ­¤ç©ºé—²ä»»åŠ¡çš„ä»»åŠ¡å †æ ˆå’Œä»»åŠ¡æ§åˆ¶å—çš„å†…å­˜å°±åº”è¯¥</span><br><span class="hljs-comment">// æœ‰ç”¨æˆ·æ¥æä¾›ï¼ŒFreeRTOSæä¾›äº†æ¥å£å‡½æ•°vApplicationGetIdleTaskMemory()</span><br><span class="hljs-comment">// å®ç°æ­¤å‡½æ•°å³å¯ã€‚</span><br><span class="hljs-comment">// ppxIdleTaskTCBBuffer:ä»»åŠ¡æ§åˆ¶å—å†…å­˜</span><br><span class="hljs-comment">// ppxIdleTaskStackBuffer:ä»»åŠ¡å †æ ˆå†…å­˜</span><br><span class="hljs-comment">// pulIdleTaskStackSize:ä»»åŠ¡å †æ ˆå¤§å°</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">vApplicationGetIdleTaskMemory</span><span class="hljs-params">( StaticTask_t **ppxIdleTaskTCBBuffer,</span><br><span class="hljs-params">    StackType_t **ppxIdleTaskStackBuffer,</span><br><span class="hljs-params">    <span class="hljs-type">uint32_t</span> *pulIdleTaskStackSize)</span><br>&#123;<br>*ppxIdleTaskTCBBuffer = &amp;IdleTaskTCB;<br>*ppxIdleTaskStackBuffer = IdleTaskStack;<br>*pulIdleTaskStackSize = configMINIMAL_STACK_SIZE;<br>&#125;<br><br><span class="hljs-comment">// è·å–å®šæ—¶å™¨æœåŠ¡ä»»åŠ¡çš„ä»»åŠ¡å †æ ˆå’Œä»»åŠ¡æ§åˆ¶å—å†…å­˜</span><br><span class="hljs-comment">// ppxTimerTaskTCBBuffer:ä»»åŠ¡æ§åˆ¶å—å†…å­˜</span><br><span class="hljs-comment">// ppxTimerTaskStackBuffer:ä»»åŠ¡å †æ ˆå†…å­˜</span><br><span class="hljs-comment">// pulTimerTaskStackSize:ä»»åŠ¡å †æ ˆå¤§å°</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">vApplicationGetTimerTaskMemory</span><span class="hljs-params">(StaticTask_t **ppxTimerTaskTCBBuffer,</span><br><span class="hljs-params">    StackType_t **ppxTimerTaskStackBuffer,</span><br><span class="hljs-params">    <span class="hljs-type">uint32_t</span> *pulTimerTaskStackSize)</span><br>&#123;<br>*ppxTimerTaskTCBBuffer = &amp;TimerTaskTCB;<br>*ppxTimerTaskStackBuffer = TimerTaskStack;<br>*pulTimerTaskStackSize = configTIMER_TASK_STACK_DEPTH;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-x-x-ä»»åŠ¡æ§åˆ¶å—"><a href="#2-x-x-ä»»åŠ¡æ§åˆ¶å—" class="headerlink" title="2.x.x ä»»åŠ¡æ§åˆ¶å—"></a>2.x.x ä»»åŠ¡æ§åˆ¶å—</h4><h4 id="2-x-x-ä»»åŠ¡å †æ ˆ"><a href="#2-x-x-ä»»åŠ¡å †æ ˆ" class="headerlink" title="2.x.x ä»»åŠ¡å †æ ˆ"></a>2.x.x ä»»åŠ¡å †æ ˆ</h4><hr><h3 id="2-3-ä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤"><a href="#2-3-ä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤" class="headerlink" title="2.3 ä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤"></a>2.3 ä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤</h3><h4 id="2-3-1-ä»»åŠ¡æŒ‚èµ·çš„APIå‡½æ•°"><a href="#2-3-1-ä»»åŠ¡æŒ‚èµ·çš„APIå‡½æ•°" class="headerlink" title="2.3.1 ä»»åŠ¡æŒ‚èµ·çš„APIå‡½æ•°"></a>2.3.1 ä»»åŠ¡æŒ‚èµ·çš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>vTaskSuspend()</code></strong></p><ul><li>è¯¥å‡½æ•°ç”¨äºå°†æŸä¸ªä»»åŠ¡è®¾ç½®ä¸ºæŒ‚èµ·æ€ï¼Œä»»åŠ¡æŒ‚èµ·ä»¥åå°±ä¸ä¼šè¢«è¿è¡Œï¼Œç›´åˆ°ä½¿ç”¨<code>vTaskResume()</code>æˆ–è€…<code>xTaskResumeFromISR()</code>ç»“æŸä»»åŠ¡çš„æŒ‚èµ·æ€ã€‚</li></ul></blockquote><ul><li><code>vTaskSuspend()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// æ— è¿”å›å€¼</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">vTaskSuspend</span><span class="hljs-params">( TaskHandle_t xTaskToSuspend )</span> <span class="hljs-comment">// xTaskToSuspendå°†è¦è¢«æŒ‚èµ·ä»»åŠ¡çš„ä»»åŠ¡å¥æŸ„ </span><br>                                                 <span class="hljs-comment">// æ³¨æ„ï¼å¦‚æœå‚æ•°ä¸ºNULLï¼Œè¡¨ç¤ºæŒ‚èµ·ä»»åŠ¡è‡ªå·±ã€‚</span><br></code></pre></td></tr></table></figure><h4 id="2-3-2-ä»»åŠ¡æ¢å¤çš„APIå‡½æ•°"><a href="#2-3-2-ä»»åŠ¡æ¢å¤çš„APIå‡½æ•°" class="headerlink" title="2.3.2 ä»»åŠ¡æ¢å¤çš„APIå‡½æ•°"></a>2.3.2 ä»»åŠ¡æ¢å¤çš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>vTaskResume()</code></strong> ï¼Œåœ¨ä¸»ç¨‹åºä¸­è°ƒç”¨</p><ul><li>è¯¥å‡½æ•°å¯ä»¥ä¹Ÿåªå¯ä»¥å°†å…ˆå‰ä½¿ç”¨<code>vTaskSuspend()</code>å‡½æ•°æŒ‚èµ·çš„ä»»åŠ¡æ¢å¤åˆ°å°±ç»ªæ€ã€‚</li></ul></blockquote><ul><li><code>vTaskResume()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// æ— è¿”å›å€¼</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">vTaskResume</span><span class="hljs-params">( TaskHandle_t xTaskToResume )</span> <span class="hljs-comment">// å°†è¦è¢«æ¢å¤ä»»åŠ¡çš„ä»»åŠ¡å¥æŸ„</span><br></code></pre></td></tr></table></figure><blockquote><p>å‡½æ•° <strong><code>xTaskResumeFromISR()</code></strong> ï¼Œåœ¨ä¸­æ–­å‡½æ•°ä¸­è°ƒç”¨</p><ul><li>è¯¥å‡½æ•°æ˜¯<code>vTaskResume()</code>å‡½æ•°çš„ä¸­æ–­ç‰ˆæœ¬ï¼Œéœ€è¦åœ¨ä¸­æ–­é‡Œè°ƒç”¨å“ˆã€‚</li><li>è¯¥å‡½æ•°å¯ä»¥ä¹Ÿåªå¯ä»¥å°†å…ˆå‰ä½¿ç”¨<code>vTaskSuspend()</code>å‡½æ•°æŒ‚èµ·çš„ä»»åŠ¡æ¢å¤åˆ°å°±ç»ªæ€ã€‚</li></ul></blockquote><ul><li><code>xTaskResumeFromISR()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼špdTRUE-&gt;æ¢å¤çš„ä»»åŠ¡ä¼˜å…ˆçº§ &gt;= å½“å‰ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥åœ¨é€€å‡ºä¸­æ–­å‡½æ•°åè¦è¿›è¡Œä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢</span><br><span class="hljs-comment">// è¿”å›å€¼ï¼špdFALSE-&gt;æ¢å¤çš„ä»»åŠ¡ä¼˜å…ˆçº§ &lt; å½“å‰ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥åœ¨é€€å‡ºä¸­æ–­å‡½æ•°åä¸éœ€è¦è¿›è¡Œä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢</span><br>BaseType_t <span class="hljs-title function_">xTaskResumeFromISR</span><span class="hljs-params">( TaskHandle_t xTaskToResume )</span> <span class="hljs-comment">// å°†è¦è¢«æ¢å¤ä»»åŠ¡çš„ä»»åŠ¡å¥æŸ„</span><br></code></pre></td></tr></table></figure><h4 id="2-3-3-ä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤ç¨‹åºç¤ºä¾‹"><a href="#2-3-3-ä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤ç¨‹åºç¤ºä¾‹" class="headerlink" title="2.3.3 ä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤ç¨‹åºç¤ºä¾‹"></a>2.3.3 ä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤ç¨‹åºç¤ºä¾‹</h4><hr><h3 id="3-1-åˆ—è¡¨å’Œåˆ—è¡¨é¡¹"><a href="#3-1-åˆ—è¡¨å’Œåˆ—è¡¨é¡¹" class="headerlink" title="3.1 åˆ—è¡¨å’Œåˆ—è¡¨é¡¹"></a>3.1 åˆ—è¡¨å’Œåˆ—è¡¨é¡¹</h3><h4 id="3-1-1-åˆ—è¡¨"><a href="#3-1-1-åˆ—è¡¨" class="headerlink" title="3.1.1 åˆ—è¡¨"></a>3.1.1 åˆ—è¡¨</h4><p>ä¸ºå•¥è¦æœ‰åˆ—è¡¨ï¼Ÿä¸æ˜¯å·²ç»å¯ä»¥åˆ›å»ºä»»åŠ¡è¿è¡Œä»»åŠ¡äº†å—ï¼Ÿæˆ‘çš„ç†è§£æ˜¯ï¼Œåœ¨åšä¸€äº›å¤§å‹é¡¹ç›®çš„æ—¶å€™ï¼Œå¾€å¾€è¦æ ¹æ®ä¸åŒçš„åœºæ™¯æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œæœ‰æ—¶ä»»åŠ¡æ¯”è¾ƒå¤šäº†ï¼Œåˆ›å»ºä»»åŠ¡å’Œåˆ é™¤ä»»åŠ¡è¿™äº›æ“ä½œå°±å˜å¾—å¼¯å¼¯ç»•ç»•äº†ã€‚è¿™ä¸ªæ—¶å€™æŠŠä»»åŠ¡ä»¬å½’ç±»è¿›ä¸åŒçš„åˆ—è¡¨ä¸­ï¼Œé‚£æˆ‘åˆ‡æ¢è¿ç”¨åœºæ™¯çš„æ—¶å€™ï¼Œç›´æ¥åˆ‡æ¢ç›®å‰æ­£åœ¨æ‰§è¡Œçš„åˆ—è¡¨å°±è¡Œå•¦ï¼å°±ä¸ç”¨ä¸€ä¸ªä¸€ä¸ªå¯¹ä»»åŠ¡è¿›è¡Œæ“ä½œï¼Œé¿å…äº†éº»çƒ¦ã€‚</p><ul><li>åˆ—è¡¨ï¼Œæ˜¯FreeRTOSä¸­çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå’Œé“¾è¡¨æœ‰ç‚¹åƒï¼Œæ˜¯è¢«ç”¨åšè·Ÿè¸ªFreeRTOSä¸­çš„ä»»åŠ¡çš„</li><li>åˆ—è¡¨é¡¹å°±æ˜¯å­˜æ”¾åœ¨åˆ—è¡¨å½“ä¸­çš„é¡¹ç›®</li><li>åˆ—è¡¨ç›¸å½“äºé“¾è¡¨ï¼Œåˆ—è¡¨é¡¹ç›¸å½“äºèŠ‚ç‚¹ï¼ŒFreeRTOSä¸­çš„åˆ—è¡¨æ˜¯ä¸€ä¸ªåŒå‘ç¯å½¢é“¾è¡¨</li><li>å¸¸è§çš„åˆ—è¡¨åŒ…æ‹¬ï¼šå°±ç»ªåˆ—è¡¨ã€é˜»å¡åˆ—è¡¨ã€æŒ‚èµ·åˆ—è¡¨ï¼ˆç›®å‰è‡ªå·±åšåˆ—è¡¨çš„æƒ…å†µæ¯”è¾ƒå°‘ï¼Œéƒ½æ˜¯RTOSè‡ªåŠ¨å¸®æˆ‘ä»¬åšå¥½çš„ï¼‰</li></ul><h4 id="3-1-2-åˆ—è¡¨é¡¹"><a href="#3-1-2-åˆ—è¡¨é¡¹" class="headerlink" title="3.1.2 åˆ—è¡¨é¡¹"></a>3.1.2 åˆ—è¡¨é¡¹</h4><ul><li>åˆ—è¡¨é¡¹ï¼Œå°±æ˜¯å­˜æ”¾åœ¨åˆ—è¡¨ä¸­çš„é¡¹ç›®ã€‚</li><li>FreeRTOSæä¾›äº†ä¸¤ç§åˆ—è¡¨é¡¹ï¼šåˆ—è¡¨é¡¹å’Œè¿·ä½ åˆ—è¡¨é¡¹ã€‚</li></ul><hr><h3 id="4-1-è°ƒåº¦å™¨"><a href="#4-1-è°ƒåº¦å™¨" class="headerlink" title="4.1 è°ƒåº¦å™¨"></a>4.1 è°ƒåº¦å™¨</h3><blockquote><p>å‡½æ•° <strong><code>vTaskStartScheduler()</code></strong> ï¼Œå¼€å¯ä»»åŠ¡è°ƒåº¦å™¨</p><ul><li>åœ¨<code>main()</code>å‡½æ•°é‡Œï¼Œåˆ›å»ºå¥½æ‰€éœ€çš„ä»»åŠ¡åï¼Œå³å¯è°ƒç”¨<code>vTaskStartScheduler()</code>è®©ä»»åŠ¡å¼€å§‹è¿è¡Œå§ã€‚</li></ul></blockquote><blockquote><p>å‡½æ•° <strong><code>vTaskEndScheduler()</code></strong> ï¼Œå…³é—­ä»»åŠ¡è°ƒåº¦å™¨</p></blockquote><blockquote><p>å‡½æ•° <strong><code>vTaskSuspendAll()</code></strong> ï¼ŒæŒ‚èµ·ä»»åŠ¡è°ƒåº¦å™¨ï¼Œå°±æ˜¯æŒ‚èµ·æ‰€æœ‰ä»»åŠ¡</p></blockquote><blockquote><p>å‡½æ•° <strong><code>vTaskResumeAll()</code></strong> ï¼Œæ¢å¤ä»»åŠ¡è°ƒåº¦å™¨ï¼Œå°±æ˜¯æ¢å¤æ‰€æœ‰ä»»åŠ¡</p></blockquote><h3 id="4-2-ç©ºé—²ä»»åŠ¡"><a href="#4-2-ç©ºé—²ä»»åŠ¡" class="headerlink" title="4.2 ç©ºé—²ä»»åŠ¡"></a>4.2 ç©ºé—²ä»»åŠ¡</h3><blockquote><ul><li>è°ƒç”¨<code>vTaskStartScheduler()</code>æ—¶å€™ï¼Œæ­¤å‡½æ•°ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸º<code>IDLE</code>çš„ä»»åŠ¡ï¼Œè¿™ä¸ªå°±æ˜¯ç©ºé—²ä»»åŠ¡ï¼å®ƒæ˜¯FreeRTOSç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºçš„ï¼Œä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºã€‚è€Œä¸”ä»»åŠ¡è°ƒåŠ¨å™¨å¯åŠ¨ä»¥åå¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨è¿è¡Œä¸­ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ç©ºé—²ä»»åŠ¡å­˜åœ¨çš„æ„ä¹‰ä¹‹ä¸€ã€‚</li><li>ç©ºé—²ä»»åŠ¡çš„ä¼˜å…ˆçº§æœ€ä½ï¼Œæ˜¯0ï¼ä»»åŠ¡å‡½æ•°ä¸º<code>prvIdleTask()</code>ï¼ˆæ˜¯å•¥ï¼Ÿ</li><li>ç©ºé—²ä»»åŠ¡çš„ä½œç”¨å¦‚ä¸‹ï¼š<blockquote><ul><li>å¦‚æœç³»ç»Ÿæœ‰ä»»åŠ¡è¢«åˆ é™¤ï¼Œè¢«åˆ é™¤çš„ä»»åŠ¡çš„å †æ ˆå’Œä»»åŠ¡æ§åˆ¶å—çš„å†…å­˜ä¼šåœ¨ç©ºé—²ä»»åŠ¡ä¸­å¾—åˆ°é‡Šæ”¾å“¦ï¼</li><li>è¿è¡Œç”¨æˆ·è®¾ç½®çš„ç©ºé—²ä»»åŠ¡é’©å­å‡½æ•°ï¼ˆï¼Ÿå•¥æ˜¯é’©å­</li><li>åˆ¤æ–­æ˜¯å¦å¼€å¯ä½åŠŸè€—ticklessæ¨¡å¼ï¼Œå¦‚æœå¼€å¯çš„è¯è¿˜éœ€è¦åšç›¸åº”çš„å¤„ç†ï¼ˆï¼Ÿ</li></ul></blockquote></li></ul></blockquote><h3 id="4-3-å»¶æ—¶å‡½æ•°"><a href="#4-3-å»¶æ—¶å‡½æ•°" class="headerlink" title="4.3 å»¶æ—¶å‡½æ•°"></a>4.3 å»¶æ—¶å‡½æ•°</h3><blockquote><p>å‡½æ•° <strong><code>xTaskDelay()</code></strong> ï¼Œå»¶æ—¶å¤šå°‘æ—¶é—´ï¼Œç”¨äºå›ºå®šå»¶æ—¶ï¼ˆå¸¸ç”¨çš„æ™®é€šçš„å»¶æ—¶å‡½æ•°ï¼‰</p></blockquote><blockquote><p>å‡½æ•° <strong><code>xTaskDelayUntil()</code></strong> ï¼Œæ¯éš”å¤šå°‘æ—¶é—´æ‰§è¡Œä¸€æ¬¡å‡½æ•°ï¼Œç”¨äºå‘¨æœŸæ€§æ‰§è¡Œ</p></blockquote><hr><h3 id="5-1-é˜Ÿåˆ—"><a href="#5-1-é˜Ÿåˆ—" class="headerlink" title="5.1 é˜Ÿåˆ—"></a>5.1 é˜Ÿåˆ—</h3><ul><li>é˜Ÿåˆ—æ˜¯ä»»åŠ¡åˆ°ä»»åŠ¡ã€ä»»åŠ¡åˆ°ä¸­æ–­ã€ä¸­æ–­åˆ°ä»»åŠ¡æ•°æ®äº¤æµçš„ä¸€ç§æœºåˆ¶ï¼ˆæ¶ˆæ¯ä¼ é€’</li><li>å†™é˜Ÿåˆ—å’Œè¯»é˜Ÿåˆ—çš„apiå‡½æ•°éƒ½ä¼šè‡ªåŠ¨è¿›å…¥ä¸´ç•ŒåŒºæ“ä½œçš„</li><li>åœ¨é˜Ÿåˆ—ä¸­å¯ä»¥å­˜å‚¨æ•°é‡æœ‰é™ã€å¤§å°å›ºå®šçš„æ•°æ®ã€‚é˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®å«åšâ€œé˜Ÿåˆ—é¡¹ç›®â€ï¼Œé˜Ÿåˆ—èƒ½å¤Ÿå­˜å‚¨â€œé˜Ÿåˆ—é¡¹ç›®â€çš„æœ€å¤§æ•°é‡æˆä¸ºé˜Ÿåˆ—çš„é•¿åº¦</li></ul><h3 id="5-2-äºŒå€¼ä¿¡å·é‡"><a href="#5-2-äºŒå€¼ä¿¡å·é‡" class="headerlink" title="5.2 äºŒå€¼ä¿¡å·é‡"></a>5.2 äºŒå€¼ä¿¡å·é‡</h3><ul><li><p>äºŒå€¼ä¿¡å·é‡ï¼šå…¶å®å°±æ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªé˜Ÿåˆ—é¡¹çš„é˜Ÿåˆ—ï¼Œè¿™ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—è¦ä¹ˆæ˜¯æ»¡çš„ï¼Œè¦ä¹ˆæ˜¯ç©ºçš„ï¼Œè¿™æ­£å¥½æ˜¯äºŒå€¼ï¼</p></li><li><p>ä»»åŠ¡å’Œä¸­æ–­ä½¿ç”¨è¿™ä¸ªç‰¹æ®Šé˜Ÿåˆ—ä¸ç”¨åœ¨ä¹é˜Ÿåˆ—ä¸­å­˜çš„æ˜¯ä»€ä¹ˆæ¶ˆæ¯ï¼Œåªéœ€è¦çŸ¥é“è¿™ä¸ªé˜Ÿåˆ—æ˜¯æ»¡çš„è¿˜æ˜¯ç©ºçš„ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæœºåˆ¶æ¥å®Œæˆä»»åŠ¡ä¸ä¸­æ–­ä¹‹é—´çš„åŒæ­¥ï¼</p></li></ul><h4 id="5-2-1-äºŒå€¼ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°"><a href="#5-2-1-äºŒå€¼ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°" class="headerlink" title="5.2.1 äºŒå€¼ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°"></a>5.2.1 äºŒå€¼ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xSemaphoreCreateBinary()</code></strong> ï¼Œåœ¨ä¸»ç¨‹åºä¸­è°ƒç”¨</p></blockquote><ul><li><code>xSemaphoreCreateBinary()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼šNULL-&gt;ä¿¡å·é‡åˆ›å»ºå¤±è´¥ï¼›å…¶ä»–-&gt;åˆ›å»ºæˆåŠŸçš„ä¿¡å·é‡çš„å¥æŸ„</span><br>SemaphoreHandle_t <span class="hljs-title function_">xSemaphoreCreateBinary</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> <br></code></pre></td></tr></table></figure><h4 id="5-2-2-äºŒå€¼ä¿¡å·é‡é‡Šæ”¾çš„APIå‡½æ•°"><a href="#5-2-2-äºŒå€¼ä¿¡å·é‡é‡Šæ”¾çš„APIå‡½æ•°" class="headerlink" title="5.2.2 äºŒå€¼ä¿¡å·é‡é‡Šæ”¾çš„APIå‡½æ•°"></a>5.2.2 äºŒå€¼ä¿¡å·é‡é‡Šæ”¾çš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xSemaphoreGive()</code></strong> ï¼Œä»»åŠ¡çº§ä¿¡å·é‡é‡Šæ”¾å‡½æ•°<br>å‡½æ•° <strong><code>xSemaphoreGiveISR()</code></strong> ï¼Œä¸­æ–­çº§ä¿¡å·é‡é‡Šæ”¾å‡½æ•°</p></blockquote><ul><li><code>xSemaphoreGive()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼šerrQUEUE_FULL-&gt;ä¿¡å·é‡é‡Šæ”¾å¤±è´¥ï¼›pdPASS-&gt;ä¿¡å·é‡é‡Šæ”¾æˆåŠŸ</span><br><span class="hljs-comment">// å‚æ•°ï¼š xSemaphore-&gt;è¦é‡Šæ”¾çš„ä¿¡å·é‡å¥æŸ„</span><br>BaseType_t <span class="hljs-title function_">xSemaphoreGive</span><span class="hljs-params">( SemaphoreHandle_t xSemaphore )</span> <br></code></pre></td></tr></table></figure><ul><li><code>xSemaphoreGiveISR()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼šerrQUEUE_FULL-&gt;ä¿¡å·é‡é‡Šæ”¾å¤±è´¥ï¼›pdPASS-&gt;ä¿¡å·é‡é‡Šæ”¾æˆåŠŸ</span><br><span class="hljs-comment">// å‚æ•°ï¼šxSemaphore-&gt;è¦é‡Šæ”¾çš„ä¿¡å·é‡å¥æŸ„</span><br><span class="hljs-comment">// å‚æ•°ï¼špxHigherPriorityTaskWoken-&gt;æ ‡è®°é€€å‡ºæ­¤å‡½æ•°æ˜¯å¦è¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼Œç”¨æˆ·è¦åšçš„å°±æ˜¯</span><br><span class="hljs-comment">// æä¾›ä¸€ä¸ªå˜é‡æ¥ä¿å­˜è¿™ä¸ªå€¼ï¼Œåœ¨é€€å‡ºä¸­æ–­å‡½æ•°å‰åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªå˜é‡ï¼Œå½“è¿™ä¸ªå€¼ä¸ºpdTRUEæ—¶</span><br><span class="hljs-comment">// åœ¨é€€å‡ºä¸­æ–­å‡½æ•°ä¹‹å‰ä¸€å®šè¦åšä¸€æ¬¡ä»»åŠ¡åˆ‡æ¢taskYIELD()ï¼</span><br>BaseType_t <span class="hljs-title function_">xSemaphoreGiveISR</span><span class="hljs-params">( SemaphoreHandle_t xSemaphore, BaseType_t* pxHigherPriorityTaskWoken )</span> <br></code></pre></td></tr></table></figure><h4 id="5-2-3-äºŒå€¼ä¿¡å·é‡è·å–çš„APIå‡½æ•°"><a href="#5-2-3-äºŒå€¼ä¿¡å·é‡è·å–çš„APIå‡½æ•°" class="headerlink" title="5.2.3 äºŒå€¼ä¿¡å·é‡è·å–çš„APIå‡½æ•°"></a>5.2.3 äºŒå€¼ä¿¡å·é‡è·å–çš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xSemaphoreTake()</code></strong> ï¼Œä»»åŠ¡çº§ä¿¡å·é‡é‡Šæ”¾å‡½æ•°<br>å‡½æ•° <strong><code>xSemaphoreTakeISR()</code></strong> ï¼Œä¸­æ–­çº§ä¿¡å·é‡é‡Šæ”¾å‡½æ•°</p></blockquote><ul><li><code>xSemaphoreTake()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼špdFALSE-&gt;ä¿¡å·é‡è·å–å¤±è´¥ï¼›pdTRUE-&gt;ä¿¡å·é‡è·å–æˆåŠŸ</span><br><span class="hljs-comment">// å‚æ•°ï¼š xSemaphore-&gt;è¦é‡Šæ”¾çš„ä¿¡å·é‡å¥æŸ„</span><br><span class="hljs-comment">// å‚æ•°ï¼šxBlockTime-&gt;é˜»å¡æ—¶é—´</span><br>BaseType_t <span class="hljs-title function_">xSemaphoreTake</span><span class="hljs-params">( SemaphoreHandle_t xSemaphore, TickType_t xBlockTime )</span> <br></code></pre></td></tr></table></figure><ul><li><code>xSemaphoreTakeISR()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼špdFALSE-&gt;ä¿¡å·é‡è·å–å¤±è´¥ï¼›pdTRUE-&gt;ä¿¡å·é‡è·å–æˆåŠŸ</span><br><span class="hljs-comment">// å‚æ•°ï¼šxSemaphore-&gt;è¦è·å–ä¿¡å·é‡å¥æŸ„</span><br><span class="hljs-comment">// å‚æ•°ï¼špxHigherPriorityTaskWoken-&gt;æ ‡è®°é€€å‡ºæ­¤å‡½æ•°æ˜¯å¦è¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼Œç”¨æˆ·è¦åšçš„å°±æ˜¯</span><br><span class="hljs-comment">// æä¾›ä¸€ä¸ªå˜é‡æ¥ä¿å­˜è¿™ä¸ªå€¼ï¼Œåœ¨é€€å‡ºä¸­æ–­å‡½æ•°å‰åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªå˜é‡ï¼Œå½“è¿™ä¸ªå€¼ä¸ºpdTRUEæ—¶</span><br><span class="hljs-comment">// åœ¨é€€å‡ºä¸­æ–­å‡½æ•°ä¹‹å‰ä¸€å®šè¦åšä¸€æ¬¡ä»»åŠ¡åˆ‡æ¢taskYIELD()ï¼</span><br>BaseType_t <span class="hljs-title function_">xSemaphoreTakeISR</span><span class="hljs-params">( SemaphoreHandle_t xSemaphore, BaseType_t* pxHigherPriorityTaskWoken )</span> <br></code></pre></td></tr></table></figure><h3 id="5-3-è®¡æ•°å‹ä¿¡å·é‡"><a href="#5-3-è®¡æ•°å‹ä¿¡å·é‡" class="headerlink" title="5.3 è®¡æ•°å‹ä¿¡å·é‡"></a>5.3 è®¡æ•°å‹ä¿¡å·é‡</h3><ul><li>è®¡æ•°å‹ä¿¡å·é‡å°±æ˜¯è¯»å–è¿™ä¸ªé˜Ÿåˆ—é¡¹çš„æ•°å€¼ï¼Œè·å–ä¿¡å·é‡çš„æ—¶å€™è‡ªå‡ï¼Œé‡Šæ”¾ä¿¡å·é‡çš„æ—¶å€™è‡ªå¢ï¼Œæœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¸¦å€¼çš„äºŒå€¼ä¿¡å·é‡</li></ul><h4 id="5-3-1-è®¡æ•°å‹ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°"><a href="#5-3-1-è®¡æ•°å‹ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°" class="headerlink" title="5.3.1 è®¡æ•°å‹ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°"></a>5.3.1 è®¡æ•°å‹ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xSemaphoreCreateCounting()</code></strong> ï¼Œåœ¨ä¸»ç¨‹åºä¸­è°ƒç”¨</p></blockquote><ul><li><code>xSemaphoreCreateCounting()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼šNULL-&gt;è®¡æ•°å‹ä¿¡å·é‡åˆ›å»ºå¤±è´¥ï¼›å…¶ä»–-&gt;åˆ›å»ºæˆåŠŸçš„è®¡æ•°å‹ä¿¡å·é‡çš„å¥æŸ„</span><br><span class="hljs-comment">// å‚æ•°ï¼šuxMaxCount-&gt;è®¡æ•°ä¿¡å·é‡çš„æœ€å¤§å€¼ï¼Œå½“ä¿¡å·é‡å€¼ç­‰äºæ­¤å€¼æ—¶ï¼Œé‡Šæ”¾ä¿¡å·é‡ä¼šå¤±è´¥ï¼Œå› ä¸ºå·²ç»æ»¡äº†</span><br><span class="hljs-comment">// å‚æ•°ï¼šuxInitialCount-&gt;è®¡æ•°ä¿¡å·é‡çš„åˆå€¼</span><br>SemaphoreHandle_t <span class="hljs-title function_">xSemaphoreCreateCounting</span><span class="hljs-params">(UBaseType_t uxMaxCount, UBaseType_t uxInitialCount)</span> <br></code></pre></td></tr></table></figure><h4 id="5-3-2-è®¡æ•°å‹ä¿¡å·é‡é‡Šæ”¾ä¸è·å–çš„APIå‡½æ•°"><a href="#5-3-2-è®¡æ•°å‹ä¿¡å·é‡é‡Šæ”¾ä¸è·å–çš„APIå‡½æ•°" class="headerlink" title="5.3.2 è®¡æ•°å‹ä¿¡å·é‡é‡Šæ”¾ä¸è·å–çš„APIå‡½æ•°"></a>5.3.2 è®¡æ•°å‹ä¿¡å·é‡é‡Šæ”¾ä¸è·å–çš„APIå‡½æ•°</h4><p><strong>è®¡æ•°å‹ä¿¡å·é‡çš„é‡Šæ”¾å’Œè·å–ä¸äºŒå€¼ä¿¡å·é‡ç›¸åŒï¼è¯·çœ‹5.2.2å’Œ5.2.3ï¼</strong></p><h3 id="5-4-äº’æ–¥ä¿¡å·é‡"><a href="#5-4-äº’æ–¥ä¿¡å·é‡" class="headerlink" title="5.4 äº’æ–¥ä¿¡å·é‡"></a>5.4 äº’æ–¥ä¿¡å·é‡</h3><ul><li>ä½†æ˜¯å‘¢ï¼Œä½¿ç”¨äºŒå€¼ä¿¡å·é‡å¯èƒ½ä¼šå¯¼è‡´ä¼˜å…ˆçº§åè½¬çš„é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼äº’æ–¥ä¿¡å·é‡ï¼</li><li>äº’æ–¥ä¿¡å·é‡å…¶å®å°±æ˜¯ä¸€ä¸ªæ‹¥æœ‰ä¼˜å…ˆçº§ç»§æ‰¿çš„äºŒå€¼ä¿¡å·é‡ã€‚</li><li>æ³¨æ„ï¼šåˆ›å»ºäº’æ–¥ä¿¡å·é‡æ—¶ï¼Œä¼šä¸»åŠ¨é‡Šæ”¾ä¸€æ¬¡ä¿¡å·é‡ï¼å°±æ˜¯ä½ å¯ä»¥ç›´æ¥è·å–åˆ°ï¼è€ŒäºŒå€¼ä¿¡å·é‡å’Œè®¡æ•°å‹ä¿¡å·é‡ä¸è¡Œï¼Œå®ƒä»¬éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ç¬¬ä¸€æ¬¡ä¿¡å·é‡ã€‚</li><li><strong>äº’æ–¥ä¿¡å·é‡æœ‰ä¼˜å…ˆçº§ç»§æ‰¿æœºåˆ¶ï¼Œæ‰€ä»¥åªèƒ½ç”¨åœ¨ä»»åŠ¡ä¸­ï¼Œä¸èƒ½ç”¨äºä¸­æ–­æœåŠ¡å‡½æ•°ä¸­ï¼</strong></li></ul><h4 id="5-4-1-äº’æ–¥ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°"><a href="#5-4-1-äº’æ–¥ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°" class="headerlink" title="5.4.1 äº’æ–¥ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°"></a>5.4.1 äº’æ–¥ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xSemaphoreCreateMutex()</code></strong> ï¼Œåœ¨ä¸»ç¨‹åºä¸­è°ƒç”¨</p></blockquote><ul><li><code>xSemaphoreCreateMutex()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼šNULL-&gt;ä¿¡å·é‡åˆ›å»ºå¤±è´¥ï¼›å…¶ä»–-&gt;åˆ›å»ºæˆåŠŸçš„ä¿¡å·é‡çš„å¥æŸ„</span><br>SemaphoreHandle_t <span class="hljs-title function_">xSemaphoreCreateMutex</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> <br></code></pre></td></tr></table></figure><h4 id="5-4-2-äº’æ–¥ä¿¡å·é‡é‡Šæ”¾ä¸è·å–çš„APIå‡½æ•°"><a href="#5-4-2-äº’æ–¥ä¿¡å·é‡é‡Šæ”¾ä¸è·å–çš„APIå‡½æ•°" class="headerlink" title="5.4.2 äº’æ–¥ä¿¡å·é‡é‡Šæ”¾ä¸è·å–çš„APIå‡½æ•°"></a>5.4.2 äº’æ–¥ä¿¡å·é‡é‡Šæ”¾ä¸è·å–çš„APIå‡½æ•°</h4><p><strong>äº’æ–¥ä¿¡å·é‡çš„é‡Šæ”¾å’Œè·å–ä¸äºŒå€¼ä¿¡å·é‡ç›¸åŒï¼è¯·çœ‹5.2.2å’Œ5.2.3ï¼</strong></p><h3 id="5-5-é€’å½’äº’æ–¥ä¿¡å·é‡"><a href="#5-5-é€’å½’äº’æ–¥ä¿¡å·é‡" class="headerlink" title="5.5 é€’å½’äº’æ–¥ä¿¡å·é‡"></a>5.5 é€’å½’äº’æ–¥ä¿¡å·é‡</h3><ul><li>é€’å½’äº’æ–¥ä¿¡å·é‡å¯ä»¥çœ‹ä½œä¸€ä¸ªç‰¹æ®Šçš„äº’æ–¥ä¿¡å·é‡ï¼Œå·²ç»è·å–äº†äº’æ–¥ä¿¡å·é‡çš„ä»»åŠ¡å°±ä¸èƒ½å†æ¬¡è·å–è¿™ä¸ªäº’æ–¥ä¿¡å·é‡ï¼Œä½†æ˜¯é€’å½’äº’æ–¥ä¿¡å·é‡ä¸åŒï¼Œå·²ç»è·å–äº†é€’å½’äº’æ–¥ä¿¡å·é‡çš„ä»»åŠ¡å¯ä»¥å†æ¬¡è·å–è¿™ä¸ªé€’å½’äº’æ–¥ä»»åŠ¡è€Œä¸”æ¬¡æ•°ä¸é™ï¼ä¸€ä¸ªä»»åŠ¡ä½¿ç”¨å‡½æ•°xSemaphoreTakeRecursive()æˆåŠŸçš„è·å–äº†å¤šå°‘æ¬¡é€’å½’äº’æ–¥ä¿¡å·é‡å°±å¾—ä½¿ç”¨å‡½æ•°xSemaphoreGiveRecursive()é‡Šæ”¾å¤šå°‘æ¬¡ï¼</li><li>æ³¨æ„ï¼šè¦ä½¿ç”¨é€’å½’äº’æ–¥ä¿¡å·é‡çš„è¯å®configUSE_RECURSIVE_MUTEXESå¿…é¡»ä¸º1ï¼</li></ul><h4 id="5-5-1-é€’å½’äº’æ–¥ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°"><a href="#5-5-1-é€’å½’äº’æ–¥ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°" class="headerlink" title="5.5.1 é€’å½’äº’æ–¥ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°"></a>5.5.1 é€’å½’äº’æ–¥ä¿¡å·é‡åˆ›å»ºçš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xSemaphoreCreateRecursiveMutex()</code></strong> ï¼Œåœ¨ä¸»ç¨‹åºä¸­è°ƒç”¨</p></blockquote><ul><li><code>xSemaphoreCreateRecursiveMutex()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼šNULL-&gt;ä¿¡å·é‡åˆ›å»ºå¤±è´¥ï¼›å…¶ä»–-&gt;åˆ›å»ºæˆåŠŸçš„ä¿¡å·é‡çš„å¥æŸ„</span><br>SemaphoreHandle_t <span class="hljs-title function_">xSemaphoreCreateRecursiveMutex</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> <br></code></pre></td></tr></table></figure><h4 id="5-5-2-é€’å½’äº’æ–¥ä¿¡å·é‡é‡Šæ”¾çš„APIå‡½æ•°"><a href="#5-5-2-é€’å½’äº’æ–¥ä¿¡å·é‡é‡Šæ”¾çš„APIå‡½æ•°" class="headerlink" title="5.5.2 é€’å½’äº’æ–¥ä¿¡å·é‡é‡Šæ”¾çš„APIå‡½æ•°"></a>5.5.2 é€’å½’äº’æ–¥ä¿¡å·é‡é‡Šæ”¾çš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xSemaphoreGiveRecursive()</code></strong> ï¼Œåœ¨ä¸»ç¨‹åºä¸­è°ƒç”¨</p></blockquote><ul><li><code>xSemaphoreGiveRecursive()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼špdFAIL-&gt;ä¿¡å·é‡é‡Šæ”¾å¤±è´¥ï¼›pdPASS-&gt;ä¿¡å·é‡é‡Šæ”¾æˆåŠŸ</span><br>BaseType_t <span class="hljs-title function_">xSemaphoreGiveRecursive</span><span class="hljs-params">( QueueHandle_t xMutex )</span> <br></code></pre></td></tr></table></figure><h4 id="5-5-3-é€’å½’äº’æ–¥ä¿¡å·é‡è·å–çš„APIå‡½æ•°"><a href="#5-5-3-é€’å½’äº’æ–¥ä¿¡å·é‡è·å–çš„APIå‡½æ•°" class="headerlink" title="5.5.3 é€’å½’äº’æ–¥ä¿¡å·é‡è·å–çš„APIå‡½æ•°"></a>5.5.3 é€’å½’äº’æ–¥ä¿¡å·é‡è·å–çš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>xSemaphoreTakeRecursive()</code></strong> ï¼Œåœ¨ä¸»ç¨‹åºä¸­è°ƒç”¨</p></blockquote><ul><li><code>xSemaphoreTakeRecursive()</code>ä¸€è§ˆï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è¿”å›å€¼ï¼špdFAIL-&gt;ä¿¡å·é‡è·å–å¤±è´¥ï¼›pdPASS-&gt;ä¿¡å·é‡è·å–æˆåŠŸ</span><br>BaseType_t <span class="hljs-title function_">xSemaphoreTakeRecursive</span><span class="hljs-params">( QueueHandle_t xMutex, TickType_t xTicksTowait )</span> <br></code></pre></td></tr></table></figure><hr><h3 id="6-1-ä»»åŠ¡é€šçŸ¥"><a href="#6-1-ä»»åŠ¡é€šçŸ¥" class="headerlink" title="6.1 ä»»åŠ¡é€šçŸ¥"></a>6.1 ä»»åŠ¡é€šçŸ¥</h3><blockquote><p>ä»»åŠ¡é€šçŸ¥çš„ä¼˜åŠ¿</p></blockquote><ul><li><strong>æ•ˆç‡æ›´é«˜</strong>ï¼å¦‚æœä½¿ç”¨ä»»åŠ¡é€šçŸ¥æ¥æ¨¡æ‹ŸäºŒå€¼ä¿¡å·é‡ï¼Œé€Ÿåº¦å¿«45%ï¼ˆå®˜æ–¹æµ‹è¯•ï¼‰ï¼</li><li><strong>ä½¿ç”¨å†…å­˜æ›´å°</strong>ï¼Œä½¿ç”¨å…¶ä»–æ–¹æ³•æ—¶éƒ½è¦å…ˆåˆ›å»ºå¯¹åº”çš„ç»“æ„ä½“ï¼Œä½¿ç”¨ä»»åŠ¡é€šçŸ¥æ—¶æ— éœ€é¢å¤–åˆ›å»ºç»“æ„ä½“</li></ul><blockquote><p>ä»»åŠ¡é€šçŸ¥çš„åŠ£åŠ¿</p></blockquote><ul><li><strong>æ— æ³•åœ¨ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­è·å¾—ä»»åŠ¡é€šçŸ¥</strong>ï¼Œä½ åªèƒ½åœ¨ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­å‘é€ä»»åŠ¡é€šçŸ¥</li><li><strong>æ— æ³•å¹¿æ’­ç»™å¤šä¸ªä»»åŠ¡ï¼ˆåªèƒ½ä¸€ä¸ªï¼‰</strong>ï¼Œä»»åŠ¡é€šçŸ¥åªèƒ½æ˜¯è¢«æŒ‡å®šçš„ä¸€ä¸ªä»»åŠ¡æ¥æ”¶å¹¶å¤„ç†</li><li><strong>æ— æ³•ç¼“å­˜å¤šä¸ªæ•°æ®ï¼ˆåªèƒ½ä¸€ä¸ªï¼‰</strong>ï¼Œä»»åŠ¡é€šçŸ¥æ˜¯é€šè¿‡æ›´æ–°ä»»åŠ¡é€šçŸ¥å€¼æ¥å‘é€æ•°æ®çš„ï¼Œä»»åŠ¡ç»“æ„ä½“ä¸­åªæœ‰ä¸€ä¸ªä»»åŠ¡é€šçŸ¥å€¼ï¼Œåªèƒ½ä¿æŒä¸€ä¸ªæ•°æ®</li></ul><h4 id="6-1-1-ä»»åŠ¡é€šçŸ¥æ¨¡æ‹ŸäºŒå€¼ä¿¡å·é‡"><a href="#6-1-1-ä»»åŠ¡é€šçŸ¥æ¨¡æ‹ŸäºŒå€¼ä¿¡å·é‡" class="headerlink" title="6.1.1 ä»»åŠ¡é€šçŸ¥æ¨¡æ‹ŸäºŒå€¼ä¿¡å·é‡"></a>6.1.1 ä»»åŠ¡é€šçŸ¥æ¨¡æ‹ŸäºŒå€¼ä¿¡å·é‡</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* ä»»åŠ¡å‘èµ·é€šçŸ¥ */</span><br>xTaskNotifyGive(yourTaskHandler);<br><br><span class="hljs-comment">/* ä»»åŠ¡æ¥æ”¶é€šçŸ¥ */</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">yourTask</span><span class="hljs-params">(<span class="hljs-type">void</span> * pvPaeameters)</span><br>&#123;<br>    <span class="hljs-comment">// æ¥æ”¶ä»»åŠ¡æˆåŠŸåpdTRUE-&gt;ä»»åŠ¡é€šçŸ¥å€¼æ¸…é›¶ï¼ŒportMAX_DELAY-&gt;æ­»ç­‰ï¼Œæ²¡ä»»åŠ¡é€šçŸ¥å°±é˜»å¡</span><br>    <span class="hljs-keyword">if</span>(ulTaskNotifyTake(pdTRUE, portMAX_DELAY))<br>    &#123;<br>        <span class="hljs-comment">// do your task</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6-1-2-ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿè®¡æ•°å‹ä¿¡å·é‡"><a href="#6-1-2-ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿè®¡æ•°å‹ä¿¡å·é‡" class="headerlink" title="6.1.2 ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿè®¡æ•°å‹ä¿¡å·é‡"></a>6.1.2 ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿè®¡æ•°å‹ä¿¡å·é‡</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* ä»»åŠ¡å‘èµ·é€šçŸ¥ */</span><br>xTaskNotifyGive(yourTaskHandler);<br><br><span class="hljs-comment">/* ä»»åŠ¡æ¥æ”¶é€šçŸ¥ */</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">yourTask</span><span class="hljs-params">(<span class="hljs-type">void</span> * pvPaeameters)</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> rev = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// æ¥æ”¶ä»»åŠ¡æˆåŠŸåpdFALSE-&gt;ä»»åŠ¡é€šçŸ¥å€¼è‡ªå‡ï¼ŒportMAX_DELAY-&gt;æ­»ç­‰ï¼Œæ²¡ä»»åŠ¡é€šçŸ¥å°±é˜»å¡</span><br>    rev = ulTaskNotifyTake(pdFALSE, portMAX_DELAY);<br>    <span class="hljs-keyword">if</span>(rev)<br>    &#123;<br>        <span class="hljs-comment">// do your task</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6-1-3-ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿæ¶ˆæ¯é‚®ç®±ï¼ˆä¼ å€¼ï¼‰"><a href="#6-1-3-ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿæ¶ˆæ¯é‚®ç®±ï¼ˆä¼ å€¼ï¼‰" class="headerlink" title="6.1.3 ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿæ¶ˆæ¯é‚®ç®±ï¼ˆä¼ å€¼ï¼‰"></a>6.1.3 ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿæ¶ˆæ¯é‚®ç®±ï¼ˆä¼ å€¼ï¼‰</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* ä»»åŠ¡å‘èµ·é€šçŸ¥ */</span><br><span class="hljs-comment">// valForTransfer-&gt;ä½ æƒ³è¦ä¼ é€çš„å˜é‡å€¼ï¼ŒeSetValueWithOverwrite-&gt;è®¾ç½®æˆå¯è¦†å†™æ¨¡å¼</span><br>xTaskNotify(yourTaskHandler, valForTransfer, eSetValueWithOverwrite);<br><br><span class="hljs-comment">/* ä»»åŠ¡æ¥æ”¶é€šçŸ¥ */</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">yourTask</span><span class="hljs-params">(<span class="hljs-type">void</span> * pvPaeameters)</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> notifyVal = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// æ¥æ”¶ä»»åŠ¡æˆåŠŸåï¼ŒportMAX_DELAY-&gt;æ­»ç­‰ï¼Œæ²¡ä»»åŠ¡é€šçŸ¥å°±é˜»å¡</span><br>    xTaskNotifyWait(<span class="hljs-number">0</span><span class="hljs-comment">/*ä¼ å…¥å€¼ä¸æ”¹å˜*/</span>, <span class="hljs-number">0xFFFFFFFF</span><span class="hljs-comment">/*é€€å‡ºå‡½æ•°åä¼ å…¥å€¼æ¸…é›¶*/</span>, &amp;notifyVal, portMAX_DELAY);<br>    <span class="hljs-keyword">switch</span>(notifyVal)<br>    &#123;<br>        <span class="hljs-comment">// do your task</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6-1-4-ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿäº‹ä»¶æ ‡å¿—ç»„"><a href="#6-1-4-ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿäº‹ä»¶æ ‡å¿—ç»„" class="headerlink" title="6.1.4 ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿäº‹ä»¶æ ‡å¿—ç»„"></a>6.1.4 ä»»åŠ¡é€šçŸ¥æ¨¡æ‹Ÿäº‹ä»¶æ ‡å¿—ç»„</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* ä»»åŠ¡å‘èµ·é€šçŸ¥ */</span><br><span class="hljs-comment">// EVENTBIT_X-&gt;ä½ æƒ³è¦é€šçŸ¥çš„ç¬¬å‡ ä¸ªbitï¼ŒeSetBits-&gt;è®¾ç½®æˆäº‹ä»¶æ ‡å¿—ç»„æ¨¡å¼</span><br>xTaskNotify(yourTaskHandler, EVENTBIT_0<span class="hljs-comment">/* é€šçŸ¥bit0 */</span>, eSetBits);<br><br>xTaskNotify(yourTaskHandler, EVENTBIT_1<span class="hljs-comment">/* é€šçŸ¥bit1 */</span>, eSetBits);<br><br><span class="hljs-comment">/* ä»»åŠ¡æ¥æ”¶é€šçŸ¥ */</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">yourTask</span><span class="hljs-params">(<span class="hljs-type">void</span> * pvPaeameters)</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> notifyVal = <span class="hljs-number">0</span>, eventBit = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// æ¥æ”¶ä»»åŠ¡æˆåŠŸåï¼ŒportMAX_DELAY-&gt;æ­»ç­‰ï¼Œæ²¡ä»»åŠ¡é€šçŸ¥å°±é˜»å¡</span><br>    xTaskNotifyWait(<span class="hljs-number">0</span><span class="hljs-comment">/*ä¼ å…¥å€¼ä¸æ”¹å˜*/</span>, <span class="hljs-number">0xFFFFFFFF</span><span class="hljs-comment">/*é€€å‡ºå‡½æ•°åä¼ å…¥å€¼æ¸…é›¶*/</span>, &amp;notifyVal, portMAX_DELAY);<br>    <span class="hljs-keyword">if</span>(notifyVal &amp; EVENTBIT_0)<br>    &#123;<br>        eventBit |= EVENTBIT_0;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(notifyVal &amp; EVENTBIT_1)<br>    &#123;<br>        eventBit |= EVENTBIT_1;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(eventBit == (EVENTBIT_0 | EVENTBIT_1))<br>    &#123;<br>        <span class="hljs-comment">// do your task</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å†…æ ¸æ§åˆ¶å‡½æ•°"><a href="#å†…æ ¸æ§åˆ¶å‡½æ•°" class="headerlink" title="å†…æ ¸æ§åˆ¶å‡½æ•°"></a>å†…æ ¸æ§åˆ¶å‡½æ•°</h3><h4 id="ä»»åŠ¡åˆ‡æ¢çš„APIå‡½æ•°"><a href="#ä»»åŠ¡åˆ‡æ¢çš„APIå‡½æ•°" class="headerlink" title="ä»»åŠ¡åˆ‡æ¢çš„APIå‡½æ•°"></a>ä»»åŠ¡åˆ‡æ¢çš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>taskYIELD()</code></strong> ï¼Œæ­¤å‡½æ•°ç”¨äºè¿›è¡Œä»»åŠ¡åˆ‡æ¢ï¼Œç”¨çš„æœ€å¤šçš„å°±æ˜¯å‡ºä¸­æ–­çš„ä¼˜å…ˆçº§åˆ‡æ¢æ—¶</p></blockquote><h4 id="è¿›å…¥ã€é€€å‡ºä¸´ç•ŒåŒºçš„APIå‡½æ•°"><a href="#è¿›å…¥ã€é€€å‡ºä¸´ç•ŒåŒºçš„APIå‡½æ•°" class="headerlink" title="è¿›å…¥ã€é€€å‡ºä¸´ç•ŒåŒºçš„APIå‡½æ•°"></a>è¿›å…¥ã€é€€å‡ºä¸´ç•ŒåŒºçš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>taskENTER_CRITICAL()</code></strong> ï¼Œè¿›å…¥ä¸´ç•ŒåŒºï¼Œç”¨äºä»»åŠ¡çº§</p></blockquote><blockquote><p>å‡½æ•° <strong><code>taskENTER_CRITICAL_FROM_ISR()</code></strong> ï¼Œè¿›å…¥ä¸´ç•ŒåŒºï¼Œç”¨äºä¸­æ–­çº§</p></blockquote><blockquote><p>å‡½æ•° <strong><code>taskEXIT_CRITICAL()</code></strong> ï¼Œé€€å‡ºä¸´ç•ŒåŒºï¼Œç”¨äºä»»åŠ¡çº§</p></blockquote><blockquote><p>å‡½æ•° <strong><code>taskEXIT_CRITICAL_FROM_ISR()</code></strong> ï¼Œé€€å‡ºä¸´ç•ŒåŒºï¼Œç”¨äºä¸­æ–­çº§</p></blockquote><h4 id="ä¸­æ–­æ‰“å¼€ã€å…³é—­çš„APIå‡½æ•°"><a href="#ä¸­æ–­æ‰“å¼€ã€å…³é—­çš„APIå‡½æ•°" class="headerlink" title="ä¸­æ–­æ‰“å¼€ã€å…³é—­çš„APIå‡½æ•°"></a>ä¸­æ–­æ‰“å¼€ã€å…³é—­çš„APIå‡½æ•°</h4><blockquote><p>å‡½æ•° <strong><code>taskENABLE_INTERRUPTS()</code></strong> ï¼Œæ‰“å¼€ä¸­æ–­</p></blockquote><blockquote><p>å‡½æ•° <strong><code>taskDISABLE_INTERRUPTS()</code></strong> ï¼Œå…³é—­ä¸­æ–­</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Study Page</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å•ç‰‡æœº</tag>
      
      <tag>FreeRTOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitä¸VScodeè”åˆä½¿ç”¨çš„æºä»£ç ç®¡ç†æŒ‡å—</title>
    <link href="/2023/12/09/GitxVScode-CodeManageGuide/GitxVScode-CodeManageGuide/"/>
    <url>/2023/12/09/GitxVScode-CodeManageGuide/GitxVScode-CodeManageGuide/</url>
    
    <content type="html"><![CDATA[<h1 id="GitxVScode-CodeManageGuide"><a href="#GitxVScode-CodeManageGuide" class="headerlink" title="GitxVScode-CodeManageGuide"></a>GitxVScode-CodeManageGuide</h1><h1 id="Gitä¸VScodeè”åˆä½¿ç”¨çš„æºä»£ç ç®¡ç†æŒ‡å—"><a href="#Gitä¸VScodeè”åˆä½¿ç”¨çš„æºä»£ç ç®¡ç†æŒ‡å—" class="headerlink" title="Gitä¸VScodeè”åˆä½¿ç”¨çš„æºä»£ç ç®¡ç†æŒ‡å—"></a>Gitä¸VScodeè”åˆä½¿ç”¨çš„æºä»£ç ç®¡ç†æŒ‡å—</h1><h2 id="Author-kkl"><a href="#Author-kkl" class="headerlink" title="Author: @kkl"></a>Author: @kkl</h2><hr><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li>å»ºè®®æœ‰ä¸€ç‚¹Gitç®¡ç†åŸºç¡€çš„äººä½¿ç”¨ï¼è‡³å°‘ä½ å¾—Githubæœ‰å·å§ï¼Œæ˜¯å§ï¼</li><li>è¿™äº›æŒ‡ä»¤å…¶å®å¹¶ä¸å¸¸ç”¨ï¼Œæˆ‘ä»¬åªæ˜¯ç¨ä½œç†è§£ï¼Œå‰©ä¸‹çš„äº¤ç»™Vscodeç‚¹ç‚¹ç‚¹å§ï¼</li></ul><hr><h2 id="ç›¸å…³æ’ä»¶"><a href="#ç›¸å…³æ’ä»¶" class="headerlink" title="ç›¸å…³æ’ä»¶"></a>ç›¸å…³æ’ä»¶</h2><ul><li><p>Git Graph</p><ul><li>å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°å­˜å‚¨ä»“åº“çš„æ¯ä¸€æ¬¡æäº¤(Commit)ï¼Œæ¯ä¸€ä¸ªåˆ†æ”¯(Branch)ï¼Œå’Œæ¯ä¸€æ¬¡åˆå¹¶çš„è®°å½•ï¼Œéå¸¸niceï¼</li><li>åŒæ—¶å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥è¯¢æ¯ä¸€æ¬¡çš„è®°å½•ï¼Œè¿›è¡Œæ–‡ä»¶ä»£ç æ¯”å¯¹ã€‚</li></ul></li><li><p>GitLens</p><ul><li>å¯ä»¥ç›´æ¥åœ¨æºä»£ç é‡Œçœ‹åˆ°æ¯ä¸€è¡Œä»£ç çš„æ›´æ”¹æ—¶é—´ï¼</li></ul></li><li><p>GitHistory</p><ul><li>å’ŒGit GraphåŠŸèƒ½ç±»ä¼¼ï¼Œç»†èŠ‚æ³¨é‡ç‚¹ä¸å¤ªä¸€æ ·ã€‚</li></ul></li></ul><hr><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><ul><li><strong>æäº¤(Commit)</strong><ul><li><code>git add .</code>æ·»åŠ æ‰€æœ‰è¢«ä¿®æ”¹æ–‡ä»¶åˆ°æš‚å­˜æ›´æ”¹åŒº</li><li><code>git commit -m &quot;massage&quot;</code> æäº¤æš‚å­˜æ›´æ”¹åŒºçš„å†…å®¹ä½œä¸ºä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œ<code>massage</code>ä¸ºè¯¥ç‰ˆæœ¬çš„å…³é”®å­—</li><li><code>-m</code>çš„ä½œç”¨å°±æ˜¯å¯ä»¥ä¸å¼¹çª—ç›´æ¥å†™å…³é”®å­—ï¼Œå¦‚æœä½ åªè¾“å…¥<code>git commit</code>å°±ä¼šå¼¹å‡ºä¸€ä¸ªçª—å£è®©ä½ å¡«å†™è¯¥ç‰ˆæœ¬çš„å…³é”®å­—ã€‚</li></ul></li></ul><blockquote><p>è¿™ä¸ªæ“ä½œæˆ‘ä»¬ä½¿ç”¨VScodeè‡ªå¸¦çš„æºä»£ç ç®¡ç†æ¥å®Œæˆã€‚<br>æš‚å­˜æˆ‘ä»¬æ‰€éœ€çš„ä¿®æ”¹ä¹‹åç‚¹å‡»æäº¤ï¼Œæ¥ç€ä¼šè·³è½¬åˆ°<code>COMMIT_EDITMSG</code>æ–‡ä»¶é¡µé¢ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æäº¤ç¼–è¾‘ä¿¡æ¯ã€‚<br>ä½ å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶æœ€é¡¶éƒ¨å†™ä¸€äº›ä½ è¿™æ¬¡æäº¤çš„ä¸€äº›æ¶ˆæ¯å¤‡æ³¨ã€‚å†™å®Œä¿å­˜ï¼Œå…³æ‰è¿™ä¸ªæ–‡ä»¶é¡µé¢ï¼Œå³å¯å®Œæˆä¸€æ¬¡æäº¤ï¼</p></blockquote><ul><li><strong>æ¨é€(Push)</strong></li></ul><blockquote><p>è¿™ä¸ªæ“ä½œéœ€è¦æˆ‘ä»¬çš„VScodeå…³è”è‡ªå·±çš„Githubä»“åº“åæ‰å¯ä»¥ä½¿ç”¨ã€‚<br>æäº¤ä¹‹åï¼Œæäº¤è®°å½•ä¼šæš‚å­˜åœ¨æˆ‘ä»¬æœ¬åœ°çš„ä»“åº“å†…ï¼Œå¦‚æœæƒ³è¦æŠŠæäº¤è®°å½•æ¨é€è‡³Githubï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨VScodeçš„æºä»£ç ç®¡ç†é‡Œé€‰æ‹©æ¨é€å³å¯ã€‚<br>å¦‚æœä½ Githubæ²¡æœ‰åˆ›å»ºç›¸å…³çš„ä»“åº“ï¼ŒVScodeä¹Ÿä¼šå¼¹çª—è®©ä½ åˆ›å»ºçš„ï¼</p></blockquote><ul><li><strong>ç­¾å‡ºåˆ°(Checkout)</strong></li></ul><blockquote><ul><li><code>git checkout branch_name</code>åˆ‡æ¢åˆ†æ”¯ã€‚ </li><li>åˆ‡æ¢åˆ†æ”¯çš„æ—¶å€™è¦ä¿è¯å½“å‰æš‚å­˜åŒºæ²¡æœ‰éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶å“¦ï¼å¯ä»¥ç”¨<code>git status</code>ç¡®ä¿ç°åœ¨çš„çŠ¶æ€æ˜¯<code>clean</code>ï¼Œå¦åˆ™å°±ä¼šåˆ‡æ¢åˆ†æ”¯å¤±è´¥äº†ã€‚</li></ul></blockquote><ul><li><strong>ç‰ˆæœ¬å›é€€(Reset)</strong></li></ul><blockquote><p>æœ‰3ç§å¸¸ç”¨çš„å›é€€æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯<code>soft</code>, <code>mixed</code>, <code>hard</code></p></blockquote><blockquote><p>1.<code>git reset --soft &lt;Hash&gt;</code>ï¼ˆè¿™é‡Œ<code>&lt;Hash&gt;</code>æ˜¯ä½ çš„ç‰ˆæœ¬å·å“ˆï¼<br><code>soft</code>å›é€€æ–¹å¼åªä¼šæŠŠHeadæŒ‡é’ˆå¾€å›æŒ‡åˆ°ä½ å›é€€çš„ç‰ˆæœ¬ï¼Œç„¶åä½ ä»“åº“é‡Œçš„æ–‡ä»¶ä¸ä¼šå‘ç”Ÿä»»ä½•çš„å¢åˆ ï¼ŒçŠ¶æ€å¤§æ¦‚å°±æ˜¯ä½ å·²ç»commitäº†ï¼Œä½†æ˜¯æ²¡æœ‰pushçš„çŠ¶æ€ã€‚ï¼ˆï¼Ÿä¸çŸ¥é“ç†è§£çš„å¯¹ä¸å¯¹</p></blockquote><blockquote><p>2.<code>git reset --mixed &lt;Hash&gt;</code><br><code>mixed</code>å›é€€æ–¹å¼ï¼Œä¼šæŠŠHeadæŒ‡é’ˆå¾€å›æŒ‡åˆ°æˆ‘ä»¬å¸Œæœ›å›é€€åˆ°çš„ç‰ˆæœ¬ï¼Œç„¶åä»“åº“é‡Œçš„æ–‡ä»¶ä¹Ÿä¸ä¼šå‘ç”Ÿä»»ä½•çš„å¢åˆ ï¼ˆæš‚æ—¶ï¼‰ï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯æš‚æ—¶å‘¢ï¼Ÿå› ä¸ºå®ƒæŠŠä½ è¿™ä¸ªå›é€€ç‰ˆæœ¬ä¹‹åæ‰€æœ‰çš„commitéƒ½æ”¾å›äº†æš‚å­˜æ›´æ”¹åŒºï¼Œä½ å°±å¯ä»¥åœ¨æš‚å­˜æ›´æ”¹åŒºé‡Œå†³å®šè¦æ¢å¤ä»€ä¹ˆæ–‡ä»¶ï¼Œæ¢å¤ä»€ä¹ˆä»£ç å•¦ï¼</p></blockquote><blockquote><p>3.<code>git reset --hard &lt;Hash&gt;</code><br><code>hard</code>å›é€€æ–¹å¼ï¼Œä¼šæŠŠHeadæŒ‡é’ˆå¾€å›æŒ‡åˆ°æˆ‘ä»¬å¸Œæœ›å›é€€åˆ°çš„ç‰ˆæœ¬ï¼Œç„¶åè¯¥ç‰ˆæœ¬å·ä»¥åçš„ç‰ˆæœ¬ç»Ÿç»Ÿéƒ½ä¼šä¸è§ä½¿ç”¨<code>git log</code>æ—¶å°±çœ‹ä¸è§å½“å‰å›é€€ç‰ˆæœ¬ä»¥åçš„ç‰ˆæœ¬å·äº†ï¼ˆæ‰€ä»¥è¦è°¨æ…ï¼</p><ul><li>è¿™ç§å›é€€æ–¹å¼ä¼šç®€å•ç²—æš´çš„æŠŠä½ æœ¬åœ°ä»“åº“å›é€€ç‰ˆæœ¬çš„ä»€ä¹ˆæ–‡ä»¶å•Šä»€ä¹ˆä»£ç åŸå°ä¸åŠ¨åœ°ä¸€å­—ä¸æ‹‰åœ°å½’è¿˜å®ƒçš„åŸæ ·ï¼</li><li>å½“ç„¶ï¼Œä½ ä»ç„¶å¯ä»¥é€šè¿‡<code>git reflog</code>æ‰¾å›ä»å‰çš„ç‰ˆæœ¬å·ï¼Œç„¶åä½¿ç”¨<code>git reset --hard &lt;Hash&gt;</code>è·³å›å»ï¼Œ<strong>ç†è®ºä¸Šï¼Œä½ çš„ä»£ç ä¸ä¼šä¸¢ï¼Œ</strong> niceï¼</li><li><code>git reset --hard HEAD^</code>è¡¨ç¤ºç¡¬å›é€€åˆ°<strong>ä¸Šä¸€ä¸ª</strong>ç‰ˆæœ¬</li><li>åŒç†<code>HEAD^^</code>è¡¨ç¤º<strong>ä¸Šä¸Šä¸ª</strong>ç‰ˆæœ¬ï¼Œ<code>HEAD^^^</code>è¡¨ç¤º<strong>ä¸Šä¸Šä¸Šä¸ª</strong>ç‰ˆæœ¬ï¼Œè€Œä¸”ä½ ä¹Ÿå¯ä»¥ç”¨<code>HEAD~3</code>è¡¨ç¤º<strong>ä¸Šä¸Šä¸Šä¸ª</strong>ç‰ˆæœ¬å™¢ï¼</li></ul></blockquote><h2 id="è¾…åŠ©æ“ä½œ"><a href="#è¾…åŠ©æ“ä½œ" class="headerlink" title="è¾…åŠ©æ“ä½œ"></a>è¾…åŠ©æ“ä½œ</h2><h3 id="è®°å½•æŸ¥çœ‹"><a href="#è®°å½•æŸ¥çœ‹" class="headerlink" title="è®°å½•æŸ¥çœ‹"></a>è®°å½•æŸ¥çœ‹</h3><ul><li><code>git log</code></li></ul><blockquote><ul><li><code>git log</code>ç”¨æ¥æŸ¥çœ‹commitæäº¤å†å²è®°å½•ã€‚</li><li><code>git log --graph</code>è¿™æ¡å‘½ä»¤ä½¿ç”¨äº†å°±ä¼šæœ‰ä¼˜é›…çš„æ ‘çŠ¶å›¾å¯ä»¥çœ‹å•¦ï¼ˆä¹Ÿä¸ç®—æ˜¯æ ‘çŠ¶å›¾ï¼Œåæ­£å°±æ˜¯å›¾å½¢åŒ–æ˜¾ç¤º</li><li>åœ¨ç»ˆç«¯æŒ‰<code>Q</code>é”®é€€å‡ºæ—¥å¿—å“¦ï¼</li></ul></blockquote><ul><li><code>git reflog</code></li></ul><blockquote><p>ç”¨æ¥æŸ¥çœ‹Gitä»“åº“çš„æ‰€æœ‰gitå‘½ä»¤æ“ä½œçš„å†å²è®°å½•ï¼Œæ¯”å¦‚ä½ ç”¨è¿‡çš„<code>reset</code>, <code>checkout</code>, <code>commit</code>, <code>push</code> çš„è®°å½•éƒ½èƒ½åœ¨è¿™é‡Œçœ‹åˆ°ã€‚</p></blockquote><ul><li><code>git status</code></li></ul><blockquote><p>ç”¨æ¥æŸ¥çœ‹æœ¬åœ°ä»“åº“çŠ¶æ€ã€‚</p></blockquote><h3 id="åˆ†æ”¯æŸ¥æ‰¾"><a href="#åˆ†æ”¯æŸ¥æ‰¾" class="headerlink" title="åˆ†æ”¯æŸ¥æ‰¾"></a>åˆ†æ”¯æŸ¥æ‰¾</h3><ul><li><code>git branch</code></li></ul><blockquote><ul><li><code>git branch</code>ç”¨æ¥æŸ¥çœ‹å½“å‰æ‰€åœ¨çš„åˆ†æ”¯ã€‚</li><li><code>git branch -v</code>ç”¨æ¥æŸ¥çœ‹å½“å‰æ‰€åœ¨åˆ†æ”¯æœ€åä¸€æ¬¡æäº¤çš„ç‰ˆæœ¬å·å’Œç‰ˆæœ¬å…³é”®å­—ã€‚</li><li><code>git branch branch_name</code>ç”¨æ¥åˆ›å»ºåå­—ä¸º<code>branch_name</code>çš„æ–°åˆ†æ”¯ã€‚</li></ul></blockquote><h3 id="è¿œç¨‹ä»“åº“å…‹éš†"><a href="#è¿œç¨‹ä»“åº“å…‹éš†" class="headerlink" title="è¿œç¨‹ä»“åº“å…‹éš†"></a>è¿œç¨‹ä»“åº“å…‹éš†</h3><ul><li><code>git clone</code></li></ul><blockquote><ul><li><code>git clone &lt;address&gt;</code>è€ç†Ÿäººäº†ï¼Œæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ‰“å¼€å®ƒçš„å‘½ä»¤è¡Œçª—å£ï¼Œä½ å°±æ•²ä¸Šé¢çš„å‘½ä»¤ï¼Œ<code>&lt;address&gt;</code>æ˜¯è¢«å…‹éš†çš„è¿œç¨‹ä»“åº“çš„åœ°å€ã€‚å°±è¿™ä¸ªå‘½ä»¤å¯ä»¥å®Œæˆç›®å‰æ‰€æœ‰å¼€æºé¡¹ç›®90%çš„å…‹éš†ã€‚</li><li><code>git clone --recursive &lt;address&gt;</code>å‰©ä¸‹çš„10%å°±æ¯”è¾ƒä¸“ä¸šä¸€ç‚¹ï¼Œå¯èƒ½äººå®¶è¿œç¨‹ä»£ç åº“é‡Œè¿ç”¨äº†åˆ«äººçš„å­é¡¹ç›®ï¼Œä½ ç›´æ¥å…‹éš†ä¸‹æ¥å°±æ˜¯ä¸ªç©ºæ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥ä½ å°±éœ€è¦ç”¨è¿™ä¸ªå‘½ä»¤æ¥<strong>é€’å½’</strong>å…‹éš†ï¼æŠŠåˆ«äººå­é¡¹ç›®çš„å†…å®¹ä¹Ÿå¯ä»¥å…‹éš†ä¸‹æ¥ï¼</li></ul></blockquote><h3 id="æœ¬åœ°ä»“åº“åˆå§‹åŒ–"><a href="#æœ¬åœ°ä»“åº“åˆå§‹åŒ–" class="headerlink" title="æœ¬åœ°ä»“åº“åˆå§‹åŒ–"></a>æœ¬åœ°ä»“åº“åˆå§‹åŒ–</h3><ul><li><code>git init</code></li></ul><blockquote><p>åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆå§‹åŒ–gitä»“åº“</p></blockquote><h3 id="æœ¬åœ°ä»“åº“å…¨å±€é…ç½®"><a href="#æœ¬åœ°ä»“åº“å…¨å±€é…ç½®" class="headerlink" title="æœ¬åœ°ä»“åº“å…¨å±€é…ç½®"></a>æœ¬åœ°ä»“åº“å…¨å±€é…ç½®</h3><ul><li><code>git config</code></li></ul><blockquote><p>åœ¨åˆå§‹åŒ–å®ŒæˆGitæœ¬åœ°ä»“åº“åï¼Œå¼€å§‹æ­£å¼ä½¿ç”¨å‰ï¼Œæ˜¯éœ€è¦æœ‰ä¸€äº›å…¨å±€è®¾ç½®çš„ï¼Œå¦‚ç”¨æˆ·åã€é‚®ç®±ç­‰</p><ul><li><code>git config --global user.name &quot;your name&quot;</code>ç”¨äºè®¾ç½®å…¨å±€ç”¨æˆ·å</li><li><code>git config --global uer.email &quot;your email&quot;</code>ç”¨äºè®¾ç½®å…¨å±€é‚®ç®±<br>å…¶ä¸­ï¼Œ<code>--global</code>æŒ‡å®šå…¨å±€é…ç½®ï¼Œä¸ä½¿ç”¨è¯¥å‚æ•°ï¼Œåˆ™ä¸ºå½“å‰æ‰€åœ¨ä»“åº“é…ç½®ã€‚</li></ul></blockquote><blockquote><p>æˆ‘çš„Githubç”¨æˆ·åå’Œé‚®ç®±ï¼š</p></blockquote><script >function checkPassword() {  var password = document.getElementById("password").value;  if (password === "0000") {  document.getElementById("user").style.display = "block";  } else {  alert("ä¸å‡†å·çœ‹ï¼ï¼ï¼");  document.getElementById("user").style.display = "none";  }}</script><body title="å“’å’©">  å£ä»¤æ˜¯ä»€ä¹ˆï¼Ÿ  <input type="password" id="password">  <button onclick="checkPassword()" style="border-radius: 5px;">ç¡®è®¤</button>  <div id="user" style="display: none;">    <p>ä¿ºæ»´Githubç”¨æˆ·åï¼šZhangKeLiang0627</p>    <p>ä¿ºæ»´Githubé‚®ç®±ï¼š111654293+ZhangKeLiang0627@users.noreply.github.com</p>  </div></body><style>  input[type="password"] {    padding: 3px;    margin: 5px;    border: 1px solid #ccc;    border-radius: 5px;  }  #user {    display: none;    background-color: #f4f4f4;    padding: 5px;    margin-top: 10px;    border-radius: 5px;    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);  }</style><blockquote><p>æ³¨æ„æˆ‘çš„ä¸æ˜¯ä½ çš„å“¦ğŸ«¸</p></blockquote><blockquote><p>äºæ˜¯å¯ä»¥å¦‚ä¸‹é…ç½®ï¼š<br><code>git config --global user.name &quot;xxx&quot;</code><br><code>git config --global uer.email &quot;xxx.example.com&quot;</code></p></blockquote><blockquote><p>å¯ä»¥è¾“å…¥ä»¥ä¸‹ä¸¤æ¡æŒ‡ä»¤ï¼Œæ£€æŸ¥ç”¨æˆ·åå’Œé‚®ç®±æ˜¯å¦è¾“å…¥æ­£ç¡®ã€‚<br><code>git config user.name</code><br><code>git config user.email</code></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Study Page</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨å•ç‰‡æœºç¯å¢ƒä¸‹ç§»æ¤Lua</title>
    <link href="/2023/11/14/%E5%9C%A8%E5%8D%95%E7%89%87%E6%9C%BA%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%A7%BB%E6%A4%8DLua/%E5%9C%A8%E5%8D%95%E7%89%87%E6%9C%BA%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%A7%BB%E6%A4%8DLua/"/>
    <url>/2023/11/14/%E5%9C%A8%E5%8D%95%E7%89%87%E6%9C%BA%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%A7%BB%E6%A4%8DLua/%E5%9C%A8%E5%8D%95%E7%89%87%E6%9C%BA%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%A7%BB%E6%A4%8DLua/</url>
    
    <content type="html"><![CDATA[<h1 id="åœ¨å•ç‰‡æœºç¯å¢ƒä¸‹ç§»æ¤LuağŸ¤—"><a href="#åœ¨å•ç‰‡æœºç¯å¢ƒä¸‹ç§»æ¤LuağŸ¤—" class="headerlink" title="åœ¨å•ç‰‡æœºç¯å¢ƒä¸‹ç§»æ¤LuağŸ¤—"></a>åœ¨å•ç‰‡æœºç¯å¢ƒä¸‹ç§»æ¤LuağŸ¤—</h1><h2 id="è½¯ä»¶ï¼škeil"><a href="#è½¯ä»¶ï¼škeil" class="headerlink" title="è½¯ä»¶ï¼škeil"></a>è½¯ä»¶ï¼škeil</h2><h2 id="æ‰€éœ€ç¯å¢ƒï¼šMallocã€Fatfs"><a href="#æ‰€éœ€ç¯å¢ƒï¼šMallocã€Fatfs" class="headerlink" title="æ‰€éœ€ç¯å¢ƒï¼šMallocã€Fatfs"></a>æ‰€éœ€ç¯å¢ƒï¼šMallocã€Fatfs</h2><ul><li>å£°æ˜è¿™é‡Œä½¿ç”¨çš„æ˜¯æ­£ç‚¹åŸå­å®¶çš„æºç ï¼Œæ„Ÿè°¢ï¼</li><li>ä¸Šè¿°ç¯å¢ƒæ˜¯ä¸ºäº†å®ç°Luaèƒ½å¤Ÿä»å¤–ç½®å­˜å‚¨ä»‹è´¨è¯»å–æ–‡ä»¶æ‰€å‡†å¤‡çš„ï¼Œå¦‚æœæ²¡æœ‰éœ€æ±‚å¯ä»¥ä¸ç”¨</li></ul><h2 id="ä¸»æ§ï¼šSTM32F401RET6"><a href="#ä¸»æ§ï¼šSTM32F401RET6" class="headerlink" title="ä¸»æ§ï¼šSTM32F401RET6"></a>ä¸»æ§ï¼šSTM32F401RET6</h2><ul><li>è¿è¡Œé¢‘ç‡ï¼š84MHz</li><li>ROM:512KB</li><li>RAM:96KB</li></ul><h2 id="ç§»æ¤ç‰ˆæœ¬ï¼šLua-v5-3"><a href="#ç§»æ¤ç‰ˆæœ¬ï¼šLua-v5-3" class="headerlink" title="ç§»æ¤ç‰ˆæœ¬ï¼šLua-v5.3"></a>ç§»æ¤ç‰ˆæœ¬ï¼šLua-v5.3</h2><h3 id="lua-lua-at-v5-3-github-com"><a href="#lua-lua-at-v5-3-github-com" class="headerlink" title="(lua&#x2F;lua at v5.3 (github.com))"></a><strong>(<a href="https://github.com/lua/lua/tree/v5.3">lua&#x2F;lua at v5.3 (github.com)</a>)</strong></h3><ul><li>å…·ä½“ç‰ˆæœ¬æ˜¯Lua-v5.3.5</li></ul><h2 id="å…³äºLua"><a href="#å…³äºLua" class="headerlink" title="å…³äºLua"></a>å…³äºLua</h2><p>Lua è¯­è¨€æ˜¯ç”±å·´è¥¿é‡Œçº¦çƒ­å†…å¢å¤©ä¸»æ•™å¤§å­¦ ([Pontifical Catholic University of Rio de janeiro ) é‡Œçš„ä¸€ä¸ªç ”ç©¶å°ç»„ä¸ 1993å¹´å¼€å‘çš„ä¸€ç§<strong>è½»é‡å°å·§</strong>çš„<strong>è„šæœ¬ï¼ˆå¼±è¯­è¨€ï¼‰è¯­è¨€</strong>ï¼Œç”¨æ ‡å‡† C è¯­è¨€ç¼–å†™ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚</p><p>ä½œä¸ºä¸€ç§æ‰©å±•è¯­è¨€ï¼ŒLua æ²¡æœ‰â€œä¸»â€ç¨‹åºçš„æ¦‚å¿µï¼šå®ƒåµŒå…¥åœ¨å®¿ä¸»å®¢æˆ·ç«¯ä¸­è¿è¡Œï¼Œç§°ä¸ºåµŒå…¥ç¨‹åºæˆ–ç®€ç§°ä¸ºå®¿ä¸»ã€‚ï¼ˆé€šå¸¸è¿™ä¸ªå®¿ä¸»æ˜¯å•æœºluaç¨‹åºï¼‰ <strong>å®¿ä¸»ç¨‹åºå¯ä»¥è°ƒç”¨å‡½æ•°æ‰§è¡Œä¸€æ®µLuaä»£ç ï¼Œå¯ä»¥è¯»å†™Luaå˜é‡ï¼Œå¯ä»¥æ³¨å†ŒLuaä»£ç è°ƒç”¨çš„Cå‡½æ•°</strong>ã€‚é€šè¿‡ä½¿ç”¨ C å‡½æ•°ï¼Œå¯ä»¥å¢å¼º Lua ä»¥åº”å¯¹å¹¿æ³›çš„ä¸åŒé¢†åŸŸï¼Œä»è€Œåˆ›å»ºå…±äº«è¯­æ³•æ¡†æ¶çš„å®šåˆ¶ç¼–ç¨‹è¯­è¨€ã€‚</p><ul><li>ç®€å•æ¥è¯´ï¼ŒLuaæ˜¯ä¸€ç§è½»é‡çº§çš„åŸºäºCç¼–å†™çš„è¿è¡Œé«˜æ•ˆçš„è„šæœ¬è¯­è¨€ï¼ˆè§£é‡Šæ€§è¯­è¨€likeï¼šPythonã€shellã€Matlabç­‰ã€‚</li><li>åœ¨å•ç‰‡æœºç¯å¢ƒä¸‹ç§»æ¤Luaï¼Œå› ä¸ºLuaå’ŒCçš„è¶…çº§æ— æ•Œå…¼å®¹æ€§ï¼Œç›¸å½“äºä½ åŒæ—¶æ‹¥æœ‰äº†ä¸¤ç§è¯­è¨€åŠ æŒï¼ˆCå’ŒLuaï¼‰ï¼Œä½ å¯ä»¥ç›´æ¥ç”¨Luaå†…éƒ¨æä¾›çš„å‡ ä¸ªç®€å•çš„APIï¼Œä½¿å¾—Cå†…è¿è¡ŒLuaè„šæœ¬ï¼Œç‰¹åˆ«æ–¹ä¾¿ï¼Œé¿å…äº†é‡å¤çƒ§å½•çš„éº»çƒ¦ã€‚</li><li><strong>Luaè§£é‡Šå™¨çš„ç§»æ¤ï¼Œæœ€å°å ç”¨ROM: 70KBï¼Œå ç”¨RAM: 7.5KB(å¾ˆå°å¾ˆå°)</strong></li><li>ç®€å•çš„luaç¨‹åºè·ŸCç¨‹åºæ•ˆç‡æ¯”æ˜¯1ï¼š100ã€‚è€Œluaè¿ç®—é‡è¶Šå¤§ã€‚ä¸Cç¨‹åºæ•ˆç‡å·®è·å°±è¶Šå°ã€‚</li></ul><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><ol><li>åœ¨githubä¸Šæ‹‰å–Lua-v5.3çš„ç‰ˆæœ¬åº“(<a href="https://github.com/lua/lua/tree/v5.3">lua&#x2F;lua at v5.3 (github.com)</a>)</li><li>å»ºç«‹ä¸€ä¸ªåŸºäºä¸»æ§STM32F401RET6çš„Keilæ–‡ä»¶(å·²ç»æœ‰çš„è¯å°±ä¸éœ€è¦ï¼Œç›´æ¥å“å“ç§»æ¤)</li></ol><h2 id="å¼€å§‹ç§»æ¤"><a href="#å¼€å§‹ç§»æ¤" class="headerlink" title="å¼€å§‹ç§»æ¤"></a>å¼€å§‹ç§»æ¤</h2><h4 id="ç§»æ¤Luaåº“æ–‡ä»¶"><a href="#ç§»æ¤Luaåº“æ–‡ä»¶" class="headerlink" title="ç§»æ¤Luaåº“æ–‡ä»¶"></a>ç§»æ¤Luaåº“æ–‡ä»¶</h4><ol><li>å°†githubä¸Šæ‹‰å–çš„ lua-5.3 æ–‡ä»¶å¤¹ç§»å…¥å·¥ç¨‹æ–‡ä»¶å¤¹ã€‚</li><li>æ‰“å¼€Keilï¼Œç‚¹å‡»é­”æœ¯æ£’ï¼Œå°†..\lua-5.3 ç›¸å¯¹è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ã€‚</li><li>ç‚¹å‡»ä¸‰ä¸ªç›’å­ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å‘½åä¸ºLuaï¼Œå°†..\lua-5.3 ç›¸å¯¹è·¯å¾„ä¸‹çš„æ‰€æœ‰.cæ–‡ä»¶ï¼ˆé™¤äº†Lua.cå’ŒLuac.cä»¥å¤–ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œæ²¡æœ‰å°±ä¸ç®¡ï¼‰æ·»åŠ åˆ°å…¶ä¸­ã€‚</li><li>æ›´æ”¹ loslib.c æ–‡ä»¶ä¸‹éƒ¨åˆ†å†…å®¹ï¼š</li></ol><blockquote><ol><li>å°† <strong>os_exit(lua_State * L)</strong> å‡½æ•°ä¸­ <strong>if(L) exit(status)</strong> æ³¨é‡Šï¼Œå¹¶æ·»åŠ  <strong>status&#x3D;status</strong> è¯­å¥ã€‚</li><li>æ·»åŠ  <strong>time(time_t *time)</strong> å’Œ <strong>system(const char * string)</strong> ã€‚</li><li>å°†é­”æœ¯æ£’é‡Œçš„ <strong>Use MicroLIB</strong>Â æ¨¡å¼å…³é—­ï¼ˆä¸æ‰“å‹¾ï¼ï¼‰ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">os_exit</span> <span class="hljs-params">(lua_State *L)</span> &#123;<br>  <span class="hljs-type">int</span> status;<br>  <span class="hljs-keyword">if</span> (lua_isboolean(L, <span class="hljs-number">1</span>))<br>    status = (lua_toboolean(L, <span class="hljs-number">1</span>) ? EXIT_SUCCESS : EXIT_FAILURE);<br>  <span class="hljs-keyword">else</span><br>    status = (<span class="hljs-type">int</span>)luaL_optinteger(L, <span class="hljs-number">1</span>, EXIT_SUCCESS);<br>  <span class="hljs-keyword">if</span> (lua_toboolean(L, <span class="hljs-number">2</span>))<br>    lua_close(L);<br><span class="hljs-comment">/* &#x27;if&#x27; to avoid warnings for unreachable &#x27;return&#x27; */</span><br>  <span class="hljs-comment">//if (L) exit(status);  </span><br><br>  status=status;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br> <br><span class="hljs-type">time_t</span> <span class="hljs-title function_">time</span><span class="hljs-params">(<span class="hljs-type">time_t</span> *time)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br> <br><span class="hljs-type">int</span> <span class="hljs-title function_">system</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-built_in">string</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><ul><li>æœ€åå¯ä»¥å»<strong>linit.c</strong>æ³¨é‡Šä¸€äº›ç”¨ä¸åˆ°çš„Luaåº“ï¼Œå½“ç„¶ï¼Œä¸æ³¨é‡Šä¹Ÿä¸ä¼šå½±å“å¤ªå¤§ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">** these libs are loaded by lua.c and are readily available to any Lua</span><br><span class="hljs-comment">** program</span><br><span class="hljs-comment">*/</span><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> luaL_Reg loadedlibs[] = &#123;<br>  &#123;<span class="hljs-string">&quot;_G&quot;</span>, luaopen_base&#125;,<br>  &#123;LUA_LOADLIBNAME, luaopen_package&#125;,<br>  &#123;LUA_COLIBNAME, luaopen_coroutine&#125;,<br>  &#123;LUA_TABLIBNAME, luaopen_table&#125;,<br><span class="hljs-comment">//  &#123;LUA_IOLIBNAME, luaopen_io&#125;,</span><br><span class="hljs-comment">//  &#123;LUA_OSLIBNAME, luaopen_os&#125;,</span><br>  &#123;LUA_STRLIBNAME, luaopen_string&#125;,<br>  &#123;LUA_MATHLIBNAME, luaopen_math&#125;,<br>  &#123;LUA_UTF8LIBNAME, luaopen_utf8&#125;,<br><span class="hljs-comment">//  &#123;LUA_DBLIBNAME, luaopen_debug&#125;,</span><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(LUA_COMPAT_BITLIB)</span><br>  &#123;LUA_BITLIBNAME, luaopen_bit32&#125;,<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>  &#123;<span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>&#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h4 id="æ·»åŠ retarget-c"><a href="#æ·»åŠ retarget-c" class="headerlink" title="æ·»åŠ retarget.c"></a>æ·»åŠ retarget.c</h4><blockquote><ul><li>æ”¾å“ªéšæ„ï¼Œæˆ‘åŸºäºæ­£ç‚¹åŸå­çš„å·¥ç¨‹æ”¾åœ¨äº†systemçš„æ–‡ä»¶å¤¹ä¸­</li><li>å¼•è¿›è¿™ä¸ªåº“çš„ç›®çš„æ˜¯ä¸ºäº†å®ç°Luaä»å¤–ç½®çš„å­˜å‚¨ä»‹è´¨ä¸­è·å–æ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨Fatfsçš„APIå»å®ç°Luaæ‰€éœ€çš„fopenã€fcloseã€freadç­‰å‡½æ•°ï¼ˆå¦‚æœæ²¡æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ï¼‰</li><li>å£°æ˜æœ¬æ¬¡ç§»æ¤ä½¿ç”¨çš„Fatfsï¼Œæ¥è‡ªæ­£ç‚¹åŸå­çš„Fatfså®éªŒæºç ï¼Œå¥½ç”¨çˆ±ç”¨ï¼Œç»™ä¸ªå¥½è¯„ã€‚</li></ul></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ctype.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;rt_sys.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;usart.h&quot;</span></span><br><br><span class="hljs-comment">// æ˜¯å¦å°†fopenä¸FatFSå…³è”èµ·æ¥</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> FATFS_EN 1</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ff.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-comment">// #pragma import(__use_no_semihosting) // ç¦ç”¨åŠä¸»æœºæ¨¡å¼ //å·²ç»åœ¨usart.cä¸­å®šä¹‰</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> import(__use_no_semihosting_swi) <span class="hljs-comment">// å³ä¸ä½¿ç”¨åŠä¸»æœºæ¨¡å¼ï¼Œé˜²æ­¢ç¨‹åºè¿›å…¥è½¯ä»¶ä¸­æ–­</span></span><br><span class="hljs-comment">// #pragma import(_main_redirection)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> STDIN 0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> STDOUT 1</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> STDERR 2</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> IS_STD(fh) ((fh) &gt;= 0 &amp;&amp; (fh) &lt;= 2)</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * These names are used during library initialization as the</span><br><span class="hljs-comment"> * file names opened for stdin, stdout, and stderr.</span><br><span class="hljs-comment"> * As we define _sys_open() to always return the same file handle,</span><br><span class="hljs-comment"> * these can be left as their default values.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">const</span> <span class="hljs-type">char</span> __stdin_name[] = <span class="hljs-string">&quot;:kkl&quot;</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">char</span> __stdout_name[] = <span class="hljs-string">&quot;kkl&quot;</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">char</span> __stderr_name[] = <span class="hljs-string">&quot;kkl&quot;</span>;<br><br>FILEHANDLE _sys_open(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *name, <span class="hljs-type">int</span> openmode)<br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    BYTE mode;<br>    FIL *fp;<br>    FRESULT fr;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">if</span> (name == __stdin_name)<br>        <span class="hljs-keyword">return</span> STDIN;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name == __stdout_name)<br>    &#123;<br>        uart_init(<span class="hljs-number">115200</span>); <span class="hljs-comment">// åˆå§‹åŒ–ä¸²å£ (åœ¨mainå‡½æ•°æ‰§è¡Œå‰æ‰§è¡Œ)</span><br>        <span class="hljs-keyword">return</span> STDOUT;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name == __stderr_name)<br>        <span class="hljs-keyword">return</span> STDERR;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">sizeof</span>(FILEHANDLE) &lt; <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">void</span> *))<br>    &#123;<br>        USART1_SendBuf(<span class="hljs-string">&quot;sizeof(FILEHANDLE) should be no less than sizeof(void *)!\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    fp = ff_memalloc(<span class="hljs-keyword">sizeof</span>(FIL)); <span class="hljs-comment">// ä½¿ç”¨è‡ªå·±çš„mallocå‡½æ•°æ›¿æ¢</span><br>    <span class="hljs-keyword">if</span> (fp == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br>    <span class="hljs-comment">/* http://elm-chan.org/fsw/ff/doc/open.html */</span><br>    <span class="hljs-keyword">if</span> (openmode &amp; OPEN_W)<br>    &#123;<br>        mode = FA_CREATE_ALWAYS | FA_WRITE;<br>        <span class="hljs-keyword">if</span> (openmode &amp; OPEN_PLUS)<br>            mode |= FA_READ;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (openmode &amp; OPEN_A)<br>    &#123;<br>        mode = FA_OPEN_APPEND | FA_WRITE;<br>        <span class="hljs-keyword">if</span> (openmode &amp; OPEN_PLUS)<br>            mode |= FA_READ;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        mode = FA_READ;<br>        <span class="hljs-keyword">if</span> (openmode &amp; OPEN_PLUS)<br>            mode |= FA_WRITE;<br>    &#125;<br><br>    fr = f_open(fp, name, mode);<br>    <span class="hljs-keyword">if</span> (fr == FR_OK)<br>        <span class="hljs-keyword">return</span> (<span class="hljs-type">uintptr_t</span>)fp;<br><br>    ff_memfree(fp); <span class="hljs-comment">// ä½¿ç”¨è‡ªå·±çš„freeå‡½æ•°æ›¿æ¢</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><br><span class="hljs-type">int</span> _sys_close(FILEHANDLE fh)<br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    FRESULT fr;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">if</span> (IS_STD(fh))<br>    &#123;<br>        <span class="hljs-keyword">if</span> (fh == STDOUT)<br>            <span class="hljs-comment">// usart_deinit();</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    fr = f_close((FIL *)fh);<br>    <span class="hljs-keyword">if</span> (fr == FR_OK)<br>    &#123;<br>        ff_memfree((<span class="hljs-type">void</span> *)fh);<span class="hljs-comment">// ä½¿ç”¨è‡ªå·±çš„freeå‡½æ•°æ›¿æ¢</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><br><span class="hljs-type">int</span> _sys_write(FILEHANDLE fh, <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *buf, <span class="hljs-type">unsigned</span> len, <span class="hljs-type">int</span> mode)<br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    FRESULT fr;<br>    UINT bw;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">if</span> (fh == STDIN)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br>    <span class="hljs-keyword">if</span> (fh == STDOUT || fh == STDERR)<br>    &#123;<br>        USART1_SendBuf((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)buf);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    fr = f_write((FIL *)fh, buf, len, &amp;bw);<br>    <span class="hljs-keyword">if</span> (fr == FR_OK)<br>        <span class="hljs-keyword">return</span> len - bw;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><br><span class="hljs-type">int</span> _sys_read(FILEHANDLE fh, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *buf, <span class="hljs-type">unsigned</span> len, <span class="hljs-type">int</span> mode)<br>&#123;<br>    <span class="hljs-comment">// char ch;</span><br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    FRESULT fr;<br>    UINT br;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">if</span> (fh == STDIN)<br>    &#123;<br>        <span class="hljs-keyword">while</span> (i &lt; len)<br>        &#123;<br>            <span class="hljs-comment">//     ch = usart_receive(); // è¿™é‡Œéœ€è¦å®ç°ä¸²å£æ”¶åˆ°å­—ç¬¦ä¸²ä¼ å…¥bufçš„åŠŸèƒ½</span><br>            <span class="hljs-comment">//     if (isprint(ch))</span><br>            <span class="hljs-comment">//     &#123;</span><br>            <span class="hljs-comment">//         buf[i++] = ch;</span><br>            <span class="hljs-comment">//         usart_send(ch);</span><br>            <span class="hljs-comment">//     &#125;</span><br>            <span class="hljs-comment">//     else if (ch == &#x27;\r&#x27;)</span><br>            <span class="hljs-comment">//     &#123;</span><br>            <span class="hljs-comment">//         buf[i++] = &#x27;\n&#x27;;</span><br>            <span class="hljs-comment">//         usart_send(&#x27;\n&#x27;);</span><br>            <span class="hljs-comment">//         break;</span><br>            <span class="hljs-comment">//     &#125;</span><br>            <span class="hljs-comment">//     else if (i &gt; 0 &amp;&amp; ch == &#x27;\b&#x27;)</span><br>            <span class="hljs-comment">//     &#123;</span><br>            <span class="hljs-comment">//         i--;</span><br>            <span class="hljs-comment">//         usart_send_string(&quot;\b \b&quot;, 3);</span><br>            <span class="hljs-comment">//     &#125;</span><br>            i--;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> len - i;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fh == STDOUT || fh == STDERR)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    fr = f_read((FIL *)fh, buf, len, &amp;br);<br>    <span class="hljs-keyword">if</span> (fr == FR_OK)<br>        <span class="hljs-keyword">return</span> len - br;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><br><span class="hljs-comment">// æ£€æŸ¥å¥æŸ„æ˜¯å¦ä¸ºç»ˆç«¯</span><br><span class="hljs-type">int</span> _sys_istty(FILEHANDLE fh)<br>&#123;<br>    <span class="hljs-keyword">return</span> IS_STD(fh);<br>&#125;<br><br><span class="hljs-type">int</span> _sys_seek(FILEHANDLE fh, <span class="hljs-type">long</span> pos)<br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    FRESULT fr;<br><br>    <span class="hljs-keyword">if</span> (!IS_STD(fh))<br>    &#123;<br>        fr = f_lseek((FIL *)fh, pos);<br>        <span class="hljs-keyword">if</span> (fr == FR_OK)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><br><span class="hljs-comment">// åˆ·æ˜Ÿå¥æŸ„å…³è”çš„ç¼“å†²åŒº</span><br><span class="hljs-type">int</span> _sys_ensure(FILEHANDLE fh)<br>&#123;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// è¿”å›æ–‡ä»¶å½“å‰é•¿åº¦</span><br><span class="hljs-type">long</span> _sys_flen(FILEHANDLE fh)<br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> FATFS_EN</span><br>    <span class="hljs-keyword">if</span> (!IS_STD(fh))<br>        <span class="hljs-keyword">return</span> f_size((FIL *)fh);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><br><span class="hljs-comment">// åœ¨usart.cä¸­å®šä¹‰äº†ï¼Œæ³¨é‡Šé˜²æ­¢é‡å¤å®šä¹‰</span><br><span class="hljs-comment">// void _sys_exit(int status)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">////while(1);</span><br><span class="hljs-comment">//&#125;</span><br><br><span class="hljs-type">int</span> _sys_tmpnam(<span class="hljs-type">char</span> *name, <span class="hljs-type">int</span> fileno, <span class="hljs-type">unsigned</span> maxlength)<br>&#123;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// å°†ä¸€ä¸ªå­—ç¬¦å†™å…¥æ§åˆ¶å°</span><br><span class="hljs-type">void</span> _ttywrch(<span class="hljs-type">int</span> ch)<br>&#123;<br>    USART1_SendChar(ch);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename)</span><br>&#123;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">rename</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *oldname, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *newname)</span><br>&#123;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// å®šä¹‰mainå‡½æ•°argvçš„å†…å®¹</span><br><span class="hljs-type">char</span> *_sys_command_string(<span class="hljs-type">char</span> *cmd, <span class="hljs-type">int</span> len)<br>&#123;<br>    <span class="hljs-comment">// å¯ä»¥æŠŠå‘½ä»¤è¡Œå†…å®¹æ”¾å…¥å¤§å°ä¸ºlençš„cmdç¼“å­˜åŒºç„¶åè¿”å›</span><br>    <span class="hljs-comment">// ä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span><br>    <span class="hljs-comment">// return &quot;./foo -f bar&quot;;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-comment">// åœ¨loslib.cä¸­å·²æœ‰å®šä¹‰ï¼Œé˜²æ­¢é‡å¤å®šä¹‰ï¼Œè¿™é‡Œæ³¨é‡Šæ‰</span><br><span class="hljs-comment">// time_t time(time_t * time)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//return 0;</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-type">clock_t</span> <span class="hljs-title function_">clock</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="æ’æŸ¥é”™è¯¯"><a href="#æ’æŸ¥é”™è¯¯" class="headerlink" title="æ’æŸ¥é”™è¯¯"></a>æ’æŸ¥é”™è¯¯</h2><p>å› ä¸ºæˆ‘ç”¨çš„æ˜¯æ­£ç‚¹åŸå­çš„USARTçš„ä»£ç ï¼Œå®ƒä»¬å®¶æ˜¯æ²¡æœ‰å‹¾<strong>Use MicroLIB</strong>Â æ¨¡å¼çš„ï¼Œä¸€äº›é…ç½®ä¼šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è‡ªå·±æ”¹ä¸€äº›ä¸œè¥¿ï¼Œä¸ç„¶ç¼–è¯‘æ²¡æ³•é€šè¿‡ã€‚</p><ul><li>æ‰“å¼€usart.cï¼Œæ›´æ”¹ä»¥ä¸‹éƒ¨åˆ†å†…å®¹ï¼š</li></ul><blockquote><ol><li>æ³¨é‡Š<strong>FILE __stdout;</strong></li></ol></blockquote><p>å› ä¸ºç§»æ¤äº†Luaè§£é‡Šå™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„<strong>å †æ ˆåˆ†é…</strong>åº”è¯¥ç›¸åº”çš„åˆ†é…æ›´å¤§ä¸€äº›ã€‚</p><ul><li>æ‰“å¼€å¯åŠ¨æ–‡ä»¶ï¼ˆ<strong>startup_stm32f40_41xxx.s</strong>ï¼‰ï¼Œæ›´æ”¹ä»¥ä¸‹éƒ¨åˆ†å†…å®¹ï¼š</li></ul><blockquote><ol><li>ä¿®æ”¹æ ˆï¼š<strong>Stack_Size      EQU     0x00001000 &#x2F;&#x2F;4k &#x2F;&#x2F;ä¸è¡Œå°±æ”¹æˆ0x00004000</strong></li><li>ä¿®æ”¹å †ï¼š<strong>Heap_Size       EQU     0x00002c00 &#x2F;&#x2F;11k &#x2F;&#x2F;ä¸è¡Œå°±æ”¹æˆ0x00004000</strong></li></ol></blockquote><ul><li>æ‰“å¼€<strong>luaconf.h</strong></li></ul><blockquote><ol><li>æ·»åŠ  <strong>#define LUA_32BITS</strong></li></ol></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">@@ LUA_32BITS enables Lua with 32-bit integers and 32-bit floats. You</span><br><span class="hljs-comment">** can also define LUA_32BITS in the make file, but changing here you</span><br><span class="hljs-comment">** ensure that all software connected to Lua will be compiled with the</span><br><span class="hljs-comment">** same configuration.</span><br><span class="hljs-comment">*/</span><br><span class="hljs-comment">/* #define LUA_32BITS */</span><br> <span class="hljs-meta">#<span class="hljs-keyword">define</span> LUA_32BITS</span><br></code></pre></td></tr></table></figure><p>OKï¼è¿™æ—¶å€™å†ç¼–è¯‘åº”è¯¥ä¸ä¼šæœ‰æŠ¥é”™ï¼Œæ˜¯å¯ä»¥é€šè¿‡çš„ï¼</p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* å°†Cå‡½æ•°æ³¨å†ŒæˆLuaå¯è°ƒç”¨çš„å‡½æ•° */</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">lua_led_on</span><span class="hljs-params">(lua_State * L)</span><br>&#123;<br>LED0 = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-comment">/* å°†Cå‡½æ•°æ³¨å†ŒæˆLuaå¯è°ƒç”¨çš„å‡½æ•° */</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">lua_print_hello</span><span class="hljs-params">(lua_State * L)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello this is lua!\r\n&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-comment">/* å°†Cå‡½æ•°æ³¨å†ŒæˆLuaå¯è°ƒç”¨çš„å‡½æ•° */</span><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">luaL_Reg</span> <span class="hljs-title">mylib</span>[] =</span><br>&#123;<br>&#123;<span class="hljs-string">&quot;led_on&quot;</span>,lua_led_on&#125;,<br>&#123;<span class="hljs-string">&quot;print_hello&quot;</span>,lua_print_hello&#125;,<br>&#123;<span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>&#125;<br>&#125;;<br><br><span class="hljs-comment">/* ç¼–å†™Luaè„šæœ¬ */</span><br><span class="hljs-comment">/* è¿™ä¸ªç¨‹åºä¸­ï¼Œæˆ‘ä»¬ç‚¹äº®äº†ledï¼ŒåŒæ—¶æ‰“å°äº†Hello this is lua!\r\n */</span><br><span class="hljs-comment">/* æ¥ç€ï¼Œç¨‹åºçš„ä¸»å¯¼æƒå°±ä¼šå½’è¿˜ç»™cç»§ç»­æ‰§è¡Œcç¨‹åº */</span><br><span class="hljs-comment">/* å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨è¿™é‡Œå†™ä¸ª while å¾ªç¯ï¼Œè¿™æ ·åé¢çš„cç¨‹åºéƒ½ä¸å†æ‰§è¡Œï¼Œç›´è‡³é€€å‡ºå¾ªç¯ */</span><br><span class="hljs-type">const</span> <span class="hljs-type">char</span> LUA_SCRIPT_GLOBAL_ON[]=<span class="hljs-string">&quot;\</span><br><span class="hljs-string">led_on()\</span><br><span class="hljs-string">print_hello()\</span><br><span class="hljs-string">&quot;</span>;<br><br><span class="hljs-comment">/* è¿è¡ŒLuaè„šæœ¬ */</span><br><span class="hljs-comment">/* å°†è¿™ä¸ªå‡½æ•°ä¸¢åˆ°ç¨‹åºé‡Œé¢å»ï¼Œæ¯”æ–¹è¯´mainå‡½æ•°é‡Œå¤´ */</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">do_file_script</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>lua_State *L;<br>L = luaL_newstate();<br>luaopen_base(L);<br>luaL_setfuncs(L, mylib, <span class="hljs-number">0</span>); <span class="hljs-comment">// ä½¿æˆ‘ä»¬æ³¨å†Œçš„å‡½æ•°ç”Ÿæ•ˆ</span><br>luaL_dostring(L, LUA_SCRIPT_GLOBAL_ON); <span class="hljs-comment">// æ‰§è¡Œæˆ‘ä»¬å†™çš„Luaæ–‡æœ¬è„šæœ¬ç¨‹åº</span><br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Luaè¿˜æœ‰æ›´å¤šçš„å¯ç©æ€§ï¼Œä¸Šé¢çš„ä»…ä»…åªæ˜¯å…¶ä¸­ä¸€ç§ï¼ˆ<strong>luaL_dostring</strong>ï¼‰ï¼</p><p>ä¸‹é¢å†ä»‹ç»ä¸€ç§ï¼ˆ<strong>luaL_dofile</strong>ï¼‰ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">lua_led_on</span><span class="hljs-params">(lua_State * L)</span><br>&#123;<br>LED0 = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">lua_print_hello</span><span class="hljs-params">(lua_State * L)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello this is lua!\r\n&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">luaL_Reg</span> <span class="hljs-title">mylib</span>[] =</span><br>&#123;<br>&#123;<span class="hljs-string">&quot;led_on&quot;</span>,lua_led_on&#125;,<br>&#123;<span class="hljs-string">&quot;print_hello&quot;</span>,lua_print_hello&#125;,<br>&#123;<span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>&#125;<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">do_file_script</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">uint8_t</span> res;<br>lua_State *L;<br>L = luaL_newstate(); <span class="hljs-comment">//åˆ›å»ºLuaè™šæ‹Ÿæœº</span><br>luaopen_base(L); <span class="hljs-comment">// é…ç½®åŸºæœ¬ç¯å¢ƒ</span><br>luaL_openlibs(L); <span class="hljs-comment">// æ³¨å†Œæ‰€ä½¿ç”¨åˆ°çš„å„ç§Luaåº“</span><br>luaL_setfuncs(L, mylib, <span class="hljs-number">0</span>); <span class="hljs-comment">// æ³¨å†Œå‡½æ•°</span><br><br>res = luaL_dofile(L, <span class="hljs-string">&quot;1:/test.lua&quot;</span>); <span class="hljs-comment">// è¿™é‡Œæˆ‘äº‹å…ˆæŠŠtest.luaå­˜å‚¨åˆ°äº†å¤–éƒ¨flashé‡Œï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å†™å…·ä½“ä½ç½®å»è¯»å–å¹¶è¿è¡Œè¿™ä¸ªæ–‡ä»¶</span><br><span class="hljs-keyword">if</span>(res) <span class="hljs-comment">// è¿”å›1ï¼Œè¯´æ˜è¯»å–å¤±è´¥ï¼Œè¿”å›0ï¼Œä¸ºè¯»å–æˆåŠŸ</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;err\r\n&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ok\r\n&quot;</span>);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>Luaè°ƒç”¨Cå‡½æ•°çš„æ³¨æ„äº‹é¡¹ï¼š<br>å¯¹äºå¯è¢«Luaè°ƒç”¨çš„Cå‡½æ•°è€Œè¨€ï¼Œå…¶æ¥å£å¿…é¡»éµå¾ªLuaè¦æ±‚çš„å½¢å¼ï¼Œå³<br><strong>typedef int (lua_CFunction)(lua_State*Â L);</strong><br>æ¥æ”¶ä¸€ä¸ªå‚æ•°Lua_State*ï¼Œå³Luaçš„çŠ¶æ€ï¼Œè¿”å›å€¼è¡¨ç¤ºå‹å…¥æ ˆä¸­çš„ç»“æœä¸ªæ•°ã€‚</p></blockquote><p>å¦‚æœæƒ³è¦æ³¨å†Œæœ‰ä¼ å…¥å‚æ•°ä¸”æœ‰è¿”å›å€¼çš„å‡½æ•°ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">Add</span><span class="hljs-params">(lua_State *L)</span><br>&#123;<br><span class="hljs-type">int</span> count;<br><span class="hljs-type">int</span> x,y,res;<br><br>x = lua_tointeger(L,<span class="hljs-number">1</span>);<span class="hljs-comment">//è·å–Luaä¼ é€’çš„å‚æ•°</span><br>y = lua_tointeger(L,<span class="hljs-number">2</span>);<br><br>res = x + y;<span class="hljs-comment">//è®¡ç®—x+y</span><br><br>lua_pushnumber(L,res);<span class="hljs-comment">//ç»“æœå‹å…¥æ ˆä¸­ï¼Œä¾›Luaæå–</span><br><br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<span class="hljs-comment">//è¿”å›å‚æ•°ä¸ªæ•°ï¼ï¼è¿™æ˜¯é€šçŸ¥LUAè°ƒç”¨è€…æœ‰ä¸€ä¸ªå€¼è¿”å›</span><br>&#125;<br><br><span class="hljs-comment">//Luaä¸­è°ƒç”¨</span><br>local res<br>res = Add(<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)<br>print(<span class="hljs-string">&quot;Result = &quot;</span>,res)<br></code></pre></td></tr></table></figure><h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><h3 id="Author-kkl"><a href="#Author-kkl" class="headerlink" title="Author: @kkl"></a>Author: @kkl</h3>]]></content>
    
    
    <categories>
      
      <category>Study Page</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Lua</tag>
      
      <tag>å•ç‰‡æœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
